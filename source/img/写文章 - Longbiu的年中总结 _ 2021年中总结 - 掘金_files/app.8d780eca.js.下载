(function(t){function e(e){for(var n,r,o=e[0],c=e[1],l=e[2],d=0,h=[];d<o.length;d++)r=o[d],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&h.push(s[r][0]),s[r]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);u&&u(e);while(h.length)h.shift()();return a.push.apply(a,l||[]),i()}function i(){for(var t,e=0;e<a.length;e++){for(var i=a[e],n=!0,o=1;o<i.length;o++){var c=i[o];0!==s[c]&&(n=!1)}n&&(a.splice(e--,1),t=r(r.s=i[0]))}return t}var n={},s={app:0},a=[];function r(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=n,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="https://sf1-scmcdn2-tos.pstatp.com/xitu_juejin_web_editor/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;a.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("cd49")},"034c":function(t,e,i){"use strict";var n=i("cc4b"),s=i.n(n);s.a},"043c":function(t,e,i){},"045f":function(t,e,i){t.exports=i.p+"img/img.8288be10.svg"},"0524":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"publish-popup",class:{active:t.active,disabled:t.disabled},attrs:{"st:block":"publishPopup"}},[i("Button",{nativeOn:{click:function(e){t.active=!t.disabled&&!t.active}}},[t._v(" "+t._s(t.actionText)+" ")]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.active,expression:"active"}],staticClass:"panel"},[i("div",{staticClass:"title"},[t._v(t._s(t.actionText+"文章"))]),i("div",{staticClass:"form-item"},[i("div",{staticClass:"label required category-label"},[t._v(" 分类： ")]),i("div",{staticClass:"form-item-content category-list"},t._l(t.categoryList,(function(e){return i("div",{key:e.id,staticClass:"item",class:{active:t.currentCategoryId===e.id},on:{click:function(i){t.post.category=e}}},[t._v(" "+t._s(e.title)+" ")])})),0)]),i("div",{staticClass:"form-item"},[i("div",{staticClass:"label required"},[t._v(" 添加标签： ")]),i("div",{staticClass:"form-item-content"},[i("TagSelect",{staticClass:"select",attrs:{tagLimit:t.tagLimit,value:t.post.tags},on:{change:t.handleTagsChange}})],1)]),i("div",{staticClass:"form-item"},[i("div",{staticClass:"label"},[t._v("文章封面：")]),i("div",{staticClass:"form-item-content"},[i("CoverSelector",{attrs:{message:"建议尺寸：1303*734px",userid:t.post.user_id},model:{value:t.post.cover_image,callback:function(e){t.$set(t.post,"cover_image",e)},expression:"post.cover_image"}})],1)]),i("div",{staticClass:"form-item column-line"},[i("div",{staticClass:"label"},[t._v(" 收录至专栏： ")]),i("div",{staticClass:"form-item-content"},[i("ColumnSelect",{staticClass:"select",attrs:{limit:3,value:t.post.columns},on:{change:t.handleColumnChange}})],1)]),i("div",{staticClass:"summary-box form-item"},[i("div",{staticClass:"label"},[t._v("编辑摘要：")]),i("div",{staticClass:"summary form-item-content"},[i("span",{style:{color:(t.post.brief_content||"").length<50?"#ee4d38":"#c2c6cc"}},[t._v(" "+t._s((t.post.brief_content||"").length)+"/100 ")]),i("Input",{directives:[{name:"loading",rawName:"v-loading",value:t.summaryLoading,expression:"summaryLoading"}],staticClass:"summary-textarea",attrs:{type:"textarea",autosize:!1,rows:5,maxlength:100},on:{"on-change":t.handleSummaryInput},model:{value:t.post.brief_content,callback:function(e){t.$set(t.post,"brief_content","string"===typeof e?e.trim():e)},expression:"post.brief_content"}})],1)]),i("div",{staticClass:"footer"},[t.hasOrg&&t.isDraft?i("label",{staticClass:"label",class:{active:t.sync_to_org}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.sync_to_org,expression:"sync_to_org"}],staticClass:"checkbox",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.sync_to_org)?t._i(t.sync_to_org,null)>-1:t.sync_to_org},on:{change:function(e){var i=t.sync_to_org,n=e.target,s=!!n.checked;if(Array.isArray(i)){var a=null,r=t._i(i,a);n.checked?r<0&&(t.sync_to_org=i.concat([a])):r>-1&&(t.sync_to_org=i.slice(0,r).concat(i.slice(r+1)))}else t.sync_to_org=s}}}),i("span",{staticClass:"label-content"},[t._v("同步到团队空间")])]):t._e(),i("div",{staticClass:"btn-container"},[i("UIButton",{staticClass:"btn",staticStyle:{"margin-right":"16px"},attrs:{type:"line"},on:{click:function(e){t.active=!1}}},[t._v(" 取消 ")]),i("UIButton",{staticClass:"btn",attrs:{disabled:t.disabled||!t.isDraft&&!t.canPublish,"st:name":"publishBtn"},on:{click:t.publish}},[t._v(" "+t._s("确定并"+t.actionText)+" ")])],1)])])],1)},s=[],a=i("54ad"),r=i("c5cc"),o=i("8a69"),c=i("e974");i("7bbb");function l(t){return Object(r["a"])({url:"/tag_api/v1/query_tag_list",method:"post",body:t}).then(t=>({data:t.data.map(d),cursor:t.cursor,has_more:t.has_more}))}function u(){return Object(r["a"])({url:"/tag_api/v1/query_category_list",method:"post",body:{}}).then(t=>t.data).then(t=>t.map(c["a"].fromServerDescriptor))}function d(t){const e=t.tag||{},i=t.user_interact||{};return o["a"].fromDescriptor({id:e.tag_id,title:e.tag_name,createdAt:new Date(e.ctime),updatedAt:new Date(e.mtime),color:e.color,icon:e.icon,showOnNav:e.show_navi,alias:e.tag_alias,entryCount:e.post_article_count,subscribersCount:e.concern_user_count,subscribed:i.is_follow})}function h(){return u()}function f(){return h()}var p=i("c34c"),m=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"tag-input"},[i("b-select",{staticStyle:{width:"100%"},attrs:{filterMethod:!1,multiple:"",emptyText:null,placeholder:"请搜索添加标签",value:t.value,clearable:"",filterable:"","value-key":"id","on-dropdown-scroll":t.fetchMore},on:{"on-search":t.handleSearch,"on-change":t.handleChange,"on-dropdown-visible-change":t.handleVisibleChange}},[t._l(t.dataList,(function(e,n){return i("b-option",{key:e.id||n,attrs:{disabled:t.countExceed,label:e.title||"",value:e||{}}})})),t._l(t.value,(function(t,e){return i("b-option",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],key:"selected"+(t.id||e),attrs:{label:t.title||"",value:t||{}}})}))],2)],1)},g=[],b=i("8690"),v=i("a0f4"),_=Object(v["defineComponent"])({components:{BSelect:a["Select"],BOption:a["Option"]},props:["tagLimit","value"],data:()=>({dataList:[],cursor:"0",has_more:!0,hasRequest:!1,searchQuery:""}),computed:{countExceed(){return(this.value&&this.value.length||0)>=this.tagLimit}},methods:{getData(t=this.searchQuery,e=this.cursor,i=10,n=1){this.has_more&&(this.hasRequest=!0,this.searchQuery=t,l({cursor:e,key_word:t,limit:i,sort_type:n}).then(t=>{const i=t.data;this.dataList="0"===e?i:this.dataList.concat(i||[]),this.cursor=t.cursor,this.has_more=t.has_more}).finally(()=>{this.hasRequest=!1}))},handleVisibleChange(t){t||this.handleSearch("")},handleSearch(t){this.fetchData(t,!0)},handleChange(t){this.$emit("change",t)},fetchMore(t){const e=t.children;this.has_more&&Object(b["d"])(e[e.length-1],t)>-100&&this.fetchData()},fetchData(t=this.searchQuery,e=!1){e&&(this.dataList=[],this.cursor="0",this.has_more=!0),this.getData(t)}},created(){this.fetchData=Object(p["a"])(this.fetchData.bind(this),300),this.fetchData()}}),C=_,y=(i("f6c2"),i("2877")),w=Object(y["a"])(C,m,g,!1,null,"b802f6ac",null),k=w.exports,x=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("Select",{staticStyle:{width:"100%"},attrs:{filterMethod:!1,multiple:"",emptyText:t.searchQuery||t.hasRequest?null:void 0,placeholder:"请搜索添加专栏，同一篇文章最多添加三个专栏",value:t.value,clearable:"",disabled:t.disabled,filterable:"","value-key":"column_id","on-dropdown-scroll":t.fetchMore},on:{"on-search":t.handleSearch,"on-change":t.handleChange,"on-dropdown-visible-change":t.handleVisibleChange},scopedSlots:t._u([{key:"noDataView",fn:function(){return[t.searchQuery||t.hasRequest?t._e():i("ColumnEmptyCard",{on:{refresh:t.fetchData}})]},proxy:!0}])},[t._l(t.dataList,(function(e,n){return i("Option",{key:e.column_id||n,attrs:{disabled:t.countExceed,label:e.column_version&&e.column_version.title||"",value:e||{}}})})),t._l(t.value,(function(t,e){return i("Option",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],key:"selected"+(t.column_id||e),attrs:{label:t.column_version&&t.column_version.title||"",value:t||{}}})}))],2)],1)},O=[],j=i("acec"),E=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container",on:{click:function(t){t.stopPropagation()}}},[n("p",{staticClass:"first-line"},[n("img",{staticClass:"icon",attrs:{src:i("41d2"),alt:"refresh"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.handleClick(e)}}})]),t._m(0)])},A=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("p",{staticClass:"content"},[t._v(" 你还没有创建任何专栏，快去 "),i("a",{attrs:{href:"/creator/content/column?action=create",target:"_blank"}},[t._v(" 创建专栏 ")]),t._v(" 吧~ ")])}],L=Object(v["defineComponent"])({setup(t,e){return{handleClick(t){e.emit("refresh",t)}}}}),S=L,T=(i("e767"),Object(y["a"])(S,E,A,!1,null,"31e37a92",null)),I=T.exports,D=Object(v["defineComponent"])({components:{Option:a["Option"],Select:a["Select"],ColumnEmptyCard:I},props:{limit:{type:Number,require:!1,default:3},value:{type:Array,require:!1,default:()=>[]},disabled:{type:Boolean,default:!1}},data:()=>({dataList:[],cursor:"0",has_more:!0,hasRequest:!1,searchQuery:""}),computed:{countExceed(){var t;return((null===(t=this.value)||void 0===t?void 0:t.length)||0)>=this.limit},userId(){return this.$store.getters.AUTH_INFO.user.user_id||""}},methods:{getData(t,e=this.cursor,i=10){this.has_more&&(this.hasRequest=!0,this.searchQuery=t,Object(j["b"])({user_id:this.userId,cursor:e,keyword:t,limit:i}).then(t=>{const i=t.data||[];this.dataList="0"===e?i:this.dataList.concat(i||[]),this.cursor=t.cursor,this.has_more=t.has_more}).finally(()=>{e!==this.cursor&&t!==this.searchQuery||(this.hasRequest=!1)}))},handleVisibleChange(t){t||this.handleSearch("")},handleSearch(t){this.fetchData(t,!0)},handleChange(t){this.$emit("change",t)},fetchMore(t){const e=t.children;this.has_more&&Object(b["d"])(e[e.length-1],t)>-100&&this.fetchData()},fetchData(t=this.searchQuery,e=!1){e&&(this.dataList=[],this.cursor="0",this.has_more=!0),this.getData(t)}},created(){this.fetchData=Object(p["a"])(this.fetchData.bind(this),300),this.fetchData()}}),$=D,N=Object(y["a"])($,x,O,!1,null,"5c289105",null),M=N.exports,U=i("59be"),P=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("button",{staticClass:"ui-btn",class:[t.type,t.size,t.status,t.cancel?"cancel":"",t.attention?"attention":""],attrs:{disabled:t.disabled||t.loading},on:{click:t.handleClick}},[t.iconSrc?i("img",{staticClass:"img",class:t.loading?"loading":"",attrs:{src:t.iconSrc}}):t._e(),t.isAttentionType?[t._v(" "+t._s(t.attentionText)+" ")]:t._t("default",[t._v(t._s(t.text))])],2)},F=[],R=i("a63d"),H=i.n(R),B=i("11f2"),V=i.n(B),q=i("7af3"),X=i.n(q),z=i("0a44"),Y=i.n(z),G=i("7ffa"),W=i.n(G),Z=Object(v["defineComponent"])({props:{type:{type:String,default:"primary"},attention:Boolean,customAttentionText:String,cancelAttentionText:String,size:{type:String,default:"medium"},status:{type:String,default:"default"},disabled:Boolean,loading:Boolean,cancel:Boolean,text:String,icon:String},setup(t,e){const i=Object(v["computed"])(()=>t.attention);return{handleClick:i=>{t.disabled||t.loading||e.emit("click",i)},isAttentionType:i,attentionText:Object(v["computed"])(()=>"mini"===t.size&&t.loading?"":t.cancel?t.loading?"取消":t.cancelAttentionText||"已关注":t.customAttentionText||"关注"),iconSrc:Object(v["computed"])(()=>t.loading?t.cancel||i.value&&"primary"!==t.type?Y.a:W.a:i.value?"mini"===t.size?"":t.icon||t.cancel?X.a:"primary"===t.type?H.a:V.a:"")}}}),K=Z,Q=(i("61e4"),Object(y["a"])(K,P,F,!1,null,"2d4f7d48",null)),J=Q.exports,tt=i("906a"),et=i("e022e"),it={components:{TagSelect:k,ColumnSelect:M,Input:a["Input"],Button:U["a"],UIButton:J,CoverSelector:tt["a"]},props:["post","disabled"],data:()=>({isSugging:!1,active:!1,categoryList:[],tagLimit:1,sync_to_org:!1,columnList:[],updating:!1,columnCheckedList:[],cursor:"0",has_more:!0,summaryLoading:!1,summaryChange:!1}),computed:{currentCategoryId(){return(this.post.category||{}).id},isDraft(){return!this.post.article_id||"0"===this.post.article_id},hasOrg(){const t=this.user&&this.user.tech_team||{};return t.org_id&&"0"!==t.org_id},actionText(){return this.isDraft?"发布":"更新"},user(){return this.$store.getters.USER},canPublish(){const t=this.user;return t&&t.phone_verified},customTagLength(){return this.post.tags.length},noColumnList(){return!this.columnList.length},userId(){return this.$store.getters.AUTH_INFO.user.user_id||""}},watch:{async active(t){if(t&&this.post.id&&!this.post.brief_content)try{this.summaryLoading=!0,this.post.brief_content=await Object(et["a"])(this.post.id),this.$nextTick(()=>{this.summaryChange=!1})}catch(e){this.$error(e)}finally{this.summaryLoading=!1}t||this.summaryChange||(this.post.brief_content="")},"post.brief_content":{handler(t){this.summaryChange=!!t},immediate:!0}},methods:{handleSummaryInput(t){this.$emit("update")},publish(){this.submit||(this.submit=Object(p["b"])(()=>{this.$emit("publish",{sync_to_org:this.sync_to_org})},500,!0)),this.submit()},handleColumnChange(t){this.$set(this.post,"columns",t)},handleTagsChange(t){this.post.tags=t}},domEvents:{click({target:t}){this.$el.contains(t)||(this.active=!1)}},created(){this.user&&(1!==this.user.builder&&1!==this.user.favorable_author&&1!==this.user.book_author||(this.tagLimit=2),1===this.user.administrator&&(this.tagLimit=5))},mounted(){f().then(t=>{this.categoryList=t})},beforeUnmout(){this.clearRef.forEach(t=>{try{t()}catch(e){console.error(e)}})}},nt=it,st=(i("895a"),Object(y["a"])(nt,n,s,!1,null,"42bd2e48",null));e["a"]=st.exports},"077c":function(t,e,i){t.exports=i.p+"img/collapse.dbb05aef.svg"},"08a6":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i(t.editor,{tag:"component",attrs:{post:t.post,status:t.status,initLoading:t.initLoading},on:{update:t.update,publish:t.publish}})},s=[],a=i("e37c"),r=i("2fd7"),o=i("3828"),c=i("88f3");const l=new r["a"];var u={components:{RichTextEditor:o["a"],MarkdownEditor:c["a"]},data:()=>({editor:null,post:null,status:"editing",initLoading:!0}),metaInfo(){const t=["写文章",(this.post||{}).title,"掘金"];return{title:t.filter(t=>t).join(" - ")}},methods:{init(){const t=this.$route.params.id;this.initLoading=!0,this.initPost(t).then(()=>this.initEditor()).catch(t=>{this.$error(t)}).finally(()=>{this.initLoading=!1})},initPost(t){return Object(a["b"])(t).then(e=>{e.entry?this.post=e:window.location.href="/editor/drafts/"+t})},initEditor(){this.post&&(this.editor="wysiwyg"===this.post.type?"RichTextEditor":"MarkdownEditor")},update(){this.status="saving",l.validate(this.post).then(()=>Object(a["a"])(this.post)).then(()=>{this.status="editing"}).catch(t=>{this.status="error",this.$error(t)})},publish(){this.status="saving",l.validate(this.post).then(()=>Object(a["e"])(this.post)).then(()=>{window.location.href=Object(a["c"])(this.post.id)}).catch(t=>{this.status="error",this.$error(t)})}},mounted(){this.init()}},d=u,h=i("2877"),f=Object(h["a"])(d,n,s,!1,null,"0841c60c",null);e["default"]=f.exports},"093c":function(t,e,i){t.exports=i.p+"img/add.0e2d17b6.svg"},"0a44":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqCAYAAADFw8lbAAAACXBIWXMAACE4AAAhOAFFljFgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAdFSURBVHgB7ZhbaF1FFIb/NXufJM2lzalJa2rFoEUpKi2KVxDjg4gv+lCiaFvwAgqiCProg/WCIOKjCuKltlqViiiCLyreKgql1QfxglrSC6Q2bZI2aXNOzt57/NfM7NOkSdrTkxzwoSvszOx9Zs98s2atNWs2cE4WVgQLIN39th0F9LDaExl02BRGBONJhDE+//PwWzKGeUrdoMs22DUs1liDm9jJpaxH7rKEBIz190YvsfibI+1MgE+ObJXfUYecNejy9fZKwm0g0FoFs+K0F1nrypjPhVfM/yaHD+Dunu12svbx0Bb56GzGrRl0+Ua7LBM8jgxrxAOKglFbJoPToteo16qfgLbjb6SM7UlwAz+pLysVPDP8geyvZfyaQLvutbcYgwfZuj0AmcwPFoVB46CxWH+fCs7SaTfLXD0SQ+3aoF2B2u4mavfDeYN2b7T91NpdQUNOG047tjpw5CDEgcU6CYLE+lzbADMuD8mxw2S4Nnj50BZ5qW7Q7g12Hen6tSvCmDC4B/aDRdVSoQwOcVJDbhIGnQRebYOWLcLEgj0DVdNQBjWPlw6+Ky+eNSghb2KnDxNQIgUkrLWuNNXlz1Bim68I9qMt45+h7TJ+aj/nrbfXRBHWsU0/vDPl2jf5ZX1kUBN65N+tsq1m0J57bFclwrMkandeLMFrxXWYw37O395nx8dRgyxdb1fGBk/w3bvpkKp9b0Ye0ANbHEsEN45slX01gVKbj/LlqwOktnG2FGZepibfObxNvkYd0r3e3i0RnmffRZs7nV8tBdaxdtBebzsjKAP5jYyT93PWDtItE+vBk8uVDM+NbpO9mIcUN9orCoLPCFcMoKY6nppUiluHtsl3U98xM3oxuJ5ay0Rf1dIiZT1lw5QdbZ4vpAqX9lf2+1Ru6wHS72iq2QhPz8SaImpHNsMlrGZ6CVwXDpha/m5oq+zAAok6DQd4DT6eOifLgnZpEn1dG2zfnKCM2tca4yBT/k+1JHjKF9MS8CkWWBKDF1ho0HcbgaAatgw5+uYEZbi+JLNek1VtChIS7xjbIkewwDK6WUaphHclJDPwPmPdjxnunBV0Zb9dxCY98MueZqpNi0Q1alL8hAYJx/h02q0NNcHazvts5wzQyVasgNekW2oG+VTrdMOUHvgXGiRJjF+m3EoIUU4KQO8MUFZaAG+X6jwJtQkPWlN2U6/o8rMYmO03pmUXVet5JamgxdmmuCsVdSJx4ONovOyZ7SH9pZjX4+pTbmiZ12Z+7xt7m220HJz1qUX1CFPVKHeKCfEen1YvqxEEHWiwMB69McvjgeZmfD0DNClhBME+3eV3ooxe2LHqMduMBsoFLdhBDT3Jcd2ux0X9lsu+7sCbjslJdenb2jB6IoP+6YZrmXhYBl29tUdGsZxN9qERssmaXQOIeg1eHRjCKy5fK+YGKLkhntTowGYpcbkH6UBJFrw/C57fBKxCg6R3AE3LU0QTvHouRLSSwb93khvAruntpu1MBPtDlz0Sn5Tktkry1atub8TyWx2/ZXIRYmZl0eAITLnbQ+Pi6ZndNNA0xl4NUVnY59XjVas09vjoMlyHBZauB9CmgNk4Q2YBplhElB6FSVnH5W41Zwcdflv2U5Nqi36vz9M91WyCK5jRXIYFkp6HbCtjdVvKXL+VmVM7y44AzO8qFpskmxNUpZLiBw36Di7ymhWfMaY8pd2w+EG7FPOVfttUSXj4K8E0VxCPxTDJMUQVTfUIPMQd/dRXZoAOvycH6Gr7MltNnJ0pUMVMvBE1lXE7jyp1O1fXHbbj/DasYDgsNC1CdDyBtCggYfWKS1zy7XJmUBWq/wua84T4WKoWb8OfguuZ/frzNtrr+PWkDbUKw5B+bUEneqiEqJmaO1EmHGFbmIuqJrXZ8CRmPSzOeVxWe+SbN1OTVu2V2VSWJl7DwSRcVGCyuqccY2DWfLXPxl2Lsah5GZZMVLCkiXriF75Et2s6aFpm1G5liq6lZqTNbRgefF1OnBWog73XXs0z+VpnBh7Y7VwuMoRY60zDIAkp4Qh/KNMNMhshZj3OU0U9c1VC6SYbh0mz7aT2VcLRke1ydC4WczpQHol3kWp3FTJziUuGkwc/1W7m7sRdHZxYkbbSyfYtsZ6AIn9O4IvCfMIU9NtT7O/5HVXY1iyJcOx0kGcEVeEHrJ9pk9+z40n1fnfAlwAGF2xtpA8VVvXN6BdzY44DYF66T2UKx4UvVAhLwMkKJx7h0IDPSU8rZ/xIlos6Do+HV3GZV6gp6NJH1ueuru7zgySVaublbDi/L3ASnENqmmgCZWTNMcYGf8MgdkmllvFrBs3l/PtsLzV3ESmWqhZF7ZNQaZ4i0hTSlGAxISvB4abapeAY7fJgrZ+C6gbNpfiQXdI0gQup4aU8kLczyKbcgp2zFRQ8CuB6Skgxzm1xmK+N1fs9v27QqdLHMLS7G4uzdgZu7jRt/EBeGkWltQOl1ftR/uYbSXBO/mfyH6MwS/hPCXhOAAAAAElFTkSuQmCC"},"0b6e":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"view index-view"})},s=[],a={mounted(){window.location.href="/editor/drafts?v=2"}},r=a,o=i("2877"),c=Object(o["a"])(r,n,s,!1,null,"7552ffae",null);e["default"]=c.exports},"0c00":function(t,e,i){},"0fd3":function(t,e,i){"use strict";var n=i("1a40"),s=i.n(n);s.a},1:function(t,e){},"11f2":function(t,e,i){t.exports=i.p+"img/add-primary.bd960fe6.svg"},1361:function(t,e,i){"use strict";var n=i("1a52"),s=i.n(n);s.a},"15b4":function(t,e,i){},1684:function(t,e,i){},1696:function(t,e,i){"use strict";var n=i("71b6"),s=i.n(n);s.a},"17d6":function(t,e,i){},"1a40":function(t,e,i){},"1a50":function(t,e,i){"use strict";var n=i("41aa"),s=i.n(n);s.a},"1a52":function(t,e,i){},"1b28":function(t,e,i){"use strict";i.d(e,"c",(function(){return D})),i.d(e,"a",(function(){return B})),i.d(e,"b",(function(){return V})),i.d(e,"d",(function(){return q}));var n,s=i("66e4"),a=i.n(s),r=i("0d96"),o=i.n(r),c=i("6443"),l=i.n(c),u=i("ec0d"),d=i.n(u),h=i("27fe"),f=i.n(h),p=i("7921"),m=i.n(p),g=i("a87e"),b=i.n(g),v=i("85be"),_=i.n(v),C=i("6644"),y=i.n(C),w=i("292c"),k=i.n(w),x=i("b84f"),O=i.n(x),j=i("64ed"),E=i("6a08"),A=i("9dc2"),L=i("913c"),S=i("9af9"),T=i("c75b");i("631c"),i("7cd2");const I=[{editorEffect({editor:t,root:e}){t.focus();const i=e.querySelector(".bytemd-help"),n=document.createElement("div");n.innerHTML='<h2>帮助</h2>\n<a style="color: #1C78F0; font-size: 13px; text-decoration: none" href="https://juejin.cn/book/6844733795329900551/section/6844733795376037895" target="_blank"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M8.74659 5.4576L5.69992 2.41093C4.8128 1.52381 3.35496 1.54335 2.44374 2.45458C1.53252 3.3658 1.51297 4.82364 2.40009 5.71076L5.04519 8.35586" stroke="#1D7DFA" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M10.9675 7.66755L13.6126 10.3127C14.4997 11.1998 14.4802 12.6576 13.569 13.5688C12.6578 14.4801 11.1999 14.4996 10.3128 13.6125L7.26613 10.5658" stroke="#1D7DFA" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M8.70295 8.71369C9.61417 7.80247 9.63371 6.34462 8.74659 5.45751" stroke="#1D7DFA" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M7.26617 7.26629C6.35495 8.17752 6.3354 9.63536 7.22252 10.5225" stroke="#1D7DFA" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n<span style="vertical-align: top; line-height: 16px; padding-left: 4px;">如何使用掘金编辑器写文章</span>\n</a>',null===i||void 0===i||i.prepend(n)}},f()(),l()({locale:S}),a()(),d()(),m()({test(t){return!0}})],D=({onLoadingChange:t,catchError:e})=>({editorEffect({editor:i}){const s=async(i,s)=>{if("paste"!==s.origin)return;const a=i.getValue(),r=[],o=Object(j["getProcessor"])({plugins:[{rehype:t=>t.use(()=>t=>{y()(t,"element",t=>{if("img"===t.tagName){const e=t.properties.src;e.includes("p-boe.byted.org")||e.includes("juejin.byteimg.com")||r.push(e)}})})}]});if(o.processSync(a),!r.length)return;t(!0);let c=!1;const l=await Promise.all(r.map(async t=>{try{const e=await Object(E["a"])(t);return e.data}catch(n){return c=!0,null}}));c&&e();let u=a;r.forEach((t,i)=>{if(l[i])if(u.includes(t))u=u.replace(t,l[i]);else try{const e=decodeURI(t);u=u.replace(e,l[i])}catch(n){e()}}),i.setValue(u),t(!1)};return i.on("change",s),()=>{i.off("change",s)}}}),$=null!==(n=window.juejinMarkdownThemes)&&void 0!==n?n:{},N=document.createElement("style"),M=document.createElement("style");function U(t="juejin"){var e,i;return null!==(i=null===(e=$[t])||void 0===e?void 0:e.style)&&void 0!==i?i:$.juejin.style}function P(t="github"){var e;return null!==(e=A[t])&&void 0!==e?e:A.github}let F,R;document.head.appendChild(N),document.head.appendChild(M);const H={viewerEffect({file:t}){var e,i;return N.innerHTML=U(null===(e=t.frontmatter)||void 0===e?void 0:e["theme"]),M.innerHTML=P(null===(i=t.frontmatter)||void 0===i?void 0:i["highlight"]),()=>{N.innerHTML="",M.innerHTML=""}},actions:[{icon:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path d="M6 2H2.66667C2.29848 2 2 2.29848 2 2.66667V6C2 6.36819 2.29848 6.66667 2.66667 6.66667H6C6.36819 6.66667 6.66667 6.36819 6.66667 6V2.66667C6.66667 2.29848 6.36819 2 6 2Z" stroke="#1D2129" stroke-width="1.33" stroke-linejoin="round"/>\n      <path d="M6 9.3335H2.66667C2.29848 9.3335 2 9.63197 2 10.0002V13.3335C2 13.7017 2.29848 14.0002 2.66667 14.0002H6C6.36819 14.0002 6.66667 13.7017 6.66667 13.3335V10.0002C6.66667 9.63197 6.36819 9.3335 6 9.3335Z" stroke="#1D2129" stroke-width="1.33" stroke-linejoin="round"/>\n      <path d="M13.3334 2H10C9.63185 2 9.33337 2.29848 9.33337 2.66667V6C9.33337 6.36819 9.63185 6.66667 10 6.66667H13.3334C13.7016 6.66667 14 6.36819 14 6V2.66667C14 2.29848 13.7016 2 13.3334 2Z" stroke="#1D2129" stroke-width="1.33" stroke-linejoin="round"/>\n      <path d="M13.3334 9.3335H10C9.63185 9.3335 9.33337 9.63197 9.33337 10.0002V13.3335C9.33337 13.7017 9.63185 14.0002 10 14.0002H13.3334C13.7016 14.0002 14 13.7017 14 13.3335V10.0002C14 9.63197 13.7016 9.3335 13.3334 9.3335Z" stroke="#1D2129" stroke-width="1.33" stroke-linejoin="round"/>\n      </svg>\n',title:"Markdown 主题",handler:{type:"dropdown",actions:[...Object.keys($).map(t=>({title:t,handler:{type:"action",click({editor:e}){const{data:i,content:n}=_()(e.getValue());i.theme=t;const{top:s}=e.getScrollInfo();e.setValue(_.a.stringify(n,i)),e.scrollTo(null,s),e.focus()},mouseenter(){F=N.innerHTML,N.innerHTML=U(t)},mouseleave(){N.innerHTML=F}}})),{title:"贡献主题",handler:{type:"action",click(){window.open("https://github.com/xitu/juejin-markdown-themes")}}}]}},{icon:'<?xml version="1.0" encoding="UTF-8"?><svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="48" height="48" fill="white" fill-opacity="0.01"/><path d="M6 44L6 25H12V17H36V25H42V44H6Z" fill="none" stroke="#333" stroke-width="4" stroke-linejoin="round"/><path d="M17 17V8L31 4V17" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>',title:"代码高亮样式",handler:{type:"dropdown",actions:Object.keys(A).map(t=>({title:t,handler:{type:"action",click({editor:e}){const{data:i,content:n}=_()(e.getValue());i.highlight=t;const{top:s}=e.getScrollInfo();e.setValue(_.a.stringify(n,i)),e.scrollTo(null,s),e.focus()},mouseenter(){R=M.innerHTML,M.innerHTML=P(t)},mouseleave(){M.innerHTML=R}}}))}}]},B=[...I,o()({locale:L,katexOptions:{output:"html"}}),b()({locale:T}),H],V=[...I,o()({locale:L,katexOptions:{output:"html"}}),{viewerEffect:H.viewerEffect}],q=[...I,{remark:t=>t.use(O.a),rehype:t=>t.use(()=>t=>{y()(t,"element",(t,e,i)=>{const n=t.properties;if(n.className&&n.className.includes("math")){const s=t.children[0].value;n.className.includes("math-inline")?i.children.splice(e,1,k()("img",{className:["equation"],src:`https://${window.location.host}/equation?tex=${encodeURIComponent(s)}`,alt:s.replace(/"/g,"&quot;")})):n.className.includes("math-display")&&i.children.splice(e,1,k()("figure",[k()("img",{className:["equation"],src:`https://${window.location.host}/equation?tex=${encodeURIComponent(s)}`,alt:s.replace(/"/g,"&quot;")})]))}})})}]},"1b8d":function(t,e,i){"use strict";i.r(e);var n=i("7c64");const s="auth/UPDATE_STATE";e["default"]={state:{userId:null,clientId:null,token:null,user:null},getters:{[n["AUTH_INFO"]]:t=>t,[n["USER"]]:t=>t.user},mutations:{[s](t,e){Object.assign(t,e)}},actions:{[n["SET_AUTH_INFO"]]({commit:t},e){t(s,e)}}}},"1c8b":function(t,e,i){},"1ec1":function(t,e,i){},2:function(t,e){},"231f":function(t,e,i){},"24c0":function(t,e,i){"use strict";const n={init(){(function(t,e,i,n,s,a,r){t["GoogleAnalyticsObject"]=s,t[s]=t[s]||function(){(t[s].q=t[s].q||[]).push(arguments)},t[s].l=1*new Date,a=e.createElement(i),r=e.getElementsByTagName(i)[0],a.async=1,a.src=n,r.parentNode.insertBefore(a,r)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),window.ga("create","UA-57015356-3")},exec(...t){window.ga||this.init(),window.ga.apply(window,t)}};e["a"]=n},"24da":function(t,e,i){},"250c":function(t,e,i){"use strict";var n=i("7db0"),s=i.n(n);s.a},"268c":function(t,e,i){"use strict";var n=i("80e9"),s=i.n(n);s.a},"2c25":function(t,e,i){"use strict";var n=i("4cc5"),s=i.n(n);s.a},"2df9":function(t,e,i){"use strict";var n=i("f8ff"),s=i.n(n);s.a},"2e106":function(t,e,i){"use strict";var n=i("1c8b"),s=i.n(n);s.a},"2f0d":function(t,e,i){var n={"./locale":"c020","./locale.js":"c020"};function s(t){var e=a(t);return i(e)}function a(t){if(!i.o(n,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n[t]}s.keys=function(){return Object.keys(n)},s.resolve=a,t.exports=s,s.id="2f0d"},"2fd7":function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n=i("ea37"),s=i("cecb");class a{validate(t){return Promise.resolve().then(()=>this.checkCategory(t)).then(()=>this.checkTags(t)).then(()=>this.checkTitle(t)).then(()=>this.checkSummary(t)).then(()=>this.checkMarkdown(t)).then(()=>this.checkHttpImage(t))}checkCategory(t){return t.category&&t.category.id&&"0"!==t.category.id?Promise.resolve():Promise.reject(new r("请选择一个分类"))}checkTags(t){return t.tags.length>0?Promise.resolve():Promise.reject(new r("至少添加一个标签"))}checkTitle(t){return(t.title||"").trim()?Promise.resolve():Promise.reject(new r("标题不能为空"))}checkSummary(t){return(t.brief_content||"").trim().length>=50?Promise.resolve():Promise.reject(new r("摘要不满足最低50字的要求"))}checkMarkdown(t){return(t.markdown||"").trim()?Promise.resolve():Promise.reject(new r("内容不能为空"))}checkWordCount(t){const e=Object(n["a"])(t.html);return e&&e>s["b"]?Promise.reject(new r(`文章超出${s["b"]}字数限制`)):Promise.resolve()}checkHttpImage(t){const e=/<img[^>]*\bsrc="http:/.test(t.html||"");if(e){const t="图片地址必须为 HTTPS，请转存或替换内容中的非法图片地址";return Promise.reject(new r(t))}return Promise.resolve()}}class r extends Error{}},"33f7":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"view"},[t.bookInfo?i("BookEditor",{attrs:{status:t.status},on:{update:t.update,publish:t.publish}}):t._e()],1)},s=[],a=i("964c"),r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.loadedSectionContent?i("div",{staticClass:"book-edit-view"},[i("EditorHeader",{ref:"header",attrs:{"section-html":t.sectionInfo,status:t.status},on:{titleSubmit:t.onTitleSubmit,update:t.requestUpdate,publish:t.publish}}),i("div",{staticClass:"edit-wrap"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.summaryExtended,expression:"summaryExtended"}],ref:"directory",staticClass:"directory-box"},[i("router-link",{staticClass:"summary",attrs:{tag:"div",to:t.toSummary}},[t._v(" 小册介绍 ")]),i("EditorDirectory",{staticClass:"editor-directory",on:{deleteSection:t.init}})],1),i("Editor",{staticClass:"edit-box",attrs:{value:t.markdown,plugins:t.plugins,locale:t.locale,uploadImages:t.uploadImages},on:{change:t.handleChange}})],1),t.imageLoading?i("ImageUploadProgressPanel",{attrs:{text:"图片解析中...",allowCancel:!1}}):t._e()],1):t._e()},o=[],c=i("c34c"),l=i("cecb"),u=i("6a08"),d=i("3dc0"),h=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("header",{staticClass:"book-header"},[i("TitleInput",{staticClass:"title-input",attrs:{value:t.baseInfo.title},on:{input:t.onTitleUpdate,submit:function(e){return t.$emit("titleSubmit")}}}),i("div",{staticClass:"right-box"},[i("StatusText",{staticClass:"status-text with-padding",attrs:{status:t.status}}),i("Button",{attrs:{outline:""},nativeOn:{click:function(e){return t.goToDraft(e)}}},[t._v("草稿箱")]),i("PublishPopup",{staticClass:"with-padding",attrs:{baseInfo:t.baseInfo},on:{publish:t.publish,updatePrice:t.updatePrice,updateIsFinished:t.updateIsFinished,updateFinishedAt:t.updateFinishedAt,updateProfile:t.updateProfile,updateDesc:t.updateDesc,updateCategoryId:t.updateCategoryId,updateXiaoceDraft:t.updateXiaoceDraft}}),i("MainNavigator")],1)],1)},f=[],p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("input",{directives:[{name:"model",rawName:"v-model",value:t.innerValue,expression:"innerValue"}],ref:"input",staticClass:"title-input",attrs:{placeholder:"输入小册标题...",spellcheck:"false",maxlength:t.maxlength},domProps:{value:t.innerValue},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.$emit("submit")},input:function(e){e.target.composing||(t.innerValue=e.target.value)}}})},m=[],g=(i("3bba"),{props:["value"],data:()=>({maxlength:100,innerValue:""}),watch:{value:{handler(t,e){this.innerValue=t},immediate:!0},innerValue(t,e){this.$emit("input",t)}},mounted(){}}),b=g,v=(i("f1ba"),i("2877")),_=Object(v["a"])(b,p,m,!1,null,"53907846",null),C=_.exports,y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"main-image-selector",class:{active:t.active,unset:t.unset,updating:t.updating}},[i("div",{staticClass:"toggle-btn",on:{click:function(e){t.active=!t.active}}},[i("svg",{attrs:{width:"26",height:"26",viewBox:"0 0 30 30",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[i("path",{attrs:{d:"M24.375 3.75H5.625C4.58947 3.75 3.75 4.58947 3.75 5.625V24.375C3.75 25.4105 4.58947 26.25 5.625 26.25H24.375C25.4105 26.25 26.25 25.4105 26.25 24.375V5.625C26.25 4.58947 25.4105 3.75 24.375 3.75Z",stroke:"currentColor","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"}}),i("path",{attrs:{d:"M11.25 14.375C12.9759 14.375 14.375 12.9759 14.375 11.25C14.375 9.52411 12.9759 8.125 11.25 8.125C9.52411 8.125 8.125 9.52411 8.125 11.25C8.125 12.9759 9.52411 14.375 11.25 14.375Z",stroke:"currentColor","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"}}),i("path",{attrs:{d:"M17.3688 16.387C17.879 15.7042 18.908 15.721 19.3956 16.4202L24.8798 24.285C25.4576 25.1137 24.8647 26.25 23.8544 26.25H10L17.3688 16.387Z",stroke:"currentColor","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"}})])]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.active,expression:"active"}],staticClass:"panel"},[i("div",{staticClass:"title"},[t._v("添加小册封面")]),i("div",{staticClass:"size"},[t._v("建议 650*910（ png 格式）")]),i("button",{directives:[{name:"show",rawName:"v-show",value:t.unset,expression:"unset"}],staticClass:"select-btn",attrs:{disabled:t.updating},on:{click:t.selectImageFile}}),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.unset,expression:"!unset"}],staticClass:"preview-box"},[i("img",{staticClass:"preview-image",attrs:{src:t.thumbUrl}}),i("button",{staticClass:"delete-btn",attrs:{title:"移除这张图片"},on:{click:t.deleteImage}},[i("i",{staticClass:"ion-trash-a"})])])]),i("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"file",attrs:{type:"file"},on:{change:function(e){return t.onFileSelected(e)}}})])},w=[],k=i("5c91"),x={props:["info"],data:()=>({active:!1,updating:!1}),computed:{unset(){return!this.info.cover_img},prompt(){return this.updating?"封面设置中...":"点击此处添加图片"},thumbUrl(){const t=this.info.cover_img;return t?Object(k["b"])(t,480,480):""}},methods:{selectImageFile(){this.$refs.file.click()},onFileSelected({target:t}){const e=t.files[0];e&&(this.$refs.file.value=null,this.changeMainImage(e))},changeMainImage(t){return this.updating=!0,Object(u["b"])(this.info.user_id,[t]).then(t=>{this.info.cover_img=t[0]&&t[0].Url,this.info.change_field="cover_img",this.updating=!1}).catch(t=>{t.message=t.message||"头图设置失败",this.$error(t),this.updating=!1})},deleteImage(){this.info.cover_img=null,this.info.change_field="cover_img"}},domEvents:{click({target:t}){this.$el.contains(t)||(this.active=!1)}}},O=x,j=(i("d265"),Object(v["a"])(O,y,w,!1,null,"34dc5b60",null)),E=j.exports,A=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"publish-popup",class:{active:t.active,disabled:t.disabled}},[n("Button",{nativeOn:{click:function(e){t.active=!t.disabled&&!t.active}}},[t._v(" "+t._s(t.actionText)+" ")]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.active,expression:"active"}],staticClass:"panel"},[n("div",{staticClass:"title"},[n("span",[t._v(t._s(t.actionText))]),n("img",{attrs:{src:i("4208"),alt:""},on:{click:t.closePopper}})]),n("div",{staticClass:"summary-box"},[t._m(0),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.summary,expression:"summary"}],ref:"summaryTextarea",staticClass:"summary-textarea",attrs:{placeholder:"摘要将显示在小册详情页标题的下方，建议 100 字以内","max-length":"100"},domProps:{value:t.summary},on:{input:function(e){e.target.composing||(t.summary=e.target.value)}}})]),n("div",{staticClass:"category-box"},[t._m(1),n("div",{staticClass:"category-list"},t._l(t.categoryList,(function(e){return n("div",{key:e.id,staticClass:"item",class:{active:t.currentCategoryId===e.category_id},on:{click:function(i){return t.updateCategory(e)}}},[t._v(" "+t._s(e.category_name)+" ")])})),0)]),n("div",{staticClass:"upload"},[n("div",{staticClass:"xiaoce-title"},[t._v("小册封面")]),t.picUnset?n("button",{staticClass:"select-btn",attrs:{disabled:t.updating},on:{click:t.selectImgFile}},[t._m(2)]):t._e(),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.picUnset,expression:"!picUnset"}],staticClass:"preview-box"},[n("img",{staticClass:"preview-image",attrs:{src:t.thumbUrl,alt:""}}),n("button",{staticClass:"delete-btn",attrs:{title:"移除这张图片"},on:{click:function(e){return e.stopPropagation(),t.deleteImage(e)}}},[n("i",{staticClass:"ion-trash-a"})])])]),n("label",{staticClass:"line-confirmation"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.consent,expression:"consent"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.consent)?t._i(t.consent,null)>-1:t.consent},on:{change:function(e){var i=t.consent,n=e.target,s=!!n.checked;if(Array.isArray(i)){var a=null,r=t._i(i,a);n.checked?r<0&&(t.consent=i.concat([a])):r>-1&&(t.consent=i.slice(0,r).concat(i.slice(r+1)))}else t.consent=s}}}),n("div",{staticClass:"txt"},[n("span",[t._v("我已阅读同意")]),n("span",{staticClass:"agreement",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.explainVisible("agreement")}}},[t._v(" 《掘金小册写作线上协议》 ")])])]),n("label",{staticClass:"line-confirmation"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.isFinished,expression:"isFinished"}],attrs:{disabled:t.completed,type:"checkbox"},domProps:{checked:Array.isArray(t.isFinished)?t._i(t.isFinished,null)>-1:t.isFinished},on:{change:function(e){var i=t.isFinished,n=e.target,s=!!n.checked;if(Array.isArray(i)){var a=null,r=t._i(i,a);n.checked?r<0&&(t.isFinished=i.concat([a])):r>-1&&(t.isFinished=i.slice(0,r).concat(i.slice(r+1)))}else t.isFinished=s}}}),t._m(3)]),n("div",{staticClass:"last-line"},[n("button",{staticClass:"cancel-btn",on:{click:t.closePopper}},[t._v("取消")]),n("button",{staticClass:"publish-btn",attrs:{disabled:t.submitDisabled},on:{click:t.publish}},[t._v(" "+t._s(t.actionText)+" ")])])]),t.explainType?n("Explain",{attrs:{type:t.explainType},on:{close:function(e){t.explainType=""}}}):t._e(),t.visibleIsFinished?n("BookComplete",{on:{ok:t.ok,cancel:t.cancel}}):t._e(),n("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"file",attrs:{type:"file"},on:{change:function(e){return t.onFileSelected(e)}}})],1)},L=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"sub-title"},[n("img",{attrs:{src:i("a6fd"),alt:""}}),t._v(" 摘要 ")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"sub-title"},[n("img",{attrs:{src:i("a6fd"),alt:""}}),t._v(" 分类 ")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"button-slot"},[n("img",{attrs:{src:i("093c"),alt:""}}),n("div",{staticClass:"upload-pic"},[t._v("点击上传图片")]),n("div",{staticClass:"addvice"},[t._v("建议尺寸：650*910px")]),n("div",{staticClass:"addvice"},[t._v("png格式")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"txt"},[i("span",[t._v("所有章节已完成")])])}],S=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"masker"},["earnings"==t.type?i("div",{staticClass:"earnings"},[i("div",{staticClass:"heading"},[t._v(" 收益与结算 "),i("span",{staticClass:"close",on:{click:function(e){return e.stopPropagation(),t.close(e)}}},[t._v("+")])]),i("div",{staticClass:"content"},[t._v(" 你的小册收益 ＝ 销量 × ( 单价 - 折扣 ) × 70% * 推广折扣：在推广期会有不同的优惠折扣，结算将按照折扣后的单价进行结算； * 结算日期：在所有章节写作完成后，每月 10 日进行结算； * 手续费：结账时会去除支付平台的手续费 0.6%； ")])]):t._e(),"agreement"==t.type?i("div",{staticClass:"agreement"},[i("div",{staticClass:"heading"},[t._v(" 掘金小册平台写作线上协议 "),i("span",{staticClass:"close",on:{click:function(e){return e.stopPropagation(),t.close(e)}}},[t._v("+")])]),i("div",{staticClass:"content",domProps:{innerHTML:t._s(t.agreement)}})]):t._e()])},T=[];const I='本协议系由北京北比信息技术有限公司（以下简称“北比”）与所有通过掘金小册平台发布作品的主体（以下简称“作者”）就资源的引入、使用及相关服务所订立的有效合约，所有作者必须同意并遵守本协议。作者通过作者发布程序阅读本协议并点击"同意"按钮或以任何方式参与数字作品提交均被视为作者完全接受本协议。\n\n一、总则\n1.1 本协议内容包括掘金小册与作者（线上）协议及所有北比已经发布的或将来可能发布的各类规则。所有规则为本协议不可分割的组成部分，与协议正文具有同等法律效力。\n1.2 双方承诺接受并遵守本协议的约定。本协议一经勾选“我已阅读并同意”后生效，北比有权随时对协议内容进行修订，修订后的协议将公布于掘金小册平台上，作者继续使用掘金小册，则视为对修订后的协议不持任何异议并同意遵守；如作者对协议存在异议，可以向北比书面提出退出掘金小册，但作者在北比确认其退出许可前的行为，仍受本协议约束。\n\n二、定义\n2.1 “掘金小册平台”（以下简称“掘金小册”）：是指由北比所有并运营的数字作品引入平台及各类客户端软件，供掘金小册的作者和用户发布或查询、使用数字作品。\n2.2 “数字作品”： 指作者通过掘金小册向用户提供的电子图书、文字作品、交流活动文字整理、图片、电子杂志，电子报纸、音频、视频等各类数字化作品，以及与数字作品相关的内容。就文字作品而言，包括标题、正文、附注等内容。\n2.3 “用户”：是指在掘金小册浏览、阅读、下载等使用数字作品的互联网用户和移动互联网用户。\n2.4 “注册”：是指作者登录掘金小册，按要求填写相关信息，在线申请其服务账户的过程。注册的作者必须是拥有合法的数字作品的实体，如作者违反本协议有关作者的规定或超越其民事权利能力或民事行为能力范围的，则本协议自始无效，一经发现，北比有权立即注销其服务账户，并追究其违约使用掘金小册服务的法律责任。\n\n三、平台模式\n3.1 北比向作者提供掘金小册及相关服务，使作者得以通过掘金小册发布数字作品及相关信息并接受用户对数字作品的浏览、阅读、下载或其他使用需求。\n3.2 自本协议生效后，作者免费授权北比在掘金小册上免费使用作者提供的数字作品，包括但不限于将作者数字作品在掘金小册上进行上传、复制、传输、通过信息网络传播、推广，供用户以搜索、浏览、阅读或者下载等方式使用；并授权北比将作者数字作品基于互联网或无线互联网形式面向全球用户进行推广。\n3.3 作者在未得到北比许可的情况下，不得授权第三方以任何形式传播作者在掘金小册上发布的数字作品。本规定在数字作品发布之日起一年后自动失效。\n\n四、所有权与知识产权\n北比保留对以下各项内容、信息完全的、不可分割的所有权及知识产权:\n（1）掘金小册及其所有组成元素，包括但不限于所有内容、数据、技术、软件、代码、用户界面以及与其相关的任何衍生作品；\n（2）作者向掘金小册提供的与该平台服务相关的任何信息及反馈（不包含作者向掘金小册提供的数字作品）。\n\n五、作者的权利与义务\n5.1 作者保证拥有所提供数字作品的完整版权与有效授权，有权授权北比在掘金小册上以本协议约定的方式使用授权作品。\n（1）对于非作者自有权利的数字作品，作者应当获得权利人的有效授权，确保作者有权通过掘金小册上传、复制、传输、通过信息网络传播、推广该等数字作品。作者确保其获得的授权可以使北比合法地通过掘金小册推广和按约使用数字作品。作者应自行向权利人支付可能存在的许可费用、版税以及其它应缴费用以获取权利人的有效授权。\n（2）对于作者自有权利的数字作品，作者签署本协议即代表作者免费授权北比通过掘金小册推广和按约使用数字作品，包括但不限于将数字作品存储于掘金小册提供的存储空间和通过掘金小册进行信息网络传播等。\n5.2 作者保证其所提供的全部作品（包括作品封面、图片、目录、正文内容、视频等）及在掘金小册上传的全部信息符合中国法律、法规及国家政策的规定，不含任何违法、违规内容。\n5.3 作者免费授予北比拥有全部授权作品及相关信息的信息网络传播权。根据上述授权，北比有权将作者授权使用的数字作品基于互联网或无线互联网在掘金小册及北比其它产品上进行传播或推广。\n5.4 作者保证本协议的签署和履行并不侵犯任何第三方权益，也不会被任何第三方追索；作者保证提供的数字作品不存在任何权利瑕疵，没有侵犯任何第三方的合法权益；作者对所提供数字作品资源内容的真实性、准确性、完整性、合法性等负完全责任；如北比被第三方主张权利而产生任何纠纷、仲裁、诉讼，或遭到国家相关部门处理，由作者出面解决，承担全部法律责任并使北比免责，并赔偿因上述原因给北比造成的全部直接和间接损失。\n5.5 作者应妥善保管自己的服务账户及密码信息，因作者自身原因丢失账户、密码或其他重要信息等，作者自行承担一切不利后果。严禁作者以任何形式擅自转让或授权他人使用自己的服务账户，一经发现，北比有权立即封禁该服务账户，并有权终止向作者提供本协议约定的服务而无须承担违约责任。\n5.6 作者承诺并完全同意：作者对其数字作品的上传、存储、传播等环节产生的后果独立承担全部法律责任。\n5.7 未经北比事先许可，作者不得在数字作品发布之日起一年内授予第三方传播其数字作品的权利。\n5.8 未经北比事先书面同意，作者不得使用北比的名义进行任何以营利为目的的商业活动或任何可能对北比的品牌造成不利影响的活动。\n5.9 未经北比事先书面许可，作者不得擅自删除、下线、中断或关闭其已向掘金小册提供的授权数字作品。\n5.10 如因作者提供给的数字作品的版权到期或作者权利授权方原因等导致该数字作品需要下线的，作者应提前30天以书面形式通知北比后，方可对相应数字作品进行下线处理。\n\n六、掘金小册的权利与义务\n6.1 北比负责对作者授权作品及相关信息在掘金小册及其它展示终端上的运营业务提供相关的技术支持与维护服务。\n6.2 北比可以根据国家法律法规及相关政策的规定，制定北比及掘金小册各项管理制度，对作者授权数字作品在掘金小册的上传、存储、通过信息网络传播、使用等行为进行规范；同时，对于违反国家法律、法规、规范性文件规定及其他不符合北比或掘金小册要求的数字作品，北比有权禁止该作品在掘金小册或其它北比产品上进行发布或展示。\n6.3 出于为用户提供更好阅读体验以及使作者作品在掘金小册上得到更好展示的目的，北比有权对作者授权在掘金小册上展示的数字作品的格式进行加工和制作及销售数字作品的权利。\n6.4 出于宣传或推广的目的，北比有权在授权范围内免费使用作者数字作品的片段（不超过原作品内容的30%）、作品名称、作品插图等，并授权北比及其关联公司对作者数字作品进行全文内容检索。同时，北比可为履行本协议目的，在掘金小册和其他媒介使用作者的商标、标识等知识产权，以说明作者参与本协议项下的情况。\n6.5 对于第三方侵犯本协议项下数字作品的侵权行为，作者授权北比有权独立采取包括但不限于诉讼、仲裁等各种法律手段维护自身的合法权益并获取相应收益，维权行为所发生的费用由北比独自承担。\n6.6 由于作者与第三方就数字作品版权出现争议导致阅读开放平台必须对该作品下线的，北比可予以配合，但作者应承担由此产生的全部责任以及给北比造成的全部损失。\n6.7 如作者数字作品或相关业务违反本协议约定，或造成掘金小册系统严重负担，或不符合北比或掘金小册相关制度规则，或其他有损北比或掘金小册利益的，北比有权不予上线或通知作者移除相关内容，作者应在接到通知后立刻移除，北比也可以不经通知自行移除数字作品，无需承担任何违约责任。\n6.8 本协议到期后，如作者并未主动下线或删除掘金小册上的数字作品，视为作者授权北比在平台上继续按本协议约定的方式使用其数字作品，授权期限直至作者主动删除或下线数字作品为止。\n\n七、隐私\n7.1 在收集、使用、共享或存储与任何用户相关的所有数据（包括但不限于任何用户信息）时，作者同意实施并遵守所适用的隐私和保密标准，这些标准至少与北比隐私政策中阐明的标准同等严格和对用户有利。\n7.2 为保护用户的隐私，并使用户能够控制对其数据隐私设置的访问，禁止作者将其访问或收集的与掘金小册用户相关的任何数据提供给任何第三方。作者据此同意遵守并且不以任何方式避开由北比设定的所有此类数据访问限制和用户选择的任何隐私设置。\n7.3 在北比提出要求时，作者应立即向北比提供相关用户信息，以便:\n(1)保护或维护北比或掘金小册或其员工、代理商等的合法权利或财产；\n(2)保护掘金小册服务的用户或公众的安全（包括在紧急情况下采取相应措施）；\n(3)防止欺诈行为或实现风险管理目的；\n(4)执行相关政府主管部门的要求、规定、命令等；\n(5)遵守法律或法定程序。\n\n八、信息披露与保密\n8.1 作者与北比关于重大信息的披露、采用、表述等均应获得双方的一致认可。作者可以宣传其已与掘金小册的事实与情况，但未经过北比事先书面同意，不得发布使用任何含有北比名称、商标、logo、标记等的新闻稿、其他宣传声明或推广材料。出于宣传或推广目的，北比有权发布、提及或描述掘金小册、掘金小册授权数字作品或作者的宣传和推广材料。\n8.2 北比或作者对于因签署或履行本协议而了解或接触到的对方的商业秘密及其他保密资料和信息（以下简称“保密信息”）均应保守秘密。除非国家法律法规、政府或者法院的要求，或者本协议双方同意，任何一方不得向任何第三方泄露、给予或转让该等保密信息。\n除为实现本协议项下约定之目的所必须外，未经对方事先书面同意，任何一方不得擅自使用、复制或擅自向任何第三方授权使用、授权复制对方的商标、标志、商业信息、技术及其他资料等。\n8.3 本保密条款不因本协议的无效、被撤销、解除、提前终止、不具操作性等而失效。\n\n九、免责声明\n9.1 本协议项下掘金小册将在现有技术的基础上尽最大努力提供相应的安全措施以保障服务安全和正常运行。但掘金小册明确声明对服务不作任何明示或暗示的保证，包括但不限于对服务的安全性、可靠性、持续性、准确性、适用于某一特定用途等。作者签署本协议即意味着理解且不要求北比或掘金小册在以下任一情况下承担责任：\n（1）不可抗力。不可抗力是指本协议双方不能合理控制、不可预见或即使预见亦无法避免的事件，包括但不限于政府行为、地震、台风、洪水、火灾或其它天灾、战争或任何其它类似事件。\n（2）鉴于互联网之特殊性质，不可抗力亦包括但不限于下列影响互联网正常运行之情形：\n（a）黑客攻击；\n（b）电信部门技术调整导致之重大影响；\n（c）因政府管制而造成之暂时关闭；\n（d）病毒侵袭；\n（e）网站升级、系统停机维护或通讯终端、电信设备出现故障导致无法进行数据传输；\n（f）其他非因双方原因导致互联网无法正常运行、服务中断或延迟之情形。\n（3）如发生不可抗力事件，遭受该事件的一方应立即以可能的最快捷的方式通知另一方该事件的性质、发生日期、预计持续时间等有关细节，以及该事件阻碍通知方履行其于本协议项下义务的程度。\n（4）在不可抗力事件持续期间，遭受不可抗力事件的一方应定期及时地告知另一方不可抗力事件的现状。如不可抗力事件结束，应立即以书面形式通知对方，并继续履行其于本协议项下之义务。\n（5）遭受不可抗力事件的一方应当向另一方提供事件发生地区的公证机构(或其他适当机构)出具的证实不可抗力事件的合法证明。\n（6）如果不可抗力事件持续超过九十（90）天，任何一方均可按本协议11.1之规定终止本协议。\n（7）本协议任何一方违约后遭遇不可抗力的，违约责任不因不可抗力而免除。\n9.2 北比有权在提前通知或不通知的情况下随时修改、限制、暂停或终止全部或部分掘金小册服务，对于此等修改、限制、暂停或终止行为，北比对作者或任何第三方不负任何责任。\n9.3 北比及其关联公司仅向作者及用户提供技术平台以便作者得以向通过信息网络传播、推广其授权数字作品，不对作者或用户的任何口头、书面陈述或者其向掘金小册上传的任何信息之真实性、合法性做任何担保，或对此承担任何责任。北比与掘金小册不对作者与用户之间达成的或涉及的法定义务或约定义务承担任何责任。北比与掘金小册亦无义务参与与数字作品使用有关的任何理赔、纠纷处理等活动。如因数字作品或其使用产生纠纷的，作者应以自己的名义独立承担所有法律责任。\n9.4 北比没有义务为作者保存其存储于掘金小册中的数据以及作者使用掘金小册产生的任何数据。作者应自行对相关数据进行定期保存。作者如因数据丢失造成损失或产生其他责任，北比及掘金小册均不负责承担。\n9.5 在任何情况下，北比、掘金小册及其董事、员工或代理人，均不负责对作者或任何第三方就任何法定或约定之损害承担责任，即使北比或掘金小册已经知道或已被告知发生了上述损害或上述损害发生的可能性。\n\n十、违约责任\n10.1 除本合同另有约定外，任何一方违反本合同约定的，应赔偿因此给另一方造成的经济损失。\n10.2 因作者所提供的数字作品存在权利瑕疵或侵犯任何第三方的合法权益、内容违法违规等导致北比或掘金小册损失或陷入诉讼、争议，或者受到国家有关部门的查处或处罚，应视为作者根本违约，由作者出面解决并承担全部责任。同时，北比有权单方解除本协议，终止提供本协议约定的服务。因此给北比造成损失的，作者应负责赔偿北比的全部损失，包括直接损失与其他合理损失。\n10.3 若双方均违反本协议之约定，则应当各自承担相应的责任。\n\n十一、协议期限与终止\n11.1 协议终止：发生以下任何事件时，经书面通知对方，任何一方均可立即终止本协议：\n（一）一方严重违反本协议，且对于可补救的违约，未在收到对方书面通知后三十（30）天内予以补救；\n（二）一方严重违约致使不能实现合同目的；\n（三）一方破产、无力偿债、进入清算或解散程序、不再从事业务或不能清偿到期债务；\n（四）按本协议第9.1条之约定，不可抗力事件发生并持续超过九十（90）天。\n';var D={props:["type"],data:()=>({agreement:I}),methods:{close(){this.$emit("close")}},mounted(){}},$=D,N=(i("6a2e"),Object(v["a"])($,S,T,!1,null,"68554f33",null)),M=N.exports,U=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"masker"},[i("div",{staticClass:"dialog"},[i("div",{staticClass:"heading"},[t._v("确认所有章节写作已完成")]),i("div",{staticClass:"context"},[t._v(" 勾选“所有章节已完成”后，将会取消“预售”标记，并将所有文章展示给购买用户。 ")]),i("div",{staticClass:"footer"},[i("div",{staticClass:"cancel",on:{click:function(e){return e.stopPropagation(),t.cancel(e)}}},[t._v("取消")]),i("div",{staticClass:"ok",on:{click:function(e){return e.stopPropagation(),t.ok(e)}}},[t._v("确定")])])])])},P=[],F={methods:{ok(){this.$emit("ok")},cancel(){this.$emit("cancel")}},mounted(){}},R=F,H=(i("d87f"),Object(v["a"])(R,U,P,!1,null,"3b5264b9",null)),B=H.exports,V=i("59be"),q=i("7e48"),X={components:{BookComplete:B,Explain:M,Button:V["a"]},props:["baseInfo","disabled"],data:()=>({explainType:"",active:!1,visibleIsFinished:!1,completed:!1,consent:!0,finishedAt:"",profile:"",summary:"",price:"",categoryList:[],isFinished:!1,updating:!1}),computed:{submitDisabled(){return this.disabled||!this.consent},isPublish(){return 0===this.baseInfo.status},actionText(){return this.isPublish?"提交审核":"更新"},currentCategoryId(){return this.baseInfo.category_id},picUnset(){return!this.baseInfo.cover_img},thumbUrl(){const t=this.baseInfo.cover_img;return t?Object(k["b"])(t,480):""}},watch:{baseInfo:{handler(t){this.category_id=t.category_id,this.summary=t.summary,this.isFinished=t.is_finished,t.is_finished&&(this.completed=!0)},immediate:!0},isFinished(t){t?this.visibleIsFinished=!0:this.$emit("updateIsFinished",!1)},summary(t,e){t.length>100?(this.$alert("字数超出限制"),this.summary=e):this.$emit("updateDesc",t)},currentCategoryId(t){this.$emit("updateCategoryId",t)}},methods:{updateCategory(t){this.baseInfo.category_id=t.category_id,this.$emit("updateXiaoceDraft")},ok(){this.visibleIsFinished=!1,this.$emit("updateIsFinished",!0)},cancel(){this.visibleIsFinished=!1,this.isFinished=!1,this.$emit("updateIsFinished",!1)},explainVisible(t){this.explainType=t},publish(){this.baseInfo.title.trim()?this.$emit("publish"):this.$alert("请先填写标题")},selectImgFile(){this.$refs.file.click()},onFileSelected({target:t}){const e=t.files[0];e&&(this.$refs.file.value=null,this.changeMainImage(e))},changeMainImage(t){return this.updating=!0,Object(u["b"])(this.baseInfo.user_id,[t]).then(t=>{this.baseInfo.cover_img=t[0]&&t[0].Url,this.baseInfo.change_field="cover_img"}).catch(t=>{t.message=t.message||"封面设置失败",this.$error(t)}).finally(()=>{this.updating=!1})},deleteImage(){this.baseInfo.cover_img=null,this.baseInfo.change_field="cover_img"},closePopper(){this.active=!1}},domEvents:{click({target:t}){this.$el.contains(t)||(this.active=!1)}},mounted(){Object(q["f"])().then(t=>{this.categoryList=t,this.baseInfo.category_id&&"0"!==this.baseInfo.category_id||(this.baseInfo.category_id=z(t).category_id)})}};function z(t){return t.filter(t=>"article"===t.category_url)[0]||t[0]}var Y=X,G=(i("bfd0"),Object(v["a"])(Y,A,L,!1,null,"5410a4e0",null)),W=G.exports,Z=i("8bb0"),K=i("e0a3"),Q={components:{TitleInput:C,StatusText:Z["a"],Poster:E,PublishPopup:W,MainNavigator:K["a"],Button:V["a"]},props:["sectionHtml","status"],computed:{info(){return this.$store.state.draft},baseInfo(){return this.info.booklet_draft}},methods:{goToDraft(){window.open("/editor/drafts?type=xiaoce")},updateXiaoceDraft(){this.$emit("update")},updateIsFinished(t){this.baseInfo.is_finished=t?1:0,this.baseInfo.change_field="is_finished"},updateFinishedAt(t){this.baseInfo.finishedAt=t},updatePrice(t){this.baseInfo.price=t},updateProfile(t){this.baseInfo.profile=t},updateDesc(t){this.baseInfo.summary=t,this.baseInfo.change_field="summary"},updateCategoryId(t){this.baseInfo.category_id=t,this.baseInfo.change_field="category_id"},onTitleUpdate(t){this.baseInfo.title=t,this.baseInfo.change_field="title"},publish(){this.$emit("publish")}}},J=Q,tt=(i("250c"),Object(v["a"])(J,h,f,!1,null,"76b58ad5",null)),et=tt.exports,it=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"editor-footer",class:{extended:t.extended}},[n("button",{staticClass:"ctrl-btn summary-btn",attrs:{title:t.summaryExtended?"点击隐藏章节目录":"点击恢复章节目录"},on:{click:t.toggleSummaryLayout}},[n("pre",[t._v(t._s(t.summaryExtended))]),n("img",{directives:[{name:"show",rawName:"v-show",value:t.summaryExtended,expression:"summaryExtended"}],staticClass:"icon",attrs:{src:i("d24a")}}),n("img",{directives:[{name:"show",rawName:"v-show",value:!t.summaryExtended,expression:"!summaryExtended"}],staticClass:"icon",attrs:{src:i("d45d")}})]),n("button",{staticClass:"ctrl-btn shotcut-btn"},[n("img",{staticClass:"icon",attrs:{src:i("be86")}}),n("ShotcutPanel",{staticClass:"shotcut-panel"})],1),n("button",{staticClass:"ctrl-btn upload-image-btn",attrs:{title:"点击上传图片"},on:{click:t.uploadImage}},[n("img",{staticClass:"icon",attrs:{src:i("045f")}})]),n("button",{staticClass:"ctrl-btn toggle-layout-btn",attrs:{title:t.extended?"点击恢复预览区":"点击隐藏预览区"},on:{click:t.toggleLayout}},[n("img",{directives:[{name:"show",rawName:"v-show",value:t.extended,expression:"extended"}],staticClass:"icon",attrs:{src:i("077c")}}),n("img",{directives:[{name:"show",rawName:"v-show",value:!t.extended,expression:"!extended"}],staticClass:"icon",attrs:{src:i("cdb2")}})])])},nt=[],st=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},at=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"shotcut-panel"},[i("span",{staticClass:"panel-title"},[t._v("快捷键")]),i("a",{staticClass:"more-link",attrs:{href:"/book/5c90640c5188252d7941f5bb/section/5c9066395188252d71681c5d",target:"_blank"}},[t._v(" 更多语法 ")]),i("table",{staticClass:"shotcut-table"},[i("thead",[i("tr",[i("th",[t._v("Markdown")]),i("th",[t._v("结果")]),i("th",[t._v("快捷键")])])]),i("tbody",[i("tr",[i("td",[t._v("# 标题")]),i("td",[t._v("H1")]),i("td")]),i("tr",[i("td",[t._v("## 标题")]),i("td",[t._v("H2")]),i("td",[t._v("Ctrl / ⌘ + H")])]),i("tr",[i("td",[t._v("**文本**")]),i("td",[i("b",[t._v("粗体")])]),i("td",[t._v("Ctrl / ⌘ + B")])]),i("tr",[i("td",[t._v("[描述](http://)")]),i("td",[i("a",[t._v("链接")])]),i("td",[t._v("Ctrl / ⌘ + K")])]),i("tr",[i("td",[t._v("`code`")]),i("td",[i("code",[t._v("Inline Code")])]),i("td",[t._v("Ctrl / ⌘ + Shift + K")])]),i("tr",[i("td",[t._v("```code```")]),i("td",[i("pre",[t._v("Code")])]),i("td",[t._v("Ctrl / ⌘ + Shift + C")])]),i("tr",[i("td",[t._v("![alt](http://)")]),i("td",[t._v("图片")]),i("td",[t._v("Ctrl / ⌘ + Shift + I")])]),i("tr",[i("td",[t._v("* item")]),i("td",[t._v("列表")]),i("td",[t._v("Ctrl / ⌘ + Shift + L")])])])])])}],rt=(i("268c"),{}),ot=Object(v["a"])(rt,st,at,!1,null,"137daaa3",null),ct=ot.exports,lt={components:{ShotcutPanel:ct},computed:{summaryExtended(){return"extended"===this.$store.getters.XIAOCE_SUMMARY_LAYOUT},extended(){return"extended"===this.$store.getters.XIAOCE_LAYOUT}},methods:{toggleSummaryLayout(){this.$store.dispatch(this.$store.types.TOGGLE_XIAOCE_SUMMARY_LAYOUT)},toggleLayout(){this.$store.dispatch(this.$store.types.TOGGLE_XIAOCE_LAYOUT)},uploadImage(){this.$emit("uploadImage")}}},ut=lt,dt=(i("2df9"),Object(v["a"])(ut,it,nt,!1,null,"02414ea8",null)),ht=dt.exports,ft=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"editor-directory"},[i("draggable",{ref:"list",staticClass:"list",class:{dragging:t.dragging},attrs:{id:"list",element:"div",options:t.dragOptions,move:t.onMove},on:{start:t.draggingStart,update:t.draggingUpdate},model:{value:t.listArr,callback:function(e){t.listArr=e},expression:"listArr"}},[i("transition-group",{staticClass:"list-transition",attrs:{type:"transition",name:"list",tag:"div"}},t._l(t.listArr,(function(e,n){return i("item",{key:n,attrs:{section:e,index:n,activeIndex:t.activeIndex},on:{setFreeSection:t.setFreeSection,setFinished:t.setFinished,changeSection:t.changeSection,updateActiveIndex:t.onUpdateActiveIndex}})})),1)],1),i("button",{staticClass:"btn-section",on:{click:function(e){return e.stopPropagation(),t.changeSection(null,t.listArr.length,"add")}}},[t._v(" 添加章节 ")]),t.isHedingType?i("HeadingPopup",{attrs:{type:t.hedingType,heading:t.sectionHeading,order:t.headingIndex},on:{update:t.updateHeading,delete:t.deleteHeading,add:t.addHeading,cancel:function(e){t.hedingType=null}}}):t._e()],1)},pt=[],mt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"section-item"},[n("router-link",{staticClass:"item",attrs:{tag:"div",to:t.routeXiaoce(t.section)}},[n("div",{staticClass:"item-cont"},[n("div",{staticClass:"order"},[t._v(t._s(t.index+1)+".")]),n("div",{staticClass:"title"},[n("div",{staticClass:"text"},[t._v(t._s(t.section.draft_title||t.defaultText))]),t.section.is_free?n("div",{staticClass:"to-read"},[t._v("试读")]):t._e()])]),n("div",{staticClass:"bar"},[n("img",{attrs:{src:i("bf5f")}})]),n("div",{staticClass:"more"},[n("div",{staticClass:"toggle-btn",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.toggleVisibleDropdown(t.index)}}},[n("img",{attrs:{src:i("8aea")}})])]),t.confirmComplete?n("SectionDone",{on:{ok:t.ok,cancel:t.cancel}}):t._e()],1),n("div",{directives:[{name:"show",rawName:"v-show",value:t.activeIndex===t.index,expression:"activeIndex === index"}],staticClass:"menu"},[n("span",[t._v(t._s(t.index))]),n("div",{on:{click:function(e){return e.stopPropagation(),t.changeSection(t.section,t.index,"update")}}},[t._v(" 修改标题 ")]),t.section.is_free?t._e():n("div",{on:{click:function(e){return e.stopPropagation(),t.setFreeSection(t.section,t.index,1)}}},[t._v(" 设置为试读 ")]),t.section.is_free?n("div",{on:{click:function(e){return e.stopPropagation(),t.setFreeSection(t.section,t.index,0)}}},[t._v(" 取消试读 ")]):t._e(),n("div",[n("label",[n("span",[t._v("本章节已完成")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.section.status,expression:"section.status"}],staticClass:"check",attrs:{type:"checkbox",disabled:t.checked},domProps:{checked:Array.isArray(t.section.status)?t._i(t.section.status,null)>-1:t.section.status},on:{change:function(e){var i=t.section.status,n=e.target,s=!!n.checked;if(Array.isArray(i)){var a=null,r=t._i(i,a);n.checked?r<0&&t.$set(t.section,"status",i.concat([a])):r>-1&&t.$set(t.section,"status",i.slice(0,r).concat(i.slice(r+1)))}else t.$set(t.section,"status",s)}}})])]),n("div",{on:{click:function(e){return e.stopPropagation(),t.changeSection(t.section,t.index,"delete")}}},[t._v("删除")])])],1)},gt=[],bt=i("8690"),vt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"masker"},[i("div",{staticClass:"dialog"},[i("div",{staticClass:"heading"},[t._v("确认章节写作完成")]),i("div",{staticClass:"context"},[t._v(" 标记本章节完成后，将会给用户发送更新通知，通知只可发送一次，并且不可撤销，请谨慎操作。 ")]),i("div",{staticClass:"footer"},[i("div",{staticClass:"cancel",on:{click:function(e){return e.stopPropagation(),t.cancel(e)}}},[t._v("取消")]),i("div",{staticClass:"ok",on:{click:function(e){return e.stopPropagation(),t.ok(e)}}},[t._v("确定")])])])])},_t=[],Ct={methods:{ok(){this.$emit("ok")},cancel(){this.$emit("cancel")}}},yt=Ct,wt=(i("fa05"),Object(v["a"])(yt,vt,_t,!1,null,"5163d350",null)),kt=wt.exports,xt={props:["section","index","activeIndex"],data:()=>({defaultText:"小册章节标题",confirmComplete:!1,checked:!1}),components:{SectionDone:kt},watch:{"section.status"(t){!0===t?this.confirmComplete=!0:!1===t&&this.$emit("setFinished",this.section,this.index,0)}},methods:{ok(){this.confirmComplete=!1,this.$emit("updateActiveIndex",null),this.$emit("setFinished",this.section,this.index,1)},cancel(){this.confirmComplete=!1,this.section.status=0,this.$emit("updateActiveIndex",null),this.$emit("setFinished",this.section,this.index,0)},routeXiaoce(t){let e=this.$route.name,i=this.$route.params.id,n=t.section_id,s={name:e,params:{id:i,sectionId:n}};return s},toggleVisibleDropdown(t){this.$emit("updateActiveIndex",this.activeIndex===t?null:t)},changeSection(t,e,i){this.$emit("changeSection",t,e,i),this.toggleVisibleDropdown(e)},setFreeSection(t,e,i){this.$emit("setFreeSection",t,e,i),this.toggleVisibleDropdown(e)}},mounted(){this.checked=1===this.section.status,this.removeEventListener=Object(bt["g"])(document,"click",t=>{this.$emit("updateActiveIndex",null)})},beforeDestroy(){this.removeEventListener()}},Ot=xt,jt=(i("d56c"),Object(v["a"])(Ot,mt,gt,!1,null,"c834015a",null)),Et=jt.exports,At=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"heading-popup"},[i("div",{staticClass:"heading-box"},[t.headingTypeIsDelete?t._e():i("div",{staticClass:"title"},[t._v("输入章节标题")]),t.headingTypeIsDelete?i("div",{staticClass:"title"},[t._v("删除章节")]):t._e(),t.headingTypeIsDelete?i("div",{staticClass:"heading-input"},[t._v(" 此操作将删除该章节的内容，不可恢复，确定删除吗? ")]):i("div",{staticClass:"heading-input"},[i("div",{staticClass:"order"},[t._v(t._s(t.order+1)+".")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.headingObj.draft_title,expression:"headingObj.draft_title"}],ref:"headingInput",domProps:{value:t.headingObj.draft_title},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.check(e)},input:function(e){e.target.composing||t.$set(t.headingObj,"draft_title",e.target.value)}}})]),i("div",{staticClass:"heading-bar"},[i("button",{staticClass:"cancel",on:{click:t.cancel}},[t._v("取消")]),i("button",{staticClass:"submit",on:{click:t.check}},[t._v("确定")])])])])},Lt=[],St={props:["type","heading","order"],data:()=>({headingObj:{draft_title:"",section_id:null}}),computed:{headingTypeIsDelete(){return"delete"===this.type}},watch:{"headingObj.draft_title"(t,e){t.length>100&&(this.$alert("字数超出限制"),this.headingObj.draft_title=e)}},methods:{check(){let t=this.type;"update"===t?this.$emit("update",this.headingObj):"delete"===t?this.$emit("delete",this.headingObj):this.$emit("add",this.headingObj)},cancel(){this.$emit("cancel")}},mounted(){this.headingTypeIsDelete||this.$refs.headingInput.focus(),this.headingObj=Object.assign(this.headingObj,this.heading)}},Tt=St,It=(i("de99"),Object(v["a"])(Tt,At,Lt,!1,null,"5905329c",null)),Dt=It.exports,$t=i("1516"),Nt=i.n($t);const Mt="draft/UPDATE_STATE";var Ut={components:{draggable:Nt.a,Item:Et,HeadingPopup:Dt},data:()=>({activeIndex:null,dragging:!1,hedingType:null,sectionHeading:null,headingIndex:0,canMove:!0,editable:!1,delayedDragging:!1,isDragging:!1}),computed:{info(){return this.$store.state.draft},listArr:{get(){return this.info.sections.filter(t=>null!==t)},set(t){return t}},isHedingType(){return this.hedingType},bookId(){return this.$route.params.id},dragOptions(){return{draggable:".section-item",handle:".bar",animation:150,group:"description",ghostClass:"ghost"}}},watch:{isDragging(t){this.delayedDragging=!0,this.$nextTick(()=>{this.delayedDragging=!1})}},methods:{updateState(t){this.$store.commit(Mt,{...this.info,...t})},onUpdateActiveIndex(t){this.activeIndex=t},setFreeSection(t,e,i){Object(q["i"])({section_id:t.section_id,is_free:i,change_field:"is_free"}).then(n=>{this.listArr[e]={...t,is_free:i},this.updateState({sections:this.listArr})}).catch(t=>{this.$alert(t)})},setFinished(t,e,i){Object(q["i"])({section_id:t.section_id,status:i,change_field:"status"}).then(n=>{this.listArr[e]={...t,status:i},this.updateState({sections:this.listArr})}).catch(t=>{this.$alert(t)})},changeSection(t,e,i){this.sectionHeading=t,this.headingIndex=e,this.hedingType=i},deleteHeading(t){this.hedingType=null;let e=this.handleleSectionInfo("del",t);Object(q["i"])({...e,status:-1,change_field:"status"}).then(t=>{this.listArr.splice(this.headingIndex,1);let e=this.bookId;this.$store.commit(Mt,{...this.info,sections:[...this.listArr]}),this.$router.push({name:"bookEditor",params:{id:e}}),this.$emit("deleteSection")})},addHeading(t){this.hedingType=null;let e=this.handleleSectionInfo("add",t);Object(q["a"])(e).then(t=>{e={...e,...t},this.listArr.push(e),this.$store.commit(Mt,{...this.info,sections:[...this.listArr]}),this.$router.replace({params:{sectionId:e.section_id}})})},updateHeading(t){this.hedingType=null;let e=this.handleleSectionInfo("update",t);Object(q["i"])({...e,change_field:"title"}).then(e=>{this.listArr.splice(this.headingIndex,1,t),this.$store.commit(Mt,{...this.info,sections:[...this.listArr]})})},handleleSectionInfo(t,e){let i=this.bookId,n=e.draft_title,s=e.section_id,a=e.is_free||0,r=e.status||0,o={};return"add"===t?o={booklet_id:i,title:n,status:r}:"update"===t?o={section_id:s,title:n,is_free:a}:"del"===t&&(o={booklet_id:i,section_id:s,status:r}),o},draggingStart(){this.dragging=!0},draggingUpdate(t){this.dragging=!1;let e=this.bookId;const{newIndex:i,oldIndex:n}=t,s=this.listArr.splice(n,1)[0];this.listArr.splice(i,0,s);let a=this.listArr.map(t=>t.section_id);a.unshift(this.info.introduction.section_id),a=a.join("|"),this.canMove=!1,Object(q["h"])({booklet_id:e,section_ids:a,change_field:"section_ids"}).then(t=>{this.canMove=!0,this.updateState({sections:this.listArr})}).catch(()=>{this.canMove=!0})},onMove(){return this.canMove}},created(){}},Pt=Ut,Ft=(i("6eb1"),Object(v["a"])(Pt,ft,pt,!1,null,"e6029bfc",null)),Rt=Ft.exports,Ht=i("1b28"),Bt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"preview-footer"},[i("div",{staticClass:"title"},[t._v("预览")]),i("div",{staticClass:"word-count"},[t._v(t._s(t.displayWordCount))])])},Vt=[],qt={props:["wordCount"],computed:{displayWordCount(){return this.wordCount?this.wordCount+" 字":"字数"}}},Xt=qt,zt=(i("f1da"),Object(v["a"])(Xt,Bt,Vt,!1,null,"c40dbd8c",null)),Yt=zt.exports,Gt=i("64ed"),Wt=i("ea37"),Zt=i("6b53"),Kt=i("a295"),Qt={components:{EditorHeader:et,EditorDirectory:Rt,Editor:d["Editor"],EditorFooter:ht,MainNavigator:K["a"],PreviewFooter:Yt,ImageUploadProgressPanel:Zt["a"]},data(){const t=this;return{imageLoading:!1,sectionInfo:null,loadedSectionContent:!1,plugins:[...Ht["b"],{editorEffect:({editor:t})=>{this.cm=t}},Object(Ht["c"])({onLoadingChange(e){t.imageLoading=e},catchError(){t.$error("图片地址解析失败")}})],markdown:""}},props:["status"],computed:{locale(){return Kt},info(){return this.$store.state.draft},wordCount(){return Object(Wt["b"])(this.markdown)},bookId(){return this.$route.params.id},sectionId(){return this.$route.params.sectionId},summaryExtended(){return"extended"===this.$store.getters.XIAOCE_SUMMARY_LAYOUT},isDraft(){return!this.info.isPublish},toSummary(){let t="summary";return{params:{sectionId:t}}},notNeedConfirmedUpdate(){return[this.info.booklet_draft.title,this.info.booklet_draft.cover_img,this.info.booklet_draft.summary,this.info.booklet_draft.summaryHtml,this.info.booklet_draft.is_finished]}},watch:{$route(){this.getXiaoceSection()},markdown(){this.requestSectionUpdate()},notNeedConfirmedUpdate(){this.requestUpdate()}},methods:{async uploadImages(t){const e=await Object(u["b"])("",t);return e.map(t=>({url:t.Url}))},onTitleSubmit(){},handleChange(t){this.markdown=t},sectionUpdate(){const t=this.sectionId,e=this.markdown,i=Object(Gt["getProcessor"])({plugins:Ht["d"]}).processSync(e).toString();Object(q["i"])({section_id:"summary"===t?this.info.introduction.section_id:t,content:i,markdown_content:e,change_field:"content"}).then(t=>{0!==t.err_no&&this.$error(t.err_msg||"请稍后再试")})},handleUpdate(){},async fileHandler(t){const e=await Object(u["b"])("",[t]);return e[0].Url},getXiaoceSection(){let t="summary"===this.sectionId?this.info.introduction.section_id:this.sectionId;Object(q["e"])({section_id:t}).then(t=>{const e=t.section,{markdown_content:i,draft_content:n}=e;this.sectionInfo=e,this.loadedSectionContent=!0,this.$nextTick(()=>{this.markdown=i})}).catch(()=>{this.loadedSectionContent=!0}).finally(()=>{this.cm&&this.cm.focus()})},init(){this.sectionId||this.$router.push({name:"bookEditor",params:{id:this.bookId,sectionId:"summary"}}),this.getXiaoceSection()},update(){this.$emit("update")},publish(){this.$emit("publish")},updateInfo(t){this.$emit("updateInfo",t)}},created(){this.requestUpdate=Object(c["a"])(()=>{this.update()},l["a"]),this.requestSectionUpdate=Object(c["a"])(()=>{this.sectionUpdate()},l["a"])},mounted(){this.$store.state;this.init()}},Jt=Qt,te=(i("a86c"),i("bc2f"),i("7a82"),i("feb3"),Object(v["a"])(Jt,r,o,!1,null,"0222af5f",null)),ee=te.exports;i("e37c");const ie="## 作者介绍\n\n## 小册介绍\n\n## 你会学到什么？ \n\n## 适宜人群\n\n## 购买须知\n\n1. 本小册为图文形式内容服务，共计 N 节；\n2. 全部文章预计 x 月 x 日更新完成；\n3. 购买用户可享有小册永久的阅读权限；\n4. 购买用户可进入小册微信群，与作者互动；\n5. 掘金小册为虚拟内容服务，一经购买成功概不退款；\n6. 掘金小册版权归北京北比信息技术有限公司所有，任何机构、媒体、网站或个人未经本网协议授权不得转载、链接、转贴或以其他方式复制发布/发表，违者将依法追究责任；\n7. 在掘金小册阅读过程中，如有任何问题，请邮件联系 xiaoce@xitu.io",ne="draft/UPDATE_STATE";var se={components:{BookEditor:ee},data:()=>({bookInfo:null,summaryDefaultText:ie,status:""}),computed:{xiaoceInfo(){return this.$store.state.draft}},methods:{init(){const t=this.$route.params.id;this.initXiaoce(t);let e=a["a"]("xiaoceLayout"),i=a["a"]("xiaoceSummaryLayout");e||this.$store.dispatch(this.$store.types.TOGGLE_XIAOCE_LAYOUT),i||this.$store.dispatch(this.$store.types.TOGGLE_XIAOCE_SUMMARY_LAYOUT)},initXiaoce(t){"new"===t?this.addXiaoce():this.getXiaoce()},addXiaoce(){Object(q["b"])().then(t=>{let{booklet_id:e}=t;this.$router.replace({params:{id:e}})}).then(t=>{this.init()})},getXiaoce(){const t=this.$route.params.id;Object(q["c"])({booklet_id:t}).then(t=>{this.$store.commit(ne,t),this.bookInfo=t})},update(){this.status="saving";const{booklet_draft:t}=this.bookInfo;return Object(q["h"])(t).then(()=>{this.status="editing"}).catch(t=>{this.status="error",this.$error(t)})},publish(){this.status="saving";const{booklet_draft:t}=this.bookInfo;Object(q["g"])(t).then(()=>{this.status="editing";let e=t.booklet_id;window.location.href="/book/"+e}).catch(t=>{this.status="error",this.$error(t)})}},metaInfo(){return{title:"写小册 - 掘金"}},preFetch(t){},mounted(){this.init()},beforeDestroy(){}},ae=se,re=(i("759c"),Object(v["a"])(ae,n,s,!1,null,"547f6410",null));e["default"]=re.exports},3595:function(t,e,i){"use strict";var n=i("95c6"),s=i.n(n);s.a},"35ea":function(t,e,i){t.exports=i.p+"img/add.0e2d17b6.svg"},"37c5":function(t,e,i){},3803:function(t,e,i){},3828:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"rich-text-editor",attrs:{"st:block":"richTextEditor"}},[i("EditorHeader",{ref:"header",attrs:{guided:t.guided,post:t.post,status:t.status},on:{publish:t.publish}}),i("div",{staticClass:"main"},[i("TitleInput",{staticClass:"title-input",on:{submit:t.onTitleSubmit},model:{value:t.post.title,callback:function(e){t.$set(t.post,"title",e)},expression:"post.title"}}),i("div",{ref:"content",staticClass:"rich-text-editor-content"})],1),i("CodeLangSelector",{ref:"codeLangSelector",on:{update:t.updatePost}}),i("LinkDialog",{ref:"linkDialog",on:{update:t.updateLink}}),t.isImageUploading?i("ImageUploadProgressPanel",{on:{cancel:t.cancelImageUpload}}):t._e(),i("ImageSizeAlert",{ref:"imageSizeAlert"})],1)},s=[],a=(i("e022e"),i("705e")),r=i("c34c"),o=i("8690"),c=i("cecb"),l=i("6a08"),u=i("673f"),d=i.n(u),h=i("7a61"),f=i("c901");i("77f5");class p{constructor(){Object.assign(this,{text:"输入正文...",hideOnClick:!0})}}i("6f6b");const m=800;class g{constructor(){Object.assign(this,{allowMultiParagraphSelection:!0,firstButtonClass:"medium-editor-button-first",lastButtonClass:"medium-editor-button-last",relativeContainer:document.body,standardizeSelectionStart:!1,static:!0,updateOnEmptySelection:!0,buttons:[{name:"formatBold",aria:"",contentDefault:'<i class="bold-icon icon"></i>',attrs:{"data-tooltip":"粗体（⌘ + B）","data-tooltip-delay":m,"data-shotcut":"command + b, ctrl + b"}},{name:"italic",aria:"",contentDefault:'<i class="italic-icon icon"></i>',attrs:{"data-tooltip":"斜体（⌘ + I）","data-tooltip-delay":m,"data-shotcut":"command + i, ctrl + i"}},{name:"underline",aria:"",contentDefault:'<i class="underline-icon icon"></i>',attrs:{"data-tooltip":"下划线（⌘ + U）","data-tooltip-delay":m,"data-shotcut":"command + u, ctrl + u"}},{name:"h2",aria:"",contentDefault:'<i class="h1-icon icon"></i>',attrs:{"data-tooltip":"标题一","data-tooltip-delay":m}},{name:"h3",aria:"",contentDefault:'<i class="h2-icon icon"></i>',attrs:{"data-tooltip":"标题二","data-tooltip-delay":m}},{name:"quote",aria:"",contentDefault:'<i class="quote-icon icon"></i>',attrs:{"data-tooltip":"引语","data-tooltip-delay":m}},{name:"formatHighlight",aria:"",contentDefault:'<i class="highlight-icon icon"></i>',attrs:{"data-tooltip":"代码块","data-tooltip-delay":m}},{name:"formatCode",aria:"",contentDefault:'<i class="code-icon icon"></i>',attrs:{"data-tooltip":"行内代码","data-tooltip-delay":m}},{name:"formatUnorderedList",aria:"",contentDefault:'<i class="unordered-list-icon icon"></i>',attrs:{"data-tooltip":"无序列表","data-tooltip-delay":m}},{name:"formatOrderedList",aria:"",contentDefault:'<i class="ordered-list-icon icon"></i>',attrs:{"data-tooltip":"有序列表","data-tooltip-delay":m}},{name:"formatLink",aria:"",contentDefault:'<i class="link-icon icon"></i>',attrs:{"data-tooltip":"链接（⌘ + K）","data-tooltip-delay":m,"data-shotcut":"command + k, ctrl + k"}},{name:"uploadImage",aria:"",contentDefault:'<i class="upload-image-icon icon"></i>',attrs:{"data-tooltip":"插入图片","data-tooltip-delay":m}}]})}}class b{constructor(){Object.assign(this,{tagList:["img","svg"]})}}const v={PRE:{excludeActionList:["formatHighlight"]}};class _{constructor(){Object.assign(this,{interceptor(t,e,i){C(e)&&(t.preventDefault(),t.stopPropagation())}})}}function C(t){const e=w(y(),Object.keys(v)),i=v[e];return!(!i||!i.excludeActionList)&&-1===i.excludeActionList.indexOf(t)}function y(){const t=window.getSelection();return t.rangeCount?t.getRangeAt(0).endContainer:null}function w(t,e){while(t){if(-1!==e.indexOf(t.nodeName))return t.nodeName;t=t.parentNode}return null}class k{constructor(){Object.assign(this,{interceptor(t){const e=x(),i=O(e);if(i)return e.isFocusOnEnd?this.pasteHTML("\n\n"):this.pasteHTML("\n"),!1}})}}function x(){const t=window.getSelection();if(!t.rangeCount)return null;const e=t.getRangeAt(0),i=e.endContainer;return i.isFocusOnEnd=3===i.nodeType&&i.length===e.endOffset,i}function O(t){while(t){if("PRE"===t.nodeName)return t;t=t.parentNode}return null}var j=i("8896");class E{constructor(t){this.maxSize=t.maxSize,this.validTypeList=t.validTypeList}validate(t){return this.checkSize(t).then(()=>this.checkType(t))}checkSize(t){return this.maxSize&&t.size>this.maxSize?Promise.reject(new A(this.maxSize)):Promise.resolve()}checkType(t){return this.validTypeList?Object(j["a"])(t,this.validTypeList).then(t=>{if(!t)return Promise.reject(new L(this.validTypeList))}):Promise.resolve()}}class A extends Error{constructor(t){if(super(),t){const e=Math.floor(t/1024/1024*100)/100;this.message=`图片文件过大，最大支持 ${e} MB`}else this.message="图片文件过大";this.type="size"}}class L extends Error{constructor(t){super(),this.message=`仅支持 ${t.join(" | ")} 格式的图片`,this.type="type"}}class S extends E{constructor(){super({maxSize:5242880,validTypeList:["jpg","png","gif","webp"]})}}class T{constructor(){Object.assign(this,{validate:t=>(new S).validate(t)})}}class I{constructor(){Object.assign(this,{cleanAttrs:[],doPaste(t,e){const i=this.base.getExtensionByName("clipboard");i.handlePaste(t,e)}})}}class D{constructor(){Object.assign(this,{spellcheck:!1,anchorPreview:!1,imageDragging:!1,keyboardCommands:!1,placeholder:new p,toolbar:new g,clickSelect:new b,buttonInterceptor:new _,newLineInterceptor:new k,uploadImage:new T,paste:new I})}}i("15b4");var $=d.a.Extension.extend({name:"toolbarTooltip",init(){d.a.Extension.prototype.init.apply(this,arguments),this.initToolbarTooltip()},initToolbarTooltip(){this.on(document.body,"mouseenter",(function({target:t}){F(t)&&N(t)}),!0),this.on(document.body,"mouseleave",(function({target:t}){F(t)&&M(t)}),!0)}});function N(t){const e=window.setTimeout((function(){const e=U(t);if(!e)return;const i=R(e);document.body.appendChild(i),H(i,t),t._releaseTooltip=function(){i.parentNode.removeChild(i)}}),P(t));t._releaseTooltip=function(){window.clearTimeout(e)}}function M(t){t._releaseTooltip&&t._releaseTooltip()}function U(t){return t.getAttribute("data-tooltip")}function P(t){return t.getAttribute("data-tooltip-delay")||0}function F(t){return t.classList.contains("medium-editor-action")}function R(t){const e=document.createElement("div");return e.classList.add("medium-editor-action-tooltip"),e.appendChild(document.createTextNode(t)),e}function H(t,e){const i=e.getBoundingClientRect(),n=i.left+i.width/2,s=i.bottom;t.style.left=n+"px",t.style.top=s+"px",t.classList.add("active")}var B=d.a.extensions.button.extend({name:"uploadImage",action:"uploadImage",contentDefault:"<b>IMG</b>",inputElement:null,uploadTask:null,validate:()=>Promise.resolve(),init(){d.a.Extension.prototype.init.apply(this,arguments),Object.assign(this,this.getEditorOption(this.name)),Object.assign(this,this.getButtonOption()),d.a.extensions.button.prototype.init.apply(this,arguments),this.initUploadImage()},initUploadImage(){this.prepareInputElement(),this.subscribeCancelEvent(),this.initDropEventListener()},destroy(){this.inputElement.parentNode.removeChild(this.inputElement)},getButtonOption(){return((this.getEditorOption("toolbar")||{}).buttons||[]).filter(t=>t.name===this.name)[0]},subscribeCancelEvent(){this.subscribe("cancelImageUpload",()=>{this.uploadTask&&this.uploadTask.abort()})},initDropEventListener(){this.on(document,"drop",t=>{t.preventDefault();const e=t.dataTransfer.files[0];e&&this.uploadImageFile(e)},!0),this.on(document,"dragover",t=>{t.preventDefault(),t.dataTransfer.dropEffect="copy"},!0)},prepareInputElement(){const t=document.createElement("input");t.setAttribute("type","file"),t.style.display="none",document.body.appendChild(t),this.inputElement=t,this.on(t,"change",({target:t})=>{const e=t.files[0];e&&(t.value=null,this.uploadImageFile(e))})},handleClick(){this.openFileDialog()},openFileDialog(){this.inputElement.click()},uploadImageFile(t){Object(l["b"])("",[t]).then(t=>{const e=t[0]&&t[0].Url;this.addImageToContent(e),this.trigger("imageUploadSuccess",e)}).catch(t=>{t.message=t.aborted?"上传已取消":t.message||"图片上传失败",this.trigger("imageUploadFailed",t)})},validateImageFile(t){return this.validate(t).then(()=>t)},isFocus(){return!!this.base.getFocusedElement()},addImageToContent(t){const e=`<p><img src="${t}"><br></p>`;this.isFocus()?(this.base.execAction("insertHTML","<p><br></p>"),this.base.pasteHTML(e),this.base.execAction("insertHTML","<p><br></p>")):this.base.setContent(this.base.getContent()+e)}}),V=d.a.Extension.extend({name:"clickSelect",init(){d.a.Extension.prototype.init.apply(this,arguments),this.initClickSelect()},initClickSelect(){const t=(this.getEditorOption(this.name)||{}).tagList;t&&t.length&&this.getEditorElements().forEach(e=>{this.on(e,"click",e=>{q(e.target,t)&&(e.preventDefault(),this.selectElement(e.target))},!0)})},selectElement(t){const e=window.getSelection(),i=document.createRange();i.selectNode(t),e.removeAllRanges(),e.addRange(i)}});function q(t,e){return-1!==e.indexOf(t.tagName.toLowerCase())}var X=d.a.Extension.extend({name:"state",init(){d.a.Extension.prototype.init.apply(this,arguments),this.subscribe("checkState",this.check.bind(this))},check(){this.base.checkContentChanged(),this.base.getExtensionByName("toolbar").checkState()}}),z=d.a.Extension.extend({name:"buttonInterceptor",interceptor(){},init(){d.a.Extension.prototype.init.apply(this,arguments),this.initButtonInterceptor()},initButtonInterceptor(){this.applyOption(),this.addEventListener()},applyOption(){Object.assign(this,this.getEditorOption(this.name))},addEventListener(){this.on(document.body,"click",this.clickHandler.bind(this),!0)},clickHandler(t){const e=Y(t.target,this.getEditorId()),i=e?e.getAttribute("data-action"):null;e&&this.interceptor.call(this.base,t,i,e)}});function Y(t,e){const i=document.getElementById("medium-editor-toolbar-"+e);while(t){if(G(t,i))return t;t=t.parentNode}return null}function G(t,e){return t.classList&&t.classList.contains("medium-editor-action")&&e.contains(t)}var W=d.a.Extension.extend({name:"newLineInterceptor",interceptor(){},init(){d.a.Extension.prototype.init.apply(this,arguments),this.initNewLineInterceptor()},initNewLineInterceptor(){this.applyOption(),window.setTimeout(this.wrapEventListener.bind(this))},applyOption(){Object.assign(this,this.getEditorOption(this.name))},wrapEventListener(){const t=this.base.events.customEvents.editableKeydownEnter,e=t[0];e&&(t[0]=t=>{if(!1!==this.interceptor.call(this.base,t))return e.call(this.base,t);t.preventDefault()})}}),Z=d.a.Extension.extend({name:"blankLine",init(){d.a.Extension.prototype.init.apply(this,arguments),this.enabled()&&this.initKeepBlankLine()},enabled(){const t=this.getEditorOption(this.name);return!1!==t},initKeepBlankLine(){this.subscribe("editableKeyup",this.handleChange.bind(this)),this.subscribe("editablePaste",this.handleChange.bind(this))},handleChange(){this.getEditorElements().forEach(t=>{const e=K(t),i=e.length,n=t.children.length===i;if(0!==i){if(i>1&&n){const i=e[0];e.slice(1).forEach(e=>{t.removeChild(e)}),Object(o["b"])(i)}}else t.appendChild(J())})}});function K(t){const e=[],i=t.children;for(let n=i.length-1;n>=0;n--){if(!Q(i[n]))break;e.push(i[n])}return e.reverse()}function Q(t){return 1===(t.children||[]).length&&"BR"===t.children[0].nodeName}function J(){const t=document.createElement("p");return t.innerHTML="<br>",t}var tt=i("8a60"),et=i.n(tt),it=d.a.Extension.extend({name:"buttonShotcut",mousetrapList:[],init(){d.a.Extension.prototype.init.apply(this,arguments),this.initButtonShotcut()},initButtonShotcut(){const t=this.getEditorOption("toolbar")||{},e=t.buttons||[],i=e.map(nt).filter(t=>t);this.getEditorElements().forEach(t=>{const e=new et.a(t);i.forEach(({shotcut:t,name:i})=>{e.bind(t,this.createEventHandler(i))}),this.mousetrapList.push(e)})},createEventHandler(t){const e=this.getEditorId();return function(){const i=st(t,e);return i&&i.click(),!1}},destroy(){this.mousetrapList.forEach(t=>t.reset()),this.mousetrapList=[]}});function nt(t){const e=(t.attrs||{})["data-shotcut"];return e?{name:t.name,shotcut:e.replace(/\s/g,"").split(",")}:null}function st(t,e){const i="medium-editor-toolbar-"+e,n="medium-editor-action-"+t,s=`#${i} .${n}`;return document.querySelector(s)}var at=i("7cbb"),rt=d.a.Extension.extend({name:"clipboard",translator:new f["a"],init(){d.a.Extension.prototype.init.apply(this,arguments),this.initClipboard()},initClipboard(){this.getEditorElements().forEach(t=>{this.on(t,"cut",this.handleCut.bind(this),!0),this.on(t,"copy",this.handleCopy.bind(this),!0)})},handleCut(t){},handleCopy(t){},handlePaste(t,e){if(t){const e=ot(t),i=this.translator.toEditingHtml(e);this.base.pasteHTML(i)}else e&&this.base.pasteHTML(Object(at["a"])(e))}});function ot(t){return t.replace(/^[\s\S]+?-->([\s\S]*)<!--[\s\S]+?$/,"$1").replace(/<!--[\s\S]*?-->/g,"")}var ct=i("52f0"),lt=i.n(ct),ut=d.a.Extension.extend({name:"clean",init(){d.a.Extension.prototype.init.apply(this,arguments),this.initClean()},initClean(){this.subscribe("editableKeydown",t=>{8===t.keyCode&&this.handleRemoveEvent(t)})},handleRemoveEvent(t){const e=lt.a.getSelection(),i=e.focusNode||{},n=dt(i);n&&ft(i,n)&&(t.preventDefault(),n.removeChild(n.children[0]),this.trigger("checkState"))}});function dt(t){while(t){if(ht(t))return t;t=t.parentNode}return null}function ht(t){return t.classList&&t.classList.contains("medium-editor-element")}function ft(t,e){const i=e.children[0],n=i&&!i.innerText.trim();return pt(t,e)&&n}function pt(t,e){while(e.children[0]){if(e.children[0]===t)return!0;e=e.children[0]}return!1}var mt=i("9db5"),gt=d.a.extensions.button.extend({name:"formatHighlight",action:"formatHighlight",contentDefault:"<b>HIGHLIGHT</b>",classApplier:null,init(){d.a.Extension.prototype.init.apply(this,arguments),Object.assign(this,this.getEditorOption(this.name)),Object.assign(this,this.getButtonOption()),d.a.extensions.button.prototype.init.apply(this,arguments),this.initHighlight()},initHighlight(){this.initClassApplier(),this.initEventListener()},initClassApplier(){lt.a.init(),this.classApplier=lt.a.createClassApplier(mt["CLASS_NAME"],{elementTagName:"pre",normalize:!0,useExistingElements:!1,onElementCreate:t=>{const e=t.innerText;e&&(t.innerHTML=document.createTextNode(e).innerHTML)}})},initEventListener(){this.subscribe("editableKeydown",t=>{8===t.keyCode&&this.handleRemoveEvent(t)}),this.subscribe("editableKeyup",t=>{if(8===t.keyCode){const t=vt().start;t||this.trigger("codeBlockDeactive")}}),this.subscribe("editableClick",t=>{"PRE"===t.target.nodeName?this.trigger("codeBlockActive",t.target):this.trigger("codeBlockDeactive")})},handleRemoveEvent(t){const e=lt.a.getSelection(),i=e.focusNode||{},n=e.isCollapsed&&"PRE"===i.nodeName&&_t(i)&&Ct(i.parentNode);n&&(t.preventDefault(),i.parentNode.removeChild(i))},getButtonOption(){return((this.getEditorOption("toolbar")||{}).buttons||[]).filter(t=>t.name===this.name)[0]},queryCommandState(){return this.isInCodeBlock()},handleClick(){if(!this.isFocused()||this.isInCodeBlock())return;const t=bt();this.base.pasteHTML("<p><br></p>"),this.base.pasteHTML(`<p>${yt(t)}</p>`),this.trigger("checkState")},isFocused(){return!!this.base.getFocusedElement()},isInCodeBlock(){const t=vt();return t.start||t.end}});function bt(){const t=lt.a.getSelection();if(!t.rangeCount)return"";const e=document.createElement("div"),i=t.getRangeAt(0).cloneContents();return i.querySelectorAll("p").forEach(t=>{t.lastChild&&"BR"===t.lastChild.nodeName||t.appendChild(document.createElement("br"))}),e.appendChild(i),e.innerText}function vt(){const t={start:null,end:null},e=window.getSelection();if(!e.rangeCount)return t;const i=e.getRangeAt(0);return t.start=Object(o["e"])(i.startContainer,"PRE"),t.end=Object(o["e"])(i.endContainer,"PRE"),t}function _t(t){return 1===t.parentNode.children.length}function Ct(t){return t.parentNode.children[0]===t}function yt(t=""){return`<pre class="${mt["CLASS_NAME"]}">${Object(at["a"])(t)||"<br>"}</pre>`}var wt=i("519d"),kt=d.a.extensions.button.extend({name:"formatCode",action:"formatCode",contentDefault:"<b>CODE</b>",classApplier:null,init(){d.a.Extension.prototype.init.apply(this,arguments),Object.assign(this,this.getEditorOption(this.name)),Object.assign(this,this.getButtonOption()),d.a.extensions.button.prototype.init.apply(this,arguments),this.initClassApplier()},initClassApplier(){lt.a.init(),this.classApplier=lt.a.createClassApplier(wt["CLASS_NAME"],{elementTagName:"code",normalize:!0,onElementCreate:t=>{const e=t.innerText;while(t.firstChild)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}})},getButtonOption(){return((this.getEditorOption("toolbar")||{}).buttons||[]).filter(t=>t.name===this.name)[0]},queryCommandState(){return this.classApplier.isAppliedToSelection()},handleClick(){this.isFocused()&&(this.classApplier.toggleSelection(),this.trigger("checkState"))},isFocused(){return!!this.base.getFocusedElement()}}),xt=i("7f42"),Ot=d.a.extensions.button.extend({name:"formatBold",action:"formatBold",contentDefault:"<b>B</b>",classApplier:null,init(){d.a.Extension.prototype.init.apply(this,arguments),Object.assign(this,this.getEditorOption(this.name)),Object.assign(this,this.getButtonOption()),d.a.extensions.button.prototype.init.apply(this,arguments),this.initClassApplier()},initClassApplier(){lt.a.init(),this.classApplier=lt.a.createClassApplier(xt["CLASS_NAME"],{elementTagName:"b",normalize:!0})},getButtonOption(){return((this.getEditorOption("toolbar")||{}).buttons||[]).filter(t=>t.name===this.name)[0]},queryCommandState(){return this.classApplier.isAppliedToSelection()},handleClick(){this.isFocused()&&(this.classApplier.toggleSelection(),this.trigger("checkState"))},isFocused(){return!!this.base.getFocusedElement()}}),jt=d.a.extensions.button.extend({name:"formatOrderedList",action:"insertorderedlist",contentDefault:"<b>OL</b>",init(){d.a.Extension.prototype.init.apply(this,arguments),Object.assign(this,this.getEditorOption(this.name)),Object.assign(this,this.getButtonOption()),d.a.extensions.button.prototype.init.apply(this,arguments)},getButtonOption(){return((this.getEditorOption("toolbar")||{}).buttons||[]).filter(t=>t.name===this.name)[0]},queryCommandState(){return this.base.queryCommandState(this.getAction())},handleClick(){this.isFocused()&&this.execAction(this.getAction())},isFocused(){return!!this.base.getFocusedElement()}}),Et=d.a.extensions.button.extend({name:"formatUnorderedList",action:"insertunorderedlist",contentDefault:"<b>UL</b>",init(){d.a.Extension.prototype.init.apply(this,arguments),Object.assign(this,this.getEditorOption(this.name)),Object.assign(this,this.getButtonOption()),d.a.extensions.button.prototype.init.apply(this,arguments)},getButtonOption(){return((this.getEditorOption("toolbar")||{}).buttons||[]).filter(t=>t.name===this.name)[0]},queryCommandState(){return this.base.queryCommandState(this.getAction())},handleClick(){this.isFocused()&&this.execAction(this.getAction())},isFocused(){return!!this.base.getFocusedElement()}}),At=d.a.extensions.button.extend({name:"formatLink",action:"formatLink",contentDefault:"<b>LINK</b>",init(){d.a.Extension.prototype.init.apply(this,arguments),Object.assign(this,this.getEditorOption(this.name)),Object.assign(this,this.getButtonOption()),d.a.extensions.button.prototype.init.apply(this,arguments),this.initFormatLink()},initFormatLink(){this.subscribe("requestUpdateLink",t=>{this.base.restoreSelection();const e=Lt();e?t?e.setAttribute("href",t):(Object(o["i"])(e),this.base.execAction("unlink")):t?this.base.createLink({value:t,target:"_blank"}):this.base.execAction("unlink"),this.trigger("checkState")})},getButtonOption(){return((this.getEditorOption("toolbar")||{}).buttons||[]).filter(t=>t.name===this.name)[0]},isAlreadyApplied(t){return"A"===t.nodeName},handleClick(){if(!this.isFocused())return;const t=Lt(),e=window.getSelection().isCollapsed;this.base.saveSelection(),t?this.trigger("requestEditLink",t.getAttribute("href")):e||this.trigger("requestCreateLink")},isFocused(){return!!this.base.getFocusedElement()}});function Lt(){const{start:t,end:e}=St(),i=t&&t===e;return i?t:null}function St(){const t={start:null,end:null},e=window.getSelection();if(!e.rangeCount)return t;const i=e.getRangeAt(0);return t.start=Object(o["e"])(i.startContainer,"A"),t.end=Object(o["e"])(i.endContainer,"A"),t}class Tt{constructor(t){this.element=t,this.translator=new f["a"],this.origin=new d.a(t,Object.assign({extensions:{toolbarTooltip:new $,uploadImage:new B,clickSelect:new V,state:new X,buttonInterceptor:new z,newLineInterceptor:new W,blankLine:new Z,buttonShotcut:new it,clipboard:new rt,clean:new ut,formatHighlight:new gt,formatCode:new kt,formatBold:new Ot,formatOrderedList:new jt,formatUnorderedList:new Et,formatLink:new At}},new D))}destroy(){this.origin.destroy()}getContent(){const t=this.origin.getContent();return h["a"](t)}setContent(t){this.origin.setContent(this.translator.toEditingHtml(t))}subscribe(...t){return this.origin.subscribe.apply(this.origin,t)}trigger(...t){return this.origin.trigger.apply(this.origin,t)}}var It=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("header",{staticClass:"header rich-text-editor-header",attrs:{"st:block":"editorHeader"}},[i("div",{staticClass:"header-content"},[i("Logo",{staticClass:"logo"}),i("StatusText",{staticClass:"status-text with-padding",attrs:{status:t.status}}),i("Button",{staticClass:"with-padding",attrs:{outline:""},nativeOn:{click:function(e){return t.goToDraft(e)}}},[t._v(" 草稿箱 ")]),i("PublishPopup",{staticClass:"publish-popup with-padding",attrs:{post:t.post,status:t.status},on:{publish:t.publish}}),i("EditorSwitcher",{staticClass:"editor-switcher with-padding",attrs:{type:"richText"}}),i("MainNavigator",{staticClass:"main-navigator with-padding"})],1)])},Dt=[],$t=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"logo"})},Nt=[],Mt=(i("2c25"),i("2877")),Ut={},Pt=Object(Mt["a"])(Ut,$t,Nt,!1,null,"01bee318",null),Ft=Pt.exports,Rt=i("8bb0"),Ht=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"main-image-selector",class:{active:t.active,unset:t.unset,updating:t.updating},attrs:{"st:block":"mainImageSelector"}},[i("div",{staticClass:"toggle-btn",on:{click:function(e){t.active=!t.active}}}),i("div",{directives:[{name:"show",rawName:"v-show",value:t.active,expression:"active"}],staticClass:"panel"},[i("div",{staticClass:"title"},[t._v("添加封面大图")]),i("button",{directives:[{name:"show",rawName:"v-show",value:t.unset,expression:"unset"}],staticClass:"select-btn",attrs:{disabled:t.updating,"st:name":"addBtn"},on:{click:t.selectImageFile}},[t._v(" "+t._s(t.prompt)+" ")]),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.unset,expression:"!unset"}],staticClass:"preview-box"},[i("img",{staticClass:"preview-image",attrs:{src:t.thumbUrl}}),i("button",{staticClass:"delete-btn",attrs:{title:"移除这张图片","st:name":"removeBtn"},on:{click:t.deleteImage}},[i("i",{staticClass:"ion-trash-a"})])])]),i("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"file",attrs:{type:"file"},on:{change:function(e){return t.onFileSelected(e)}}})])},Bt=[],Vt=i("5c91"),qt={props:["post"],data:()=>({active:!1,updating:!1}),computed:{unset(){return!this.post.cover_image},prompt(){return this.updating?"头图设置中...":"点击此处添加图片"},thumbUrl(){const t=this.post.cover_image;return t?Object(Vt["b"])(t,480,480):""}},methods:{selectImageFile(){this.$refs.file.click()},onFileSelected({target:t}){const e=t.files[0];e&&(this.$refs.file.value=null,this.changeMainImage(e))},changeMainImage(t){return this.updating=!0,Object(l["b"])(this.post.user_id,[t]).then(t=>{this.post.cover_image=t[0]&&t[0].Url,this.updating=!1}).catch(t=>{t.message=t.message||"头图设置失败",this.$error(t),this.updating=!1})},deleteImage(){this.post.cover_image=null}},domEvents:{click({target:t}){this.$el.contains(t)||(this.active=!1)}}},Xt=qt,zt=(i("beff"),Object(Mt["a"])(Xt,Ht,Bt,!1,null,"4137c9e4",null)),Yt=zt.exports,Gt=i("745c"),Wt=i("0524"),Zt=i("e0a3"),Kt=i("59be"),Qt={components:{Logo:Ft,StatusText:Rt["a"],MainImageSelector:Yt,EditorSwitcher:Gt["a"],PublishPopup:Wt["a"],MainNavigator:Zt["a"],Button:Kt["a"]},props:["guided","post","status"],methods:{publish(...t){this.$emit("publish",...t)},goToDraft(){window.open("/creator/content/article/drafts")}}},Jt=Qt,te=(i("8f6b"),Object(Mt["a"])(Jt,It,Dt,!1,null,"390f5aa8",null)),ee=te.exports,ie=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.innerValue,expression:"innerValue"}],ref:"input",staticClass:"title-input",attrs:{placeholder:"输入标题...",spellcheck:"false",maxlength:t.maxlength,rows:"1"},domProps:{value:t.innerValue},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.$emit("submit")},input:function(e){e.target.composing||(t.innerValue=e.target.value)}}})},ne=[],se=i("3bba"),ae={props:["value"],data:()=>({maxlength:se["a"],innerValue:""}),watch:{value:{handler(t,e){this.innerValue=t},immediate:!0},innerValue(t,e){const i=t.replace(/[\r\n]/g,"");i!==t?this.innerValue=i:(this.$emit("input",i),this.$nextTick(()=>re(this.$refs.input)))}},mounted(){this.$refs.input.focus()}};function re(t){t.style.height="1px",t.style.height=t.scrollHeight+"px"}var oe=ae,ce=(i("e108"),Object(Mt["a"])(oe,ie,ne,!1,null,"1016d8f6",null)),le=ce.exports,ue=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],staticClass:"code-lang-selector",style:t.style,on:{mousewheel:function(t){t.stopPropagation()}}},[i("div",{staticClass:"current-lang",on:{click:t.toggleList}},[t._v(t._s(t.currentLang))]),i("ul",{directives:[{name:"show",rawName:"v-show",value:t.listVisible,expression:"listVisible"}],ref:"list",staticClass:"lang-list"},[t._l(t.usedLangList,(function(e){return i("li",{staticClass:"item used",on:{click:function(i){return t.selectLang(e)}}},[t._v(" "+t._s(e)+" ")])})),t._l(t.langList,(function(e){return i("li",{staticClass:"item",on:{click:function(i){return t.selectLang(e)}}},[t._v(" "+t._s(e)+" ")])}))],2)])},de=[],he=i("ee10"),fe=i("964c"),pe={data:()=>({langList:Object(he["a"])(),usedLangList:[],currentLang:mt["DEFAULT_LANG"],visible:!1,listVisible:!1,top:0,left:0}),computed:{style(){return{top:this.top+"px",left:this.left+"px"}}},methods:{setTargetCodeBlock(t){this.hide(),this.codeBlock=t,this.currentLang=t.getAttribute(mt["LANG_ATTR_NAME"])||mt["DEFAULT_LANG"],this.getUsedLangList(),this.show()},show(){this.position(),this.visible=!0},position(){if(!this.codeBlock)return;const t=Object(o["f"])(this.codeBlock);this.top=t.top,this.left=t.left},hide(){this.codeBlock=null,this.visible=!1,this.hideList()},toggleList(){this.listVisible?this.hideList():this.showList()},getUsedLangList(){const t=fe["a"]("usedCodeLangList")||[];this.usedLangList=t.length?t:[]},updateUsedLangList(){const t=this.currentLang,e=this.usedLangList,i=[t].concat(e.filter(e=>e!==t).slice(0,9));fe["b"]("usedCodeLangList",i)},showList(){this.listVisible=!0},hideList(){this.listVisible=!1,this.$refs.list.scrollTop=0},selectLang(t){this.currentLang=t,this.updateCodeBlockLang(),this.updateUsedLangList(),this.hideList()},updateCodeBlockLang(){this.codeBlock&&(this.codeBlock.setAttribute(mt["LANG_ATTR_NAME"],this.currentLang),this.$emit("update",this.currentLang))}},mounted(){this.removeResizeListener=Object(o["g"])(window,"resize",()=>{this.$nextTick(()=>{this.position()})})},beforeDestroy(){this.removeResizeListener()}},me=pe,ge=(i("8780"),Object(Mt["a"])(me,ue,de,!1,null,"75a3b4b0",null)),be=ge.exports,ve=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],staticClass:"link-dialog-box"},[i("div",{staticClass:"link-dialog"},[i("div",{staticClass:"dialog-header"},[i("div",{staticClass:"dialog-title"},[t._v(t._s(t.title))]),i("button",{staticClass:"close-btn ion-close-round",attrs:{title:"关闭"},on:{click:t.close}})]),i("div",{staticClass:"dialog-body"},[i("form",{on:{submit:function(e){return e.preventDefault(),t.submit(e)}}},[i("div",{staticClass:"input-group"},[i("div",{staticClass:"input-icon url-input-icon",on:{click:function(e){return t.$refs.urlInput.select()}}}),i("input",{directives:[{name:"model",rawName:"v-model",value:t.form.url,expression:"form.url"}],ref:"urlInput",staticClass:"input url-input",attrs:{placeholder:"输入网址...",spellcheck:"false"},domProps:{value:t.form.url},on:{input:function(e){e.target.composing||t.$set(t.form,"url",e.target.value)}}})])])]),i("div",{staticClass:"dialog-footer"},[i("button",{staticClass:"ctrl-btn cancel-btn",on:{click:t.close}},[t._v("取消")]),i("button",{staticClass:"ctrl-btn confirm-btn",on:{click:t.submit}},[t._v("确定")])])])])},_e=[],Ce={data:()=>({visible:!1,url:"",form:{url:""}}),computed:{isEdit(){return!!this.url},title(){return this.isEdit?"编辑链接":"创建链接"}},methods:{show(t){this.url=t||"",this.form.url=this.url,this.visible=!0,this.$nextTick(()=>{this.$refs.urlInput.select()})},close(){this.visible=!1},update(){this.$emit("update",this.form.url.trim())},submit(){this.close(),this.update()}}},ye=Ce,we=(i("1a50"),Object(Mt["a"])(ye,ve,_e,!1,null,"ab991774",null)),ke=we.exports,xe=i("6b53"),Oe=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.visible?i("div",{staticClass:"image-size-alert"},[i("span",{staticClass:"close-btn ion-close",attrs:{title:"关闭"},on:{click:function(e){t.visible=!1}}}),i("div",{staticClass:"title"},[t._v(t._s(t.title))]),i("div",{staticClass:"text"},[t._v(" 请尽可能压缩图片大小以提升阅读体验。 "),i("br"),t._v(" 推荐在线压缩工具： "),i("ul",{staticClass:"recommended-list"},[i("li",{staticClass:"item"},[t._v(" 静图压缩： "),i("a",{staticClass:"link",attrs:{href:"https://tinypng.com/",target:"_blank"}},[t._v(" "+t._s("tinypng.com")+" ")])]),i("li",{staticClass:"item"},[t._v(" 动图压缩： "),i("a",{staticClass:"link",attrs:{href:"https://ezgif.com/optimize",target:"_blank"}},[t._v(" "+t._s("ezgif.com")+" ")])])])])]):t._e()},je=[],Ee={data:()=>({visible:!1,title:""}),methods:{show(t){const e=Date.now();this.title=t||"图片过大",this.token=e,this.visible=!0,setTimeout(()=>{e===this.token&&(this.visible=!1)},15e3)}}},Ae=Ee,Le=(i("a1fe"),Object(Mt["a"])(Ae,Oe,je,!1,null,"08993f1a",null)),Se=Le.exports;const Te=new a["a"];var Ie={components:{EditorHeader:ee,TitleInput:le,CodeLangSelector:be,LinkDialog:ke,ImageUploadProgressPanel:xe["a"],ImageSizeAlert:Se},props:["guided","post","status"],data:()=>({isImageUploading:!1}),computed:{isDraft(){return!this.post.entry},notNeedConfirmedUpdate(){return[this.post.title,this.post.html,this.post.markdown,this.post.category,this.post.tags,this.post.cover_image]}},watch:{notNeedConfirmedUpdate(){this.requestUpdate()}},methods:{initEditor(){this.editor=new Tt(this.$refs.content),this.editor.setContent(this.post.html),this.editor.subscribe("codeBlockActive",t=>{this.$refs.codeLangSelector.setTargetCodeBlock(t)}),this.editor.subscribe("codeBlockDeactive",()=>{this.$refs.codeLangSelector.hide()}),this.editor.subscribe("requestEditLink",t=>{this.$refs.linkDialog.show(t)}),this.editor.subscribe("requestCreateLink",()=>{this.$refs.linkDialog.show()}),this.editor.subscribe("imageUploading",()=>{this.isImageUploading=!0}),this.editor.subscribe("imageUploadSuccess",()=>{this.isImageUploading=!1}),this.editor.subscribe("imageUploadFailed",t=>{this.isImageUploading=!1,"size"===t.type?this.$refs.imageSizeAlert.show(t.message):this.$error(t)}),this.editor.subscribe("editableInput",Object(r["a"])(()=>{this.updatePost()},300))},updatePost(){const t=this.editor.getContent();this.post.html=t,this.post.markdown=Te.fromHtml(t)},updateLink(t){window.setTimeout(()=>{this.editor.trigger("requestUpdateLink",t)},200)},cancelImageUpload(){this.isImageUploading=!1,this.editor.trigger("cancelImageUpload")},onTitleSubmit(){this.$refs.content.focus()},update(){this.$emit("update")},async publish(...t){let e=!1;const i=Array.from(this.editor.element.querySelectorAll("img"));await Promise.all(i.map(async t=>{try{const e=t.getAttribute("src");if(!(e.includes("data:image/svg+xml;utf8")||e.includes("p-boe.byted.org")||e.includes("juejin.byteimg.com"))){const i=await Object(l["a"])(e),n=i.data;t.setAttribute("src",n)}}catch{e=!0}})),this.updatePost(),e&&this.$error("图片地址解析失败"),this.$emit("publish",...t)}},created(){this.requestUpdate=Object(r["a"])(()=>{this.update()},c["a"])},mounted(){this.initEditor()},beforeDestroy(){this.editor.destroy()}},De=Ie,$e=(i("034c"),i("dfa1"),Object(Mt["a"])(De,n,s,!1,null,"28d45504",null));e["a"]=$e.exports},"39f1":function(t,e,i){"use strict";var n=i("be41"),s=i.n(n);s.a},"3b37":function(t,e,i){"use strict";i.r(e),i.d(e,"install",(function(){return p}));var n=i("24c0");function s(t,e){const i=o(e);if(!c(i))return;const s=r(i);n["a"].exec("send","event","generalElementEvent",t,s)}function a(t){const e=o(t);return c(e)?r(o(t)):"Event wouldn't be sent."}function r(t){const e=[l(),u(t),d(t),h(t)].map(f).join(" ");return e}function o(t){const e=[];while(t&&1===t.nodeType)e.unshift({block:t.getAttribute("st:block"),name:t.getAttribute("st:name"),state:t.getAttribute("st:state"),silent:t.hasAttribute("st:silent")}),t=t.parentNode;return e}function c(t){const e=t.some(t=>t.silent);if(e)return!1;for(let i=t.length-1;i>=0;i--){const{block:e,name:n}=t[i];if(e)return!1;if(n)return!0}}function l(){const{href:t,origin:e}=window.location;return t.slice(e.length).split("#")[0]}function u(t){return t.filter(t=>t.block).map(t=>t.block+(t.state?":"+t.state:"")).join("/")}function d(t){for(let e=t.length-1;e>=0;e--){const{block:i,name:n}=t[e];if(i)return null;if(n)return n}}function h(t){for(let e=t.length-1;e>=0;e--){const{block:i,name:n,state:s}=t[e];if(i)return null;if(n||s)return s}}function f(t){return t?t.replace(/ /g,"_"):"-"}function p(t,e){m(t),g()}function m(t){t.prototype.$st={click(t){s("click",t||this.$el)},show(t){s("show",t||this.$el)}},window.addEventListener("click",(function(t){s("click",t.target)}),!0)}function g(){window.$stInfo=function(t){return t?{label:a(t)}:"Please select a node in [Elements] tab."}}},"3bba":function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));const n=80},"3d36":function(t,e,i){"use strict";i.r(e);var n=i("7c64");const s="draft/UPDATE_STATE";e["default"]={state:{booklet_draft:{},sections:[]},getters:{},mutations:{[s](t,e){Object.assign(t,e)}},actions:{[n["DELETE_DRAFT"]]({commit:t},e){t(n["ENTITY_DELETED"],{model:"draft",id:e})}}}},"3d66":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("button",{staticClass:"new-button",attrs:{"st:name":"newBtn"},on:{click:t.onClick}},[t._v("写文章")])},s=[],a={methods:{onClick(){window.location.href="/editor/drafts/new?v=2"}}},r=a,o=i("2877"),c=Object(o["a"])(r,n,s,!1,null,"1cadd853",null);e["a"]=c.exports},"3e53":function(t,e,i){},"41aa":function(t,e,i){},"41d2":function(t,e,i){t.exports=i.p+"img/refresh.6a3492ad.svg"},4208:function(t,e,i){t.exports=i.p+"img/close.30bfc380.svg"},"425c":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"view draft-index-view"},[i("MainHeader",{staticClass:"main-header"}),i("main",{staticClass:"main"},[i("DraftList",{attrs:{list:t.list,"xiaoce-list":t.xiaoceList,"xiaoce-count":t.countXiaoce,"xiaoce-hasmore":t.hasMoreXiaoce,"realtime-list":t.realtimeList,"realtime-count":t.countRealtime,"cur-type":t.$route.query.type,loading:t.loading},on:{"type-select":t.onTypeSelect,delete:t.deleteDraft,"xiaoce-fetchmore":t.getXiaoceDraftList}})],1)],1)},s=[],a=i("7590"),r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("header",{staticClass:"header main-header",attrs:{"st:block":"mainHeader"}},[i("div",{staticClass:"header-content"},[i("a",{staticClass:"logo",attrs:{href:"/"}}),i("NewButton",{staticClass:"new-button"}),t.newPrivilege?i("button",{staticClass:"new-button",on:{click:t.toRealtimeEditor}},[t._v(" 写资讯 ")]):t._e(),1===t.user.book_author?i("button",{staticClass:"new-button",on:{click:t.toXiaoceEditor}},[t._v(" 写小册 ")]):t._e(),i("MainNavigator")],1)])},o=[],c=i("e0a3"),l=i("3d66"),u={components:{MainNavigator:c["a"],NewButton:l["a"]},computed:{user(){return this.$store.getters.USER||{}},newPrivilege(){return"number"===typeof this.user.news_privilege&&0!==this.user.news_privilege}},methods:{toXiaoceEditor(){let t="new";window.location.href=`/editor/book/${t}/section`},toRealtimeEditor(){window.location.href="/editor/news-drafts/new"}}},d=u,h=(i("5955"),i("2877")),f=Object(h["a"])(d,r,o,!1,null,"0e53288f",null),p=f.exports,m=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"draft-list"},[i("div",{staticClass:"list-header"},[i("div",{staticClass:"list-header-item",class:{active:"article"===t.curType||!t.curType},on:{click:function(e){return t.onTypeSelect("article")}}},[t._v(" 文章草稿（"+t._s(t.list.length)+"） ")]),t.newPrivilege?i("div",{staticClass:"list-header-item",class:{active:"realtime"===t.curType},on:{click:function(e){return t.onTypeSelect("realtime")}}},[t._v(" 资讯草稿（"+t._s(t._realtimeCount)+"） ")]):t._e(),1===this.user.book_author?i("div",{staticClass:"list-header-item",class:{active:"xiaoce"===t.curType},on:{click:function(e){return t.onTypeSelect("xiaoce")}}},[t._v(" 小册草稿（"+t._s(t.xiaoceCount)+"） ")]):t._e()]),"xiaoce"===t.curType?i("ul",{ref:"list",staticClass:"list"},t._l(t.xiaoceList,(function(e,n){return i("li",{key:e.base_info?e.base_info.booklet_id:n,staticClass:"item"},[i("XiaoceDraft",{attrs:{draft:e},on:{delete:t.deleteDraft}})],1)})),0):t._e(),"realtime"===t.curType?i("ul",{staticClass:"list"},t._l(t.realtimeList,(function(e){return i("li",{key:e.content_id,staticClass:"item"},[i("RealtimeDraft",{attrs:{draft:e},on:{delete:t.deleteDraft}})],1)})),0):i("ul",{staticClass:"list"},t._l(t.list,(function(e){return i("li",{key:e.id,staticClass:"item"},[i("Draft",{attrs:{draft:e},on:{delete:t.deleteDraft}})],1)})),0)])},g=[],b=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"draft"},[n("a",{staticClass:"title",attrs:{href:t.editUrl}},[t._v(t._s(t.title))]),n("div",{staticClass:"info-box"},["markdown"===t.draft.type?n("img",{staticClass:"item icon",attrs:{src:i("992a")}}):t._e(),n("div",{staticClass:"item date"},[t._v(t._s(t.date))]),n("div",{ref:"menu",staticClass:"menu ion-ios-more",on:{click:function(e){t.isMenuActive=!t.isMenuActive}}},[n("ul",{directives:[{name:"show",rawName:"v-show",value:t.isMenuActive,expression:"isMenuActive"}],staticClass:"menu-list"},[n("li",{staticClass:"item",on:{click:t.editDraft}},[t._v("编辑")]),n("li",{staticClass:"item",on:{click:function(e){t.isDeleteDialogVisible=!0}}},[t._v("删除")])])])]),t.isDeleteDialogVisible?n("ConfirmDialog",{attrs:{title:"删除草稿",content:"删除后不可恢复，确认删除此草稿吗？"},on:{cancel:function(e){t.isDeleteDialogVisible=!1},confirm:t.deleteDraft}}):t._e()],1)},v=[],_=i("c1df"),C=i.n(_);function y(t,e){return C()(t).format(e)}var w=i("6658"),k={components:{ConfirmDialog:w["a"]},props:["draft"],data:()=>({isMenuActive:!1,isDeleteDialogVisible:!1}),computed:{editUrl(){return"/editor/drafts/"+this.draft.id},title(){return this.draft.title||"无标题"},date(){return y(this.draft.updatedAt,"YYYY 年 M 月 D 日 HH:mm")}},methods:{editDraft(){window.location.href=this.editUrl},deleteDraft(){this.$emit("delete",this.draft),this.isDeleteDialogVisible=!1}},domEvents:{click({target:t}){this.$refs.menu.contains(t)||(this.isMenuActive=!1)}}},x=k,O=(i("3595"),Object(h["a"])(x,b,v,!1,null,"5ee49c32",null)),j=O.exports,E=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"draft"},[i("a",{staticClass:"title",attrs:{href:t.editUrl}},[t._v(t._s(t.title))]),i("div",{staticClass:"info-box"},[i("div",{staticClass:"item date"},[t._v(t._s(t.date))]),i("div",{ref:"menu",staticClass:"menu ion-ios-more",on:{click:function(e){t.isMenuActive=!t.isMenuActive}}},[i("ul",{directives:[{name:"show",rawName:"v-show",value:t.isMenuActive,expression:"isMenuActive"}],staticClass:"menu-list"},[i("li",{staticClass:"item",on:{click:t.editDraft}},[t._v("编辑")]),i("li",{staticClass:"item",on:{click:function(e){t.isDeleteDialogVisible=!0}}},[t._v("删除")])])])]),t.isDeleteDialogVisible?i("ConfirmDialog",{attrs:{title:"删除草稿",content:"删除后不可恢复，确认删除此草稿吗？"},on:{cancel:function(e){t.isDeleteDialogVisible=!1},confirm:t.deleteDraft}}):t._e()],1)},A=[],L=(i("ea37"),{components:{ConfirmDialog:w["a"]},props:["draft"],data:()=>({isMenuActive:!1,isDeleteDialogVisible:!1}),computed:{editUrl(){return`/editor/book/${this.draft.base_info.booklet_id}/section`},title(){return this.draft.base_info.title||"无标题"},date(){return y(1e3*this.draft.base_info.mtime,"YYYY 年 M 月 D 日 HH:mm")}},methods:{editDraft(){window.location.href=this.editUrl},deleteDraft(){this.$emit("delete",this.draft,"xiaoce"),this.isDeleteDialogVisible=!1}},domEvents:{click({target:t}){this.$refs.menu.contains(t)||(this.isMenuActive=!1)}}}),S=L,T=(i("a175"),Object(h["a"])(S,E,A,!1,null,"ea9a59ce",null)),I=T.exports,D=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"draft"},[i("a",{staticClass:"title",attrs:{href:t.editUrl}},[t._v(t._s(t.title))]),i("div",{staticClass:"info-box"},[i("div",{staticClass:"item date"},[t._v(t._s(t.date))]),i("div",{ref:"menu",staticClass:"menu ion-ios-more",on:{click:function(e){t.isMenuActive=!t.isMenuActive}}},[i("ul",{directives:[{name:"show",rawName:"v-show",value:t.isMenuActive,expression:"isMenuActive"}],staticClass:"menu-list"},[i("li",{staticClass:"item",on:{click:t.editDraft}},[t._v("编辑")]),i("li",{staticClass:"item",on:{click:function(e){t.isDeleteDialogVisible=!0}}},[t._v("删除")])])])]),t.isDeleteDialogVisible?i("ConfirmDialog",{attrs:{title:"删除草稿",content:"删除后不可恢复，确认删除此草稿吗？"},on:{cancel:function(e){t.isDeleteDialogVisible=!1},confirm:t.deleteDraft}}):t._e()],1)},$=[],N={components:{ConfirmDialog:w["a"]},props:["draft"],data:()=>({isMenuActive:!1,isDeleteDialogVisible:!1}),computed:{editUrl(){return"/editor/news-drafts/"+this.draft.content_id},title(){return this.draft.title||"无标题"},date(){const t=this.draft.mtime||this.draft.ctime;return y(1e3*t,"YYYY 年 M 月 D 日 HH:mm")}},methods:{editDraft(){window.location.href=this.editUrl},deleteDraft(){this.$emit("delete",this.draft,"realtime"),this.isDeleteDialogVisible=!1}},domEvents:{click({target:t}){this.$refs.menu.contains(t)||(this.isMenuActive=!1)}}},M=N,U=(i("0fd3"),Object(h["a"])(M,D,$,!1,null,"2595b4b9",null)),P=U.exports,F=i("8690"),R={components:{Draft:j,XiaoceDraft:I,RealtimeDraft:P},props:["list","xiaoceList","curType","loading","xiaoceCount","xiaoceCursor","xiaocehasmore","realtimeList","realtimeCount"],computed:{user(){return this.$store.getters.USER||{}},newPrivilege(){return"number"===typeof this.user.news_privilege&&0!==this.user.news_privilege},_realtimeCount(){return this.realtimeCount<0?0:this.realtimeCount}},methods:{onTypeSelect(t){this.$emit("type-select",t)},deleteDraft(t,e){this.$emit("delete",t,e)},fetchMoreIfConditionIsSatisfied(){const t=Object(F["c"])(this.$refs.list);t>-200&&this.$emit("xiaoce-fetchmore")}},mounted(){this.$refs.list&&Object(F["h"])(this.$refs.list,()=>{this.fetchMoreIfConditionIsSatisfied()})}},H=R,B=(i("9258"),Object(h["a"])(H,m,g,!1,null,"5c05d690",null)),V=B.exports,q=i("7e48"),X=i("8980"),z={components:{MainHeader:p,DraftList:V},data:()=>({list:[],xiaoceList:[],cursorXiaoce:0,countXiaoce:0,hasMoreXiaoce:!0,loadingDraft:!1,loadingXiaoceDraft:!1,realtimeList:[],countRealtime:-1,loadingRealtime:!1}),computed:{user(){return this.$store.getters.USER||{}},newPrivilege(){return"number"===typeof this.user.news_privilege&&0!==this.user.news_privilege},loading(){return this.loadingDraft||this.loadingXiaoceDraft||this.loadingRealtime}},methods:{fetch(){this.loading||(this.getDraftList(),1===this.user.book_author&&this.getXiaoceDraftList(),this.newPrivilege&&this.getRealtimeList())},getDraftList(){this.loadingDraft=!0,Object(a["e"])().then(t=>{this.list=t.sort((t,e)=>e.updatedAt-t.updatedAt),this.loadingDraft=!1}).catch(t=>{this.loadingDraft=!1,this.$error(t)})},getXiaoceDraftList(){this.hasMoreXiaoce&&!this.loadingXiaoceDraft&&(this.loadingXiaoceDraft=!0,Object(q["d"])({cursor:this.cursorXiaoce}).then(t=>{this.xiaoceList=this.xiaoceList.concat(t.data||[]),this.cursorXiaoce=t.cursor,this.countXiaoce=t.count,this.hasMoreXiaoce=t.has_more,this.loadingXiaoceDraft=!1}).catch(t=>{this.loadingXiaoceDraft=!1,this.$error(t)}))},getRealtimeList(){const t=this.realtimeList.length;(-1===this.countRealtime||t<this.countRealtime)&&!this.loadingRealtime&&(this.loadingRealtime=!0,Object(X["d"])(t).then(t=>{this.realtimeList=this.realtimeList.concat(t.data||[]),this.countRealtime=t.count}).catch(t=>{this.$error(t)}).finally(()=>{this.loadingRealtime=!1}))},onTypeSelect(t){this.$router.push({name:"draftIndex",params:{},query:{type:t||"article"}})},deleteArticleDraft(t){Object(a["b"])(t.id).then(()=>{this.loadingDraft=!1,this.list=this.list.filter(e=>e.id!==t.id)})},deleteXiaoceDraft(t){Object(q["h"])({booklet_id:t.base_info.booklet_id,status:-1,change_field:"status"}).then(e=>{this.loadingXiaoceDraft=!1,this.countXiaoce=this.countXiaoce-1,this.xiaoceList=this.xiaoceList.filter(e=>e.base_info.booklet_id!==t.base_info.booklet_id)})},deleteRealtime(t){Object(X["g"])(t.content_id).then(()=>{this.loadingRealtime=!1,this.countRealtime=this.countRealtime-1,this.realtimeList=this.realtimeList.filter(e=>e.content_id!==t.content_id)})},deleteDraft(t,e){"xiaoce"===e?this.deleteXiaoceDraft(t):"realtime"===e?this.deleteRealtime(t):this.deleteArticleDraft(t)}},metaInfo(){return{title:"草稿 - 掘金"}},mounted(){this.fetch()}},Y=z,G=(i("599a"),Object(h["a"])(Y,n,s,!1,null,"7ab2960c",null));e["default"]=G.exports},"43b4":function(t,e,i){},4678:function(t,e,i){var n={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bn":"9043","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-nz":"6f50","./en-nz.js":"6f50","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-latn":"0caa","./gom-latn.js":"0caa","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./th":"10e8","./th.js":"10e8","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-tw":"90ea","./zh-tw.js":"90ea"};function s(t){var e=a(t);return i(e)}function a(t){if(!i.o(n,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n[t]}s.keys=function(){return Object.keys(n)},s.resolve=a,t.exports=s,s.id="4678"},"46bb":function(t,e,i){},"48c2":function(t,e,i){},"4be2":function(t,e,i){},"4cc5":function(t,e,i){},"4cc8":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"edit-draft"},[i(t.editor,{tag:"component",attrs:{post:t.draft,status:t.status},on:{update:t.update,publish:t.publish}})],1)},s=[],a=i("7590"),r=i("e248"),o=i("e37c"),c=i("2fd7"),l=(i("964c"),i("3828")),u=i("88f3");const d=new c["a"];var h={components:{RichTextEditor:l["a"],MarkdownEditor:u["a"]},data:()=>({editor:null,draft:null,status:"editing"}),computed:{editorType(){const{USER:t}=this.$store.getters;return t&&"wysiwyg"===t.editor_type?"wysiwyg":"markdown"}},metaInfo(){const t=["写文章",(this.draft||{}).title,"掘金"];return{title:t.filter(t=>t).join(" - ")}},methods:{init(){const t=this.$route.params.id;this.initDraft(t).catch(t=>{404===t.normalizedCode&&this.$router.push({name:"notFound"}),this.$error(t)}).then(()=>this.initEditor()).catch(t=>{this.$error(t)})},initDraft(t){const e="new"===t?this.getBlankDraft():this.fetchDraft(t);return e.then(e=>{e.entry?window.location.href="/editor/posts/"+t:this.draft=e})},getBlankDraft(){return Object(a["c"])({type:"wysiwyg"===this.editorType?"wysiwyg":"markdown"})},fetchDraft(t){return Object(a["d"])(t)},initEditor(){this.draft&&("wysiwyg"===this.draft.type||0===this.draft.edit_type?this.editor="RichTextEditor":this.editor="MarkdownEditor")},update(){(this.draft.id||this.draft.title||this.draft.html)&&(this.status="saving",Object(a["a"])(this.draft).then(()=>{const t=this.$route.params&&this.$route.params.id,e=this.draft.id;t!==e&&this.$router.replace({params:{id:e}}),this.status="editing"}).catch(t=>{this.status="error",this.$error(t)}))},publish({sync_to_org:t}){const e=this.$store.state.auth.user.level,i=this.draft.columns||[];d.validate(this.draft).then(()=>Object(a["a"])(this.draft)).then(()=>Object(r["e"])(this.draft.id,e,{sync_to_org:t,column_ids:Array.isArray(i)?i.map(t=>t.column_id):[]})).then(t=>{if(t&&t.article_id){const e={id:t.article_id,type:"post"};window.sessionStorage.setItem("PUB_INFO",JSON.stringify(e)),window.location.href=Object(o["d"])()}}).catch(t=>{this.$error(t)})}},mounted(){this.init()}};var f=h,p=i("2877"),m=Object(p["a"])(f,n,s,!1,null,"512ef325",null);e["default"]=m.exports},"4de5":function(t,e,i){"use strict";var n=i("7c1b"),s=i.n(n);s.a},"4e61":function(t,e,i){"use strict";var n=i("4be2"),s=i.n(n);s.a},"519d":function(t,e,i){"use strict";i.r(e),i.d(e,"CLASS_NAME",(function(){return s})),i.d(e,"format",(function(){return a}));var n=i("a061");const s=Object(n["e"])("code");function a(t){const e=Array.from(t.querySelectorAll("pre code"));Array.from(t.querySelectorAll("code")).filter(t=>-1===e.indexOf(t)).forEach(t=>{t.classList.add(s)})}},5250:function(t,e,i){"use strict";i.r(e);var n=i("7c64");const s="error/UPDATE_STATE";e["default"]={state:{errorView:null},getters:{[n["ERROR_VIEW"]]:t=>t.errorView},mutations:{[s](t,e){Object.assign(t,e)}},actions:{[n["SET_ERROR_VIEW"]]({commit:t},e){t(s,{errorView:e})}}}},5472:function(t,e,i){},5636:function(t,e,i){},"58e8":function(t,e,i){"use strict";i.r(e);var n=i("7c64"),s=i("964c");const a="layout/UPDATE_STATE";e["default"]={state:{markdownLayout:s["a"]("markdownLayout"),xiaoceLayout:s["a"]("xiaoceLayout"),xiaoceSummaryLayout:s["a"]("xiaoceSummaryLayout")},getters:{[n["MARKDOWN_LAYOUT"]]:t=>t.markdownLayout,[n["XIAOCE_LAYOUT"]]:t=>t.xiaoceLayout,[n["XIAOCE_SUMMARY_LAYOUT"]]:t=>t.xiaoceSummaryLayout},mutations:{[a](t,e){Object.assign(t,e)}},actions:{[n["TOGGLE_MARKDOWN_LAYOUT"]]({commit:t,state:e}){const i="extended"===e.markdownLayout?"collapsed":"extended";t(a,{markdownLayout:i}),s["b"]("markdownLayout",i)},[n["TOGGLE_XIAOCE_LAYOUT"]]({commit:t,state:e}){const i="extended"===e.xiaoceLayout?"collapsed":"extended";t(a,{xiaoceLayout:i}),s["b"]("xiaoceLayout",i)},[n["TOGGLE_XIAOCE_SUMMARY_LAYOUT"]]({commit:t,state:e}){console.log(e.xiaoceSummaryLayout);const i="extended"===e.xiaoceSummaryLayout?"collapsed":"extended";t(a,{xiaoceSummaryLayout:i}),s["b"]("xiaoceSummaryLayout",i)}}}},"591d":function(t,e,i){"use strict";var n=i("8510"),s=i.n(n);s.a},5955:function(t,e,i){"use strict";var n=i("24da"),s=i.n(n);s.a},"599a":function(t,e,i){"use strict";var n=i("ddce"),s=i.n(n);s.a},"59be":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("button",{staticClass:"xitu-btn",class:t.className},[t._t("default")],2)},s=[],a=i("e24e"),r=i.n(a),o=i("a0f4"),c=Object(o["defineComponent"])({props:{outline:{type:Boolean,default:!1}},setup({outline:t}){return{className:r()({"xitu-btn-outline":t})}}}),l=c,u=(i("bc16"),i("2877")),d=Object(u["a"])(l,n,s,!1,null,null,null);e["a"]=d.exports},"5a5c":function(t,e,i){},"5b36":function(t,e,i){"use strict";var n=i("e64d"),s=i.n(n);s.a},"5c64":function(t,e,i){"use strict";var n=i("48c2"),s=i.n(n);s.a},"5c91":function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return a}));const n=85;function s(t,e,i,{quality:s=n,format:a=""}={}){return r(t,1,e,i,s,a)}function a(t,e,i,{quality:s=n,format:a=""}={}){return r(t,2,e,i,s,a)}function r(t,e,i,n,s,a){const r=`?imageView2/${e}/w/${i}/h/${n}/q/${s}`+(a?"/format/"+a:"")+"/interlace/1";return t.replace(/\?.*$/,"")+r}},"604c":function(t,e,i){"use strict";function n(t,e){var i,n=t.posMax,s=!0,a=!0;return e>0?t.src.charCodeAt(e-1):-1,i=e+1<=n?t.src.charCodeAt(e+1):-1,i>=48&&i<=57&&(a=!1),{can_open:s,can_close:a}}function s(t,e){var i,s,a,r,o;if("$"!==t.src[t.pos])return!1;if(r=n(t,t.pos),!r.can_open)return e||(t.pending+="$"),t.pos+=1,!0;i=t.pos+1,s=i;while(-1!==(s=t.src.indexOf("$",s))){o=s-1;while("\\"===t.src[o])o-=1;if((s-o)%2==1)break;s+=1}return-1===s?(e||(t.pending+="$"),t.pos=i,!0):s-i===0?(e||(t.pending+="$$"),t.pos=i+1,!0):(r=n(t,s),r.can_close?(e||(a=t.push("math_inline","math",0),a.markup="$",a.content=t.src.slice(i,s)),t.pos=s+1,!0):(e||(t.pending+="$"),t.pos=i,!0))}function a(t,e,i,n){var s,a,r,o,c,l=!1,u=t.bMarks[e]+t.tShift[e],d=t.eMarks[e];if(u+2>d)return!1;if("$$"!==t.src.slice(u,u+2))return!1;if(u+=2,s=t.src.slice(u,d),n)return!0;for("$$"===s.trim().slice(-2)&&(s=s.trim().slice(0,-2),l=!0),r=e;!l;){if(r++,r>=i)break;if(u=t.bMarks[r]+t.tShift[r],d=t.eMarks[r],u<d&&t.tShift[r]<t.blkIndent)break;"$$"===t.src.slice(u,d).trim().slice(-2)&&(o=t.src.slice(0,d).lastIndexOf("$$"),a=t.src.slice(u,o),l=!0)}return t.line=r+1,c=t.push("math_block","math",0),c.block=!0,c.content=(s&&s.trim()?s+"\n":"")+t.getLines(e+1,r,t.tShift[e],!0)+(a&&a.trim()?a:""),c.map=[e,t.line],c.markup="$$",!0}function r(t){return c(t)}function o(t){return`<figure>${c(t)}</figure>`}function c(t){return`<img src="https://${window.location.host}/equation?tex=${encodeURIComponent(t)}" class="equation" alt="${t.replace(/"/g,"&quot;")}">`}t.exports=function(t,e){e=e||{};var i=function(t){return r(t)},n=function(t,e){return i(t[e].content.trim())},c=function(t){return o(t)},l=function(t,e){return c(t[e].content.trim())+"\n"};t.inline.ruler.after("escape","math_inline",s),t.block.ruler.after("blockquote","math_block",a,{alt:["paragraph","reference","blockquote","list"]}),t.renderer.rules.math_inline=n,t.renderer.rules.math_block=l}},"61e4":function(t,e,i){"use strict";var n=i("b676"),s=i.n(n);s.a},6658:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"confirm-dialog-box"},[i("div",{staticClass:"confirm-dialog"},[i("div",{staticClass:"dialog-header"},[i("div",{staticClass:"dialog-title"},[t._v(t._s(t.title))]),i("button",{staticClass:"close-btn ion-close-round",attrs:{title:"关闭"},on:{click:t.cancel}})]),i("div",{staticClass:"dialog-body"},[i("div",{staticClass:"content"},[t._v(t._s(t.content))])]),i("div",{staticClass:"dialog-footer"},[i("button",{staticClass:"ctrl-btn cancel-btn",on:{click:t.cancel}},[t._v("取消")]),i("button",{staticClass:"ctrl-btn confirm-btn",on:{click:t.confirm}},[t._v("确定")])])])])},s=[],a={props:["title","content"],methods:{cancel(){this.$emit("cancel")},confirm(){this.$emit("confirm")}}},r=a,o=(i("6fc2"),i("2877")),c=Object(o["a"])(r,n,s,!1,null,"cd916810",null);e["a"]=c.exports},6984:function(t,e,i){"use strict";i.r(e),i.d(e,"CLASS_NAME",(function(){return s})),i.d(e,"format",(function(){return a}));var n=i("a061");const s=Object(n["e"])("link");function a(t){t.querySelectorAll("a").forEach(t=>{t.classList.add(s)})}},"6a08":function(t,e,i){"use strict";i.d(e,"b",(function(){return r})),i.d(e,"a",(function(){return l}));var n=i("4791"),s=i.n(n),a=i("c5cc");async function r(t,e){const i=new s.a({userId:t,appId:2608,imageConfig:{serviceId:"k3u1fbpfcp"}});try{const t=await o(),n=e=>new Promise((n,s)=>{const a=i.addFile({file:e,stsToken:t,type:"image"});i.start(a),i.on("complete",t=>{n(t.uploadResult)}),i.on("error",t=>{s(t)})});let s=await Promise.all(e.map(async t=>{const e=await n(t);return e}));return s=await Promise.all(s.map(async t=>{const e=await c(t.Uri);return{ImageHeight:t.ImageHeight,ImageWidth:t.ImageWidth,Url:e.data.main_url}})),s}catch(n){throw new Error("上传图片失败")}}function o(){return Object(a["a"])({url:"/imagex/gen_token",query:{client:"web"}}).then(t=>{const e=t.data.token;return e})}function c(t){return Object(a["a"])({url:"/imagex/get_img_url",query:{uri:t}})}async function l(t){const e=t.startsWith("https:")||t.startsWith("http:")?t:"https:"+t,i={url:e},n=await fetch("/image/urlSave",{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}}),s=await n.json();if(s.err_no)throw new Error(s.err_msg);return s}},"6a2e":function(t,e,i){"use strict";var n=i("886b"),s=i.n(n);s.a},"6b53":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"image-upload-progress-panel"},[n("img",{staticClass:"icon",attrs:{src:i("f9a5")}}),n("div",{staticClass:"text"},[t._v(t._s(t.text))]),t.allowCancel?n("button",{staticClass:"cancel-btn",on:{click:t.cancel}},[t._v(" 取消上传 ")]):t._e()])},s=[],a={props:{text:{default:"图片上传中"},allowCancel:{default:!0}},methods:{cancel(){this.$emit("cancel")}}},r=a,o=(i("9fb7"),i("2877")),c=Object(o["a"])(r,n,s,!1,null,"5e6e6023",null);e["a"]=c.exports},"6c16":function(t,e,i){},"6c54":function(t,e,i){"use strict";i.d(e,"e",(function(){return a})),i.d(e,"d",(function(){return r})),i.d(e,"a",(function(){return o})),i.d(e,"f",(function(){return c})),i.d(e,"b",(function(){return l})),i.d(e,"c",(function(){return u}));var n=i("7669"),s=i("bde8");function a(){return n["d"]()}function r(t){return n["c"](t)}function o(t){return n["a"](t)}function c(t){return n["f"](t)}function l(t){return n["b"](t)}function u(t){return Promise.resolve().then(()=>s["a"].fromDescriptor(Object.assign({title:"",tags:[],markdown:"",html:"",cover_image:"",abstract:"",brief_content:""},t)))}},"6eb1":function(t,e,i){"use strict";var n=i("a580"),s=i.n(n);s.a},"6f6b":function(t,e,i){},"6fc2":function(t,e,i){"use strict";var n=i("e234"),s=i.n(n);s.a},"705e":function(t,e,i){"use strict";i.d(e,"a",(function(){return L}));var n=i("d4cd"),s=i.n(n),a=i("bfe9"),r=i("ee10"),o=i("7cbb");function c(t,e,i){const n=t.renderer.rules[e]||l;t.renderer.rules[e]=function(t,e,s,a,r){return i(t,e,s,a,r,n)}}function l(t,e,i,n,s){return s.renderToken(t,e,i)}function u(t,e){c(t,"fence",d)}function d(t,e,i,n,s,a){const c=t[e],l=c.info.trim()||"bash",u=c.content;if("!"===l)return`<blockquote class="warning"><p>${Object(o["a"])(u)}</p></blockquote>`;{const t=Object(r["b"])(l,u);return`<pre><code lang="${l}" class="hljs ${l}">${t}</code></pre>`}}function h(t,e,i,n){const s=t[e].attrIndex(i);-1===s?t[e].attrPush([i,n]):t[e].attrs[s][1]=n}function f(t,e,i){const n=t[e].attrIndex(i);return-1===n?null:t[e].attrs[n][1]}function p(t,e){c(t,"heading_open",m)}function m(t,e,i,n,s,a){return h(t,e,"class","heading"),a(t,e,i,n,s)}function g(t,e){c(t,"image",b)}function b(t,e,i,n,s,a){const r=t[e],o=r.attrGet("title"),c=r.attrGet("src"),l=r.content;return["<figure><img",c?` src="${c}"`:"",l?` alt="${l}"`:"","><figcaption>",o||"","</figcaption></figure>"].join("")}function v(t,e){c(t,"link_open",_)}function _(t,e,i,n,s,a){const r=f(t,e,"target"),o=f(t,e,"href"),c=null!==r,l=0===(o||"").indexOf("#");return c||l||h(t,e,"target","_blank"),a(t,e,i,n,s)}var C=i("604c"),y=i.n(C),w=i("bc00"),k=i.n(w);const x=t=>{const e={},i=t.renderer.renderInline.bind(t.renderer);t.renderer.renderInline=function(t,n,s){let a=i(t,n,s);if((e["bullet_list"]||0)>0&&(e["list_item"]||0)>0){if(t[0].content.startsWith("[ ] "))return'<input type="checkbox" disabled /> '+a.substr(4);if(t[0].content.startsWith("[x] "))return'<input type="checkbox" disabled checked /> '+a.substr(4)}return a};const n=t.renderer.renderToken.bind(t.renderer);t.renderer.renderToken=function(t,i,s){let a=t[i],r=a.type;if(r.endsWith("_open")){let t=r.substr(0,r.length-5);e[t]=(e[t]||0)+1}else if(r.endsWith("_close")){let t=r.substr(0,r.length-6);e[t]=(e[t]||0)-1}return(e["bullet_list"]||0)>0&&"list_item_open"===r&&(t[i+2].content.startsWith("[ ] ")||t[i+2].content.startsWith("[x] "))&&a.attrPush(["class","task-list-item"]),n(t,i,s)}};var O=x,j=i("7d5c"),E=i.n(j);const A=new E.a;class L{constructor(){this.md=new s.a({html:!0,breaks:!1,linkify:!0,typographer:!1}).use(u).use(p).use(g).use(v).use(y.a).use(O).use(k.a),this.md.linkify.tlds(".py",!1)}toHtml(t){return Object(a["a"])(this.md.render(this.preprocessMarkdown(t)))}preprocessMarkdown(t){return(t||"").replace(/\u3000/g,"&emsp;")}fromHtml(t=""){return A.turndown(t)}}},7116:function(t,e,i){},"71b6":function(t,e,i){},"745c":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"switcher",staticClass:"editor-switcher",class:{active:t.active},attrs:{"st:block":"editorSwitcher"}},[i("div",{staticClass:"toggle-btn",on:{click:t.showDialog}},[i("svg",{attrs:{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[i("path",{attrs:{d:"M4.7998 9.6001L19.1998 9.6001L15.1998 5.6001",stroke:"#86909C","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}}),i("path",{attrs:{d:"M19.1997 14.3999L4.79971 14.3999L8.79971 18.3999",stroke:"#86909C","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}})])]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.active,expression:"active"}],staticClass:"panel",attrs:{"st:name":"switchBtn","st:state":t.currentState.to},on:{click:t.showDialog}},[t._v(" "+t._s(t.currentState.title)+" ")]),t.isDialogVisible?i("ConfirmDialog",{attrs:{title:t.currentState.title,content:t.currentState.content},on:{cancel:t.hideDialog,confirm:t.changeEditor}}):t._e()],1)},s=[],a=i("c5cc"),r=i("7bbb"),o=i("b8ba");function c(t,e){return r["a"]()?Object(a["a"])({url:"/user_api/v1/user/update",method:"post",body:{editor_type:e}}).then(t=>t.data):Promise.reject(Object(o["a"])())}function l(t){return c("editorType",t)}function u(t){return l(t)}function d(t){return u(t)}var h=i("484b"),f=i.n(h),p=i("6658");i("1d15");const m={markdown:{title:"切换为富文本编辑器",content:"切换写作模式后，当前内容不会迁移，但会自动保存为草稿。",to:"richText"},richText:{title:"切换为 Markdown 编辑器",content:"切换写作模式后，当前内容不会迁移，但会自动保存为草稿。",to:"markdown"}};var g={components:{ConfirmDialog:p["a"]},props:["type"],data:()=>({active:!1,isDialogVisible:!1}),computed:{currentState(){return m[this.type]}},mounted(){f()(this.$refs.switcher,{theme:"light",allowHTML:!0,content:'<div style="font-size:14px;padding:8px">'+this.currentState.title+"</div>"})},methods:{showDialog(){this.isDialogVisible=!0,this.active=!1},hideDialog(){this.isDialogVisible=!1},changeEditor(){const t="markdown"===this.currentState.to?"md":"wysiwyg";d(t).then(()=>{window.location.href="/editor/drafts/new?v=2",this.hideDialog()}).catch(t=>{this.$error(t)})}},domEvents:{click({target:t}){this.$el.contains(t)||(this.active=!1)}}},b=g,v=(i("1696"),i("2877")),_=Object(v["a"])(b,n,s,!1,null,"8af99a28",null);e["a"]=_.exports},7590:function(t,e,i){"use strict";i.d(e,"e",(function(){return s})),i.d(e,"d",(function(){return a})),i.d(e,"a",(function(){return r})),i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return c}));var n=i("6c54");i("7669");function s(){return n["e"]()}function a(t){return n["d"](t)}function r(t){return t.id?n["f"](t):n["a"](t).then(e=>{t.id=e.id})}function o(t){return n["b"](t)}function c(t){return n["c"](t)}},"759c":function(t,e,i){"use strict";var n=i("a775"),s=i.n(n);s.a},7600:function(t,e,i){"use strict";var n=i("1684"),s=i.n(n);s.a},7669:function(t,e,i){"use strict";var n=i("e248");i.d(e,"d",(function(){return n["d"]})),i.d(e,"c",(function(){return n["c"]})),i.d(e,"a",(function(){return n["a"]})),i.d(e,"f",(function(){return n["f"]})),i.d(e,"b",(function(){return n["b"]})),i.d(e,"e",(function(){return n["e"]}))},"77f5":function(t,e,i){},"7a61":function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n=i("a061");var s=i("9db5"),a=i("ee10");function r(t){const e=document.createElement("div");return e.innerHTML="string"===typeof t?t:t.outerHTML,o(e),e.innerHTML}function o(t){if(Object(n["c"])(t))t.parentNode.removeChild(t);else{if(Object(n["d"])(t))return Array.prototype.slice.call(t.childNodes).reverse().forEach(e=>{t.parentNode.insertBefore(e,t)}),void t.parentNode.removeChild(t);if(t.className){const e=t.className.split(/\s+/).filter(t=>!Object(n["b"])(t)).join(" ");e?t.className=e:t.removeAttribute("class")}"PRE"!==t.nodeName?([].slice.call(t.attributes||[]).forEach(e=>{Object(n["a"])(e.name)&&t.removeAttribute(e.name)}),Array.prototype.slice.call(t.childNodes).forEach(o)):c(t)}}function c(t){const e=t.getAttribute(s["LANG_ATTR_NAME"])||s["DEFAULT_LANG"];t.classList.add("hljs"),t.classList.add(e),t.innerHTML=`<code class="hljs ${e}" lang="${e}">`+Object(a["b"])(e,t.innerText)+"</code>"}},"7a82":function(t,e,i){"use strict";var n=i("a3a9"),s=i.n(n);s.a},"7af3":function(t,e,i){t.exports=i.p+"img/success.062856d9.svg"},"7b88":function(t,e,i){},"7bbb":function(t,e,i){"use strict";i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return d})),i.d(e,"b",(function(){return h}));var n=i("c5cc");async function s(){return Object(n["a"])({url:"/user_api/v1/user/get",method:"get",query:{aid:2608,not_self:0}}).then(t=>Object.assign({},{user:t.data}))}let a=null,r=!1;function o(t){return r?Promise.resolve(h()):(r=!0,c(t).then(u).then(l).then(h))}function c(t){return Promise.resolve().then(()=>{a=t})}function l(){return Promise.resolve().then(()=>{window.setInterval(u,6e5)})}function u(){return s().then(t=>a.dispatch(a.types.SET_AUTH_INFO,t))}function d(){return!0}function h(){return a.state.auth}},"7c1b":function(t,e,i){},"7c64":function(t,e,i){"use strict";i.r(e),i.d(e,"SET_AUTH_INFO",(function(){return n})),i.d(e,"AUTH_INFO",(function(){return s})),i.d(e,"USER",(function(){return a})),i.d(e,"SET_ERROR_VIEW",(function(){return r})),i.d(e,"ERROR_VIEW",(function(){return o})),i.d(e,"MARKDOWN_LAYOUT",(function(){return c})),i.d(e,"TOGGLE_MARKDOWN_LAYOUT",(function(){return l})),i.d(e,"XIAOCE_LAYOUT",(function(){return u})),i.d(e,"TOGGLE_XIAOCE_LAYOUT",(function(){return d})),i.d(e,"XIAOCE_SUMMARY_LAYOUT",(function(){return h})),i.d(e,"TOGGLE_XIAOCE_SUMMARY_LAYOUT",(function(){return f})),i.d(e,"XIAOCE_DRAFT",(function(){return p}));const n="SET_AUTH_INFO",s="AUTH_INFO",a="USER",r="SET_ERROR_VIEW",o="ERROR_VIEW",c="MARKDOWN_LAYOUT",l="TOGGLE_MARKDOWN_LAYOUT",u="XIAOCE_LAYOUT",d="TOGGLE_XIAOCE_LAYOUT",h="XIAOCE_SUMMARY_LAYOUT",f="TOGGLE_XIAOCE_SUMMARY_LAYOUT",p="XIAOCE_DRAFT"},"7cbb":function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var n=i("b9bf");function s(t){return Object(n["htmlEncode"])(t||"")}},"7db0":function(t,e,i){},"7e48":function(t,e,i){"use strict";i.d(e,"b",(function(){return r})),i.d(e,"d",(function(){return o})),i.d(e,"c",(function(){return c})),i.d(e,"h",(function(){return l})),i.d(e,"a",(function(){return u})),i.d(e,"e",(function(){return d})),i.d(e,"i",(function(){return h})),i.d(e,"g",(function(){return f})),i.d(e,"f",(function(){return p}));var n=i("c5cc");const s={title:1,cover_img:2,status:3,summary:4,finished_time:5,section_ids:6,is_finished:7,category_id:8},a={title:1,content:2,markdown_content:2,status:3,is_free:4};function r(){return Object(n["a"])({url:"/booklet_api/v1/booklet/create",method:"post",body:{}}).then(t=>t.data)}function o({cursor:t}={cursor:0}){return Object(n["a"])({url:"/booklet_api/v1/booklet/draft_list",method:"post",body:{cursor:Number(t),limit:20}})}function c({booklet_id:t}){return Object(n["a"])({url:"/booklet_api/v1/booklet/draft",method:"post",body:{booklet_id:String(t)}}).then(t=>t.data)}function l({booklet_id:t,title:e,summary:i,status:a,is_finished:r,cover_img:o,section_ids:c,category_id:l,change_field:u}){return Object(n["a"])({url:"/booklet_api/v1/booklet/update",method:"post",body:{booklet_id:String(t),title:e&&String(e),summary:i&&String(i),status:a,is_finished:r,cover_img:o,section_ids:c&&String(c),category_id:l&&String(l),change_field:s[u]}}).then(t=>t.data)}function u({booklet_id:t,title:e}){return Object(n["a"])({url:"/booklet_api/v1/section/add",method:"post",body:{booklet_id:String(t),title:e&&String(e)}}).then(t=>t.data)}function d({section_id:t}){return Object(n["a"])({url:"/booklet_api/v1/section/draft",method:"post",body:{section_id:String(t)}}).then(t=>t.data)}function h({section_id:t,title:e,content:i,markdown_content:s,status:r,is_free:o,change_field:c}){return Object(n["a"])({url:"/booklet_api/v1/section/update",method:"post",body:{section_id:t&&String(t),title:e&&String(e),content:i&&String(i),markdown_content:s&&String(s),status:r,is_free:o,change_field:a[c]},showError:!1})}function f({booklet_id:t}){return Object(n["a"])({url:"/booklet_api/v1/booklet/submit",method:"post",body:{booklet_id:t&&String(t)}}).then(t=>t.data)}function p({show_type:t}={show_type:2}){return Object(n["a"])({url:"/tag_api/v1/query_category_briefs",method:"get",query:{show_type:t}}).then(t=>t.data)}},"7e9c":function(t,e,i){},"7f42":function(t,e,i){"use strict";i.r(e),i.d(e,"CLASS_NAME",(function(){return s})),i.d(e,"format",(function(){return a}));var n=i("a061");const s=Object(n["e"])("bold");function a(t){t.querySelectorAll("b").forEach(t=>{t.classList.add(s)})}},"7ffa":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAAmCAYAAACoPemuAAAACXBIWXMAACE4AAAhOAFFljFgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAP3SURBVHgB7ZhPSFRRFMa/92ZKK0UzIisiFJJIqUAqily6rMSCVtEyiCDIVbQIWhTUInLfskAXQWGbNhWFUlFUUBBlkSYSmKVpf8yZ6Tt537zz7twZnXHergMf574388793T/v3Hsf8N+KMw9lsEwms4Ku3qja3J6mpqh3nud9R5FWMhhhWui2UrupTZRPJYy3y4PUM6qPkG8WEr9oMAI10x02UAkFIbGSeQD19VPqFgFvohxgBFpNd5xqUZUkTYyEurZ7LGGVg9/vUhcIOFIyGKHa6I5SVQh7x3cAJRxArntBY2TunSfcjaLBCNVBd9CC8RyVJh1lF5RvNU7UTbgrut7kPFAH6ERpE8gzZQmcMUqb4FIepcbMdQ21WXWAp2A0lOgU6/IJd3leMP5xD90+BQVVTpvrn9Q96jH1noGnHXFaTeM6LDhfQYq6+N8RxugF8gwl/7CK7gzCnORbkh67Q/Uy0A8swBhzHd0J6hCi8zOYFuInqXbGHM4Hdoxuu9W6oPybusaHH6AEY+xOurOYG+qEFVv8AGN3eI4Hd9EdMZcuqIt8cAiLMNaxhU6GrFbB6fr2+47ndlIphBM7pfz1xUKJMcZrunPI7bFAp32rJevpGgyIDdXPgP0ok5lJfhW5OU+u2+wea80DJepD+e0S5hb6nGXMBmvMAyYTchxlNsacoOuBY8nKgnEYK+nWWFCzpvwE8dltAxRZZ3WCXYswcQJhNmfDvEHEZy8RXc7kRcjooZQeC+aT7q1PiNHMcI4gTLL/bmuwCgOk04RoGvHbR/uGBrOB9FyL1can8A0FwH4pKK1qxGx1VehGATChTiOaLkRVfGMrEK89pLoQDun97Fpp0sXJ4NIoKPfIio8YTPZhdEvNZTBtwreSFctQykYveBu1GhGfLYFjt2tn/rcIXwI9nE1xDKfprUo4jn022DDc80wSYCvKb8sRPR9kyxEwDqck0yGEaUKnjGa2sAllMsZaRicneN+htGs/9ghzw6nhAsAdDLgSi4eSyV6L3F1FoD85YOYA6hpS8dLV7QzcgBKNz0perEc4bJ4FN0uGGa/Aw50IT1E2oEgW9ldFHEakUjnk1CJ3ZdGrzhfGTHsFAsmHkr3qIddWW/wHasi1X2MM6QmZ4NLQGnM7H5ToK+PIkbDwSZyB5aS0DdFhdcEFuU9WjxmEb3ISuTvhlCOeaIJQk0HdBU/i/ONzwkmLWiyojBU0WCWqze86SWe3Mgj3eBlED78RKCC6VuaDe0E3YHpCL1OwynoZc30ScJ3CxcZYR87uopjPUJJzZGjljXINp2u4UnDnRJEcQkYJNeuqr5QPdxvpNlB1BQClsgzcezv59PR5vrf5L3DbsAS2sZpdAAAAAElFTkSuQmCC"},"80e9":function(t,e,i){},8510:function(t,e,i){},8690:function(t,e,i){"use strict";i.d(e,"c",(function(){return s})),i.d(e,"h",(function(){return r})),i.d(e,"g",(function(){return o})),i.d(e,"b",(function(){return c})),i.d(e,"i",(function(){return l})),i.d(e,"f",(function(){return u})),i.d(e,"e",(function(){return d})),i.d(e,"a",(function(){return h})),i.d(e,"d",(function(){return f}));var n=i("c34c");function s(t){const e=a().height,i=t.getBoundingClientRect().bottom;return e-i}function a(){const t=document.documentElement;return{width:Math.max(t.clientWidth,window.innerWidth||0),height:Math.max(t.clientHeight,window.innerHeight||0)}}function r(t,e,i=100){const s=Object(n["b"])(e,i);return t.addEventListener("mousewheel",s,!1),t.addEventListener("DOMMouseScroll",s,!1),function(){t.removeEventListener("mousewheel",s,!1),t.removeEventListener("DOMMouseScroll",s,!1)}}function o(t,e,i,n=!1){return t.addEventListener(e,i,n),function(){t.removeEventListener(e,i,n)}}function c(t,e){const i=window.getSelection(),n=document.createRange();n.selectNode(t),n.collapse(e),i.removeAllRanges(),i.addRange(n)}function l(t){const e=window.getSelection(),i=document.createRange();i.selectNode(t),e.removeAllRanges(),e.addRange(i)}function u(t,e){e=e||document.body;const i=e.getBoundingClientRect(),n=t.getBoundingClientRect();return{top:n.top-i.top,left:n.left-i.left}}function d(t,e){while(t){if(t.nodeName===e)return t;t=t.parentNode}return null}function h(t){try{const e=(new window.DOMParser).parseFromString(t,"text/html");return e.body}catch(e){const i=document.implementation.createHTMLDocument("");return i.body.innerHTML=t,i.body}}function f(t,e){const i=e.getBoundingClientRect().bottom,n=t.getBoundingClientRect().bottom;return i-n}},8780:function(t,e,i){"use strict";var n=i("1ec1"),s=i.n(n);s.a},"886b":function(t,e,i){},8896:function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return c}));const n=[{name:"jpg",regx:/^ffd8ff/},{name:"gif",regx:/^474946/},{name:"png",regx:/89504e47/},{name:"webp",regx:/52494646/},{name:"bmp",regx:/^424d/},{name:"any",regx:/./}];function s(t,e){return a(t).then(r).then(o.bind(null,e))}function a(t){return new Promise((e,i)=>{let n=new window.FileReader;n.onload=t=>e(t.target.result),n.onerror=t=>i(t),n.readAsArrayBuffer(t.slice(0,64))})}function r(t){return Array.prototype.slice.call(new Uint8Array(t)).reduce((t,e)=>t+e.toString(16),"")}function o(t,e){for(let i=0;i<n.length;i++)if(n[i].regx.test(e))return-1!==t.indexOf(n[i].name);return!1}function c(t){return new Promise((e,i)=>{if("undefined"===typeof window.FileReader)return void i(new Error("浏览器不支持 FileReader，请升级浏览器"));const n=new window.FileReader;n.onerror=()=>{i(new Error("文件读取失败"))},n.onload=()=>{e(n.result)},n.readAsText(t)})}},"88f3":function(t,e,i){"use strict";var n,s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"markdown-editor",attrs:{"st:block":"markdownEditor"}},[i("EditorHeader",{ref:"header",attrs:{guided:t.guided,post:t.post,status:t.status},on:{titleSubmit:t.onTitleSubmit,update:t.requestUpdate,publish:t.publish}}),t.initLoading?t._e():i("Editor",{staticClass:"main",attrs:{value:t.post.markdown,plugins:t.plugins,locale:t.locale,uploadImages:t.uploadImages},on:{change:t.handleChange}}),t.imageLoading?i("ImageUploadProgressPanel",{attrs:{text:"图片解析中...",allowCancel:!1}}):t._e()],1)},a=[],r=i("c34c"),o=i("cecb"),c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("header",{staticClass:"header editor-header",attrs:{"st:block":"editorHeader"}},[i("div",{staticClass:"left-box"}),i("TitleInput",{staticClass:"title-input",attrs:{value:t.post.title},on:{input:t.onTitleUpdate,submit:function(e){return t.$emit("titleSubmit")}}}),i("div",{staticClass:"right-box"},[i("StatusText",{staticClass:"status-text with-padding",attrs:{status:t.status}}),i("Button",{staticClass:"with-padding",attrs:{outline:""},nativeOn:{click:function(e){return t.goToDraft(e)}}},[t._v(" 草稿箱 ")]),i("PublishPopup",{staticClass:"publish-popup with-padding",attrs:{post:t.post,disabled:"saving"===t.status},on:{update:function(e){return t.$emit("update")},publish:t.publish}}),i("EditorSwitcher",{staticClass:"editor-switcher with-padding",attrs:{type:"markdown"}}),i("MainNavigator",{staticClass:"main-navigator with-padding"})],1)],1)},l=[],u=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("input",{directives:[{name:"model",rawName:"v-model",value:t.innerValue,expression:"innerValue"}],ref:"input",staticClass:"title-input",attrs:{placeholder:"输入文章标题...",spellcheck:"false",maxlength:t.maxlength},domProps:{value:t.innerValue},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.$emit("submit")},input:function(e){e.target.composing||(t.innerValue=e.target.value)}}})},d=[],h=i("3bba"),f={props:["value"],data:()=>({maxlength:h["a"],innerValue:""}),watch:{value:{handler(t,e){this.innerValue=t},immediate:!0},innerValue(t,e){this.$emit("input",t)}},mounted(){this.$refs.input.focus()}},p=f,m=(i("5b36"),i("2877")),g=Object(m["a"])(p,u,d,!1,null,"33c29ee7",null),b=g.exports,v=i("8bb0"),_=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"main-image-selector",class:{active:t.active,unset:t.unset,updating:t.updating}},[i("div",{staticClass:"toggle-btn",on:{click:function(e){t.active=!t.active}}},[i("svg",{attrs:{width:"26",height:"26",viewBox:"0 0 30 30",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[i("path",{attrs:{d:"M24.375 3.75H5.625C4.58947 3.75 3.75 4.58947 3.75 5.625V24.375C3.75 25.4105 4.58947 26.25 5.625 26.25H24.375C25.4105 26.25 26.25 25.4105 26.25 24.375V5.625C26.25 4.58947 25.4105 3.75 24.375 3.75Z",stroke:"currentColor","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"}}),i("path",{attrs:{d:"M11.25 14.375C12.9759 14.375 14.375 12.9759 14.375 11.25C14.375 9.52411 12.9759 8.125 11.25 8.125C9.52411 8.125 8.125 9.52411 8.125 11.25C8.125 12.9759 9.52411 14.375 11.25 14.375Z",stroke:"currentColor","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"}}),i("path",{attrs:{d:"M17.3688 16.387C17.879 15.7042 18.908 15.721 19.3956 16.4202L24.8798 24.285C25.4576 25.1137 24.8647 26.25 23.8544 26.25H10L17.3688 16.387Z",stroke:"currentColor","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"}})])]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.active,expression:"active"}],staticClass:"panel"},[i("div",{staticClass:"title"},[t._v("上传封面大图")]),i("button",{directives:[{name:"show",rawName:"v-show",value:t.unset,expression:"unset"}],staticClass:"select-btn",attrs:{disabled:t.updating,"st:name":"addBtn"},on:{click:t.selectImageFile}},[t._v(" "+t._s(t.prompt)+" ")]),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.unset,expression:"!unset"}],staticClass:"preview-box"},[i("img",{staticClass:"preview-image",attrs:{src:t.thumbUrl}}),i("button",{staticClass:"delete-btn",attrs:{title:"移除这张图片","st:name":"removeBtn"},on:{click:t.deleteImage}},[i("i",{staticClass:"ion-trash-a"})])])]),i("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"file",attrs:{type:"file"},on:{change:function(e){return t.onFileSelected(e)}}})])},C=[],y=i("5c91"),w=i("6a08"),k={props:["post"],data:()=>({active:!1,updating:!1}),computed:{unset(){return!this.post.cover_image},prompt(){return this.updating?"头图设置中...":"点击此处添加图片"},thumbUrl(){const t=this.post.cover_image;return t?Object(y["b"])(t,480,480):""}},methods:{selectImageFile(){this.$refs.file.click()},onFileSelected({target:t}){const e=t.files[0];e&&(this.$refs.file.value=null,this.changeMainImage(e))},changeMainImage(t){return this.updating=!0,Object(w["b"])(this.post.user_id,[t]).then(t=>{this.post.cover_image=t[0]&&t[0].Url,this.updating=!1}).catch(t=>{t.message=t.message||"头图设置失败",this.$error(t),this.updating=!1})},deleteImage(){this.post.cover_image=null}},domEvents:{click({target:t}){this.$el.contains(t)||(this.active=!1)}}},x=k,O=(i("98ec"),Object(m["a"])(x,_,C,!1,null,"e65e57fa",null)),j=O.exports,E=i("745c"),A=i("0524"),L=i("e0a3"),S=i("3d66"),T=i("59be"),I=i("a0f4"),D=i("acec");(function(t){t[t["UserType"]=1]="UserType",t[t["Tag"]=9]="Tag",t[t["Collection"]=10]="Collection",t[t["PinType"]=4]="PinType",t[t["Topic"]=11]="Topic",t[t["Team"]=21]="Team",t[t["ArticleIdType"]=2]="ArticleIdType",t[t["JobIdType"]=22]="JobIdType",t[t["ResumeIdType"]=23]="ResumeIdType",t[t["Collumn"]=24]="Collumn",t[t["Draft"]=3]="Draft"})(n||(n={}));var $=Object(I["defineComponent"])({components:{TitleInput:b,StatusText:v["a"],MainImageSelectorV2:j,EditorSwitcher:E["a"],PublishPopup:A["a"],MainNavigator:L["a"],NewButton:S["a"],Button:T["a"]},props:["guided","post","status"],data:()=>({draftCount:0}),mounted(){Object(D["a"])({id_types:[n.Draft]}).then(t=>{if(!t.err_no){const{draft_cnt:e}=t.data||{};this.draftCount=(null===e||void 0===e?void 0:e.all_cnt)||0}})},methods:{onTitleUpdate(t){this.post.title=t},publish(...t){this.$emit("publish",...t)},goToDraft(){window.open("/creator/content/article/drafts")}}}),N=$,M=(i("960a"),Object(m["a"])(N,c,l,!1,null,"c5c24ff2",null)),U=M.exports,P=i("3dc0"),F=i("a295"),R=i("ea37"),H=i("1b28"),B=i("6b53"),V={components:{EditorHeader:U,Editor:P["Editor"],ImageUploadProgressPanel:B["a"]},props:["guided","post","status","initLoading"],data(){return{imageLoading:!1,preview:{}}},computed:{plugins(){return[...H["a"],Object(H["c"])({onLoadingChange:t=>{this.imageLoading=t},catchError:()=>{this.$error("图片地址解析失败")}})]},locale(){return F},wordCount(){return Object(R["b"])(this.post.markdown)},notNeedConfirmedUpdate(){return[this.post.title,this.post.category,this.post.tags,this.post.cover_image,this.post.markdown]}},watch:{notNeedConfirmedUpdate(){this.requestUpdate()}},created(){this.requestUpdate=Object(r["a"])(()=>{this.guided||this.update()},o["a"])},methods:{async uploadImages(t){const e=await Object(w["b"])("",t);return e.map(t=>({url:t.Url}))},handleChange(t){this.post.markdown=t},onTitleSubmit(){},update(){this.post.html="deprecated",this.$emit("update")},publish(...t){this.$emit("publish",...t)}}},q=V,X=(i("a86c"),i("39f1"),Object(m["a"])(q,s,a,!1,null,null,null));e["a"]=X.exports},"895a":function(t,e,i){"use strict";var n=i("dee8"),s=i.n(n);s.a},8980:function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i.d(e,"d",(function(){return a})),i.d(e,"c",(function(){return r})),i.d(e,"h",(function(){return o})),i.d(e,"f",(function(){return c})),i.d(e,"b",(function(){return l})),i.d(e,"e",(function(){return u})),i.d(e,"g",(function(){return d}));var n=i("c5cc");const s={content_id:"",category_id:"",thumbnail:"",title:"",brief:"",content:""};function a(t){return Object(n["a"])({url:"/content_api/v1/news/version/list",method:"post",body:{page_no:t,page_size:20}})}async function r(t){if("new"===t||!t)return s;const e=await Object(n["a"])({url:"/content_api/v1/news/version/get",method:"post",body:{content_id:t,client_type:2608}});return e.data}async function o(t){var e;if(t.content_id&&"new"!==t.content_id)return await Object(n["a"])({url:"/content_api/v1/news/version/update",method:"post",body:Object.assign(Object.assign({},t),{category_id:t.category_id||"0",format:"markdown"})}),t.content_id;{const i=await Object(n["a"])({url:"/content_api/v1/news/version/create",method:"post",body:Object.assign(Object.assign({},t),{category_id:t.category_id||"0",format:"markdown"})});return null===(e=i.data)||void 0===e?void 0:e.content_id}}async function c(){const t=await Object(n["a"])({url:"/tag_api/v1/query_item_categories?item_type=27"});return t.data}async function l(t){var e;const i=await Object(n["a"])({url:"/content_api/v1/news/version/gen_abstract",method:"post",body:{content_id:t}});return(null===(e=i.data)||void 0===e?void 0:e.text)||""}async function u(t){const e=await Object(n["a"])({url:"/content_api/v1/news/publish",method:"post",body:{content_id:t}});return e}async function d(t){const e=await Object(n["a"])({url:"/content_api/v1/news/delete",method:"post",body:{content_id:t}});return e}},"8a2c":function(t,e,i){},"8a69":function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));class n{}n.fromDescriptor=function(t){return t?Object.assign(new n,t,{title:t.title?t.title:t.tag_name}):null}},"8aea":function(t,e,i){t.exports=i.p+"img/editor-more.6937009a.svg"},"8bb0":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"status-text",attrs:{title:t.title},domProps:{innerHTML:t._s(t.html)}})},s=[],a={props:{status:{type:String,required:!0},defaultText:{type:String,default:"文章将自动保存至草稿箱"}},data:()=>({html:"",lastSaveTime:null}),computed:{title(){return this.lastSaveTime?"最近保存于 "+this.lastSaveTime.toLocaleString():""}},watch:{status(){switch(this.status){case"saving":this.html="保存中...";break;case"error":this.html="出现错误";break;case"editing":this.html="保存成功",this.lastSaveTime=new Date;break;default:this.html=DEFAULT_HTML}}},created(){this.html=this.defaultText}},r=a,o=(i("591d"),i("2877")),c=Object(o["a"])(r,n,s,!1,null,"98c9024a",null);e["a"]=c.exports},"8e2d":function(t,e,i){},"8f6b":function(t,e,i){"use strict";var n=i("7116"),s=i.n(n);s.a},"906a":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"coverselector_container"},[t.cover?i("div",{staticClass:"preview-box"},[i("img",{staticClass:"preview-image",attrs:{src:t.thumbUrl}}),i("button",{staticClass:"delete-btn",attrs:{title:"移除这张照片"},on:{click:function(e){return e.stopPropagation(),t.deleteImage(e)}}},[i("i",{staticClass:"ion-trash-a"})])]):i("div",[i("button",{staticClass:"select-btn",attrs:{disabled:t.updating},on:{click:t.selectImgFile}},[t._m(0)]),t.message?i("div",{staticClass:"addvice"},[t._v(t._s(t.message))]):t._e()]),i("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"file",attrs:{type:"file"},on:{change:t.onFileSelected}})])},s=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"button-slot"},[n("img",{attrs:{src:i("35ea"),height:"20",alt:"add_cover"}}),n("div",{staticClass:"upload"},[t._v("上传封面")])])}],a=i("a0f4"),r=i("6a08"),o=i("5c91"),c=Object(a["defineComponent"])({data(){return{updating:!1}},model:{prop:"cover",event:"changeCover"},props:{userid:{type:String},message:{type:String},cover:{type:String,required:!0}},computed:{thumbUrl(){return this.cover?Object(o["b"])(this.cover,480,480):""}},methods:{selectImgFile(){this.$refs.file.click()},onFileSelected({target:t}){const e=t.files[0];e&&(this.$refs.file.value=null,this.changMainImage(e))},changMainImage(t){return this.updating=!0,Object(r["b"])(this.userid,[t]).then(t=>{this.$emit("changeCover",t[0]&&t[0].Url)}).catch(t=>{t.message=t.message||"封面设置失败",this.$error(t)}).finally(()=>{this.updating=!1})},deleteImage(){this.$emit("changeCover","")}}}),l=c,u=(i("1361"),i("2877")),d=Object(u["a"])(l,n,s,!1,null,"0338d66e",null);e["a"]=d.exports},9221:function(t,e,i){"use strict";var n=i("43b4"),s=i.n(n);s.a},9258:function(t,e,i){"use strict";var n=i("6c16"),s=i.n(n);s.a},"94c5":function(t,e,i){},"95c6":function(t,e,i){},"960a":function(t,e,i){"use strict";var n=i("3803"),s=i.n(n);s.a},"964c":function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"a",(function(){return a}));const n=window.localStorage;function s(t,e){return n.setItem(t,JSON.stringify(e))}function a(t){return JSON.parse(n.getItem(t))}},"98ec":function(t,e,i){"use strict";var n=i("8a2c"),s=i.n(n);s.a},"992a":function(t,e,i){t.exports=i.p+"img/md.555fde04.svg"},"9af7":function(t,e,i){},"9bdd":function(t,e,i){},"9db5":function(t,e,i){"use strict";i.r(e),i.d(e,"CLASS_NAME",(function(){return s})),i.d(e,"LANG_ATTR_NAME",(function(){return a})),i.d(e,"DEFAULT_LANG",(function(){return r})),i.d(e,"format",(function(){return o}));var n=i("a061");const s=Object(n["e"])("highlight"),a="code-lang",r="bash";function o(t){t.querySelectorAll("pre").forEach(t=>{t.classList.add(s)})}},"9fb7":function(t,e,i){"use strict";var n=i("8e2d"),s=i.n(n);s.a},a061:function(t,e,i){"use strict";i.d(e,"e",(function(){return o})),i.d(e,"b",(function(){return c})),i.d(e,"a",(function(){return l})),i.d(e,"d",(function(){return u})),i.d(e,"c",(function(){return d}));const n="juejin-editor-",s="juejin-editor-",a="is-juejin-editor-element",r="is-juejin-editor-container";function o(t){return`${n}${t}`}function c(t){return 0===t.indexOf(n)}function l(t){return 0===t.indexOf(s)}function u(t){return t.hasAttribute&&t.hasAttribute(a)}function d(t){return t.hasAttribute&&t.hasAttribute(r)}},a0bb:function(t,e,i){"use strict";var n=i("9bdd"),s=i.n(n);s.a},a175:function(t,e,i){"use strict";var n=i("da4a"),s=i.n(n);s.a},a1fe:function(t,e,i){"use strict";var n=i("ee38"),s=i.n(n);s.a},a3a9:function(t,e,i){},a580:function(t,e,i){},a63d:function(t,e,i){t.exports=i.p+"img/add.c5c64e06.svg"},a6fd:function(t,e,i){t.exports=i.p+"img/must.7cec75bb.svg"},a775:function(t,e,i){},a86c:function(t,e,i){"use strict";var n=i("231f"),s=i.n(n);s.a},abd9:function(t,e,i){"use strict";i.r(e),i.d(e,"BLOCK_LEVEL_ELEMENT_LIST",(function(){return n})),i.d(e,"VOID_ELEMENT_LIST",(function(){return s})),i.d(e,"CHAR_MAP",(function(){return a}));const n=["ADDRESS","ARTICLE","ASIDE","BLOCKQUOTE","CANVAS","DD","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FIGCAPTION","FOOTER","FORM","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","LI","MAIN","NAV","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TFOOT","UL","VIDEO"],s=["AREA","BASE","BR","COL","EMBED","HR","IMG","INPUT","KEYGEN","LINK","MENUITEM","META","PARAM","SOURCE","TRACK","WBR"],a={"&quot;":'"',"&#34;":'"',"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&nbsp;":" ","&#160;":" "}},acec:function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"a",(function(){return a}));var n=i("c5cc");function s(t){return Object(n["a"])({url:"/content_api/v1/column/self_center_list",method:"post",body:t})}function a(t){return Object(n["a"])({url:"/content_api/v1/author_center/count",method:"post",body:t})}},b33b:function(t,e,i){},b675:function(t,e,i){"use strict";var n=i("e096"),s=i.n(n);s.a},b676:function(t,e,i){},b8ba:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));function n(t){const e=new Error(t||"unauthorized");return e.normalizedCode=401,e}},bafc:function(t,e,i){"use strict";var n=i("c80e"),s=i.n(n);s.a},bc00:function(t,e,i){"use strict";function n(t,e,i,n){var s=Number(t[e].meta.id+1).toString(),a="";return"string"===typeof n.docId&&(a="-"+n.docId+"-"),a+s}function s(t,e){var i=Number(t[e].meta.id+1).toString();return t[e].meta.subId>0&&(i+=":"+t[e].meta.subId),"["+i+"]"}function a(t,e,i,n,s){var a=s.rules.footnote_anchor_name(t,e,i,n,s),r=s.rules.footnote_caption(t,e,i,n,s),o=a;return t[e].meta.subId>0&&(o+=":"+t[e].meta.subId),'<sup class="footnote-ref"><a href="#fn'+a+'" id="fnref'+o+'">'+r+"</a></sup>"}function r(t,e,i){return(i.xhtmlOut?'<hr class="footnotes-sep" />\n':'<hr class="footnotes-sep">\n')+'<section class="footnotes">\n<ol class="footnotes-list">\n'}function o(){return"</ol>\n</section>\n"}function c(t,e,i,n,s){var a=s.rules.footnote_anchor_name(t,e,i,n,s);return t[e].meta.subId>0&&(a+=":"+t[e].meta.subId),'<li id="fn'+a+'" class="footnote-item">'}function l(){return"</li>\n"}function u(t,e,i,n,s){var a=s.rules.footnote_anchor_name(t,e,i,n,s);return t[e].meta.subId>0&&(a+=":"+t[e].meta.subId),' <a href="#fnref'+a+'" class="footnote-backref">↩︎</a>'}t.exports=function(t){var e=t.helpers.parseLinkLabel,i=t.utils.isSpace;function d(t,e,n,s){var a,r,o,c,l,u,d,h,f,p,m,g=t.bMarks[e]+t.tShift[e],b=t.eMarks[e];if(g+4>b)return!1;if(91!==t.src.charCodeAt(g))return!1;if(94!==t.src.charCodeAt(g+1))return!1;for(l=g+2;l<b;l++){if(32===t.src.charCodeAt(l))return!1;if(93===t.src.charCodeAt(l))break}if(l===g+2)return!1;if(l+1>=b||58!==t.src.charCodeAt(++l))return!1;if(s)return!0;l++,t.env.footnotes||(t.env.footnotes={}),t.env.footnotes.refs||(t.env.footnotes.refs={}),u=t.src.slice(g+2,l-2),t.env.footnotes.refs[":"+u]=-1,d=new t.Token("footnote_reference_open","",1),d.meta={label:u},d.level=t.level++,t.tokens.push(d),a=t.bMarks[e],r=t.tShift[e],o=t.sCount[e],c=t.parentType,m=l,h=f=t.sCount[e]+l-(t.bMarks[e]+t.tShift[e]);while(l<b){if(p=t.src.charCodeAt(l),!i(p))break;9===p?f+=4-f%4:f++,l++}return t.tShift[e]=l-m,t.sCount[e]=f-h,t.bMarks[e]=m,t.blkIndent+=4,t.parentType="footnote",t.sCount[e]<t.blkIndent&&(t.sCount[e]+=t.blkIndent),t.md.block.tokenize(t,e,n,!0),t.parentType=c,t.blkIndent-=4,t.tShift[e]=r,t.sCount[e]=o,t.bMarks[e]=a,d=new t.Token("footnote_reference_close","",-1),d.level=--t.level,t.tokens.push(d),!0}function h(t,i){var n,s,a,r,o,c=t.posMax,l=t.pos;return!(l+2>=c)&&(94===t.src.charCodeAt(l)&&(91===t.src.charCodeAt(l+1)&&(n=l+2,s=e(t,l+1),!(s<0)&&(i||(t.env.footnotes||(t.env.footnotes={}),t.env.footnotes.list||(t.env.footnotes.list=[]),a=t.env.footnotes.list.length,t.md.inline.parse(t.src.slice(n,s),t.md,t.env,o=[]),r=t.push("footnote_ref","",0),r.meta={id:a},t.env.footnotes.list[a]={tokens:o}),t.pos=s+1,t.posMax=c,!0))))}function f(t,e){var i,n,s,a,r,o=t.posMax,c=t.pos;if(c+3>o)return!1;if(!t.env.footnotes||!t.env.footnotes.refs)return!1;if(91!==t.src.charCodeAt(c))return!1;if(94!==t.src.charCodeAt(c+1))return!1;for(n=c+2;n<o;n++){if(32===t.src.charCodeAt(n))return!1;if(10===t.src.charCodeAt(n))return!1;if(93===t.src.charCodeAt(n))break}return n!==c+2&&(!(n>=o)&&(n++,i=t.src.slice(c+2,n-1),"undefined"!==typeof t.env.footnotes.refs[":"+i]&&(e||(t.env.footnotes.list||(t.env.footnotes.list=[]),t.env.footnotes.refs[":"+i]<0?(s=t.env.footnotes.list.length,t.env.footnotes.list[s]={label:i,count:0},t.env.footnotes.refs[":"+i]=s):s=t.env.footnotes.refs[":"+i],a=t.env.footnotes.list[s].count,t.env.footnotes.list[s].count++,r=t.push("footnote_ref","",0),r.meta={id:s,subId:a,label:i}),t.pos=n,t.posMax=o,!0)))}function p(t){var e,i,n,s,a,r,o,c,l,u,d=!1,h={};if(t.env.footnotes&&(t.tokens=t.tokens.filter((function(t){return"footnote_reference_open"===t.type?(d=!0,l=[],u=t.meta.label,!1):"footnote_reference_close"===t.type?(d=!1,h[":"+u]=l,!1):(d&&l.push(t),!d)})),t.env.footnotes.list)){for(r=t.env.footnotes.list,o=new t.Token("footnote_block_open","",1),t.tokens.push(o),e=0,i=r.length;e<i;e++){for(o=new t.Token("footnote_open","",1),o.meta={id:e,label:r[e].label},t.tokens.push(o),r[e].tokens?(c=[],o=new t.Token("paragraph_open","p",1),o.block=!0,c.push(o),o=new t.Token("inline","",0),o.children=r[e].tokens,o.content="",c.push(o),o=new t.Token("paragraph_close","p",-1),o.block=!0,c.push(o)):r[e].label&&(c=h[":"+r[e].label]),t.tokens=t.tokens.concat(c),a="paragraph_close"===t.tokens[t.tokens.length-1].type?t.tokens.pop():null,s=r[e].count>0?r[e].count:1,n=0;n<s;n++)o=new t.Token("footnote_anchor","",0),o.meta={id:e,subId:n,label:r[e].label},t.tokens.push(o);a&&t.tokens.push(a),o=new t.Token("footnote_close","",-1),t.tokens.push(o)}o=new t.Token("footnote_block_close","",-1),t.tokens.push(o)}}t.renderer.rules.footnote_ref=a,t.renderer.rules.footnote_block_open=r,t.renderer.rules.footnote_block_close=o,t.renderer.rules.footnote_open=c,t.renderer.rules.footnote_close=l,t.renderer.rules.footnote_anchor=u,t.renderer.rules.footnote_caption=s,t.renderer.rules.footnote_anchor_name=n,t.block.ruler.before("reference","footnote_def",d,{alt:["paragraph","reference"]}),t.inline.ruler.after("image","footnote_inline",h),t.inline.ruler.after("footnote_inline","footnote_ref",f),t.core.ruler.after("inline","footnote_tail",p)}},bc16:function(t,e,i){"use strict";var n=i("e82a"),s=i.n(n);s.a},bc2f:function(t,e,i){"use strict";var n=i("df41"),s=i.n(n);s.a},bde8:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n=i("e974"),s=i("8a69");class a{static fromDescriptor(t,e){if(!t)return null;let i={};return"detail"===e?(t.article_draft=t.article_draft||{},i=Object.assign(new a,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},t),t.article_draft),t.author_user_info),t.user_interact),{type:t.article_draft.edit_type,abstract:t.article_draft.brief_content,tags:(t.tags||[]).map(s["a"].fromDescriptor),category:n["a"].fromServerDescriptor(t.category),createdAt:t.article_draft.ctime&&new Date(Number(1e3*t.article_draft.ctime)),updatedAt:t.article_draft.mtime&&new Date(Number(1e3*t.article_draft.mtime)),html:t.article_draft.html_content,markdown:t.article_draft.mark_content}))):i=Object.assign(new a,t,{id:t.id,abstract:t.brief_content},{tags:(t.tags||[]).map(s["a"].fromDescriptor),category:n["a"].fromServerDescriptor({id:t.category_id,name:t.category_name,isSubscribe:t.isSubscribe}),createdAt:t.ctime&&new Date(Number(1e3*t.ctime)),updatedAt:t.mtime&&new Date(Number(1e3*t.mtime))}),i}}},be41:function(t,e,i){},be6f:function(t,e,i){},be86:function(t,e,i){t.exports=i.p+"img/md.555fde04.svg"},beff:function(t,e,i){"use strict";var n=i("3e53"),s=i.n(n);s.a},bf5f:function(t,e,i){t.exports=i.p+"img/move-icon.5b802847.svg"},bfd0:function(t,e,i){"use strict";var n=i("b33b"),s=i.n(n);s.a},bfe9:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n=i("b23e"),s=i.n(n);function a(t){return s.a.sanitize(t,{ADD_ATTR:["autoplay","controls","loop","preload","target"],FORBID_TAGS:["style"]})}},c32a:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},s=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"view not-found-view"},[i("h1",[t._v("404")]),i("p",[t._v("此页面不存在")])])}],a={metaInfo(){return{title:"此页面不存在"}}},r=a,o=(i("ee80"),i("2877")),c=Object(o["a"])(r,n,s,!1,null,"a789e520",null);e["default"]=c.exports},c34c:function(t,e,i){"use strict";function n(t,e){let i=0;return e/=2,function(...n){Date.now()-i>=e&&setTimeout(()=>{t.apply(null,n),i=Date.now()},e)}}function s(t,e){let i=0;return function(...n){clearTimeout(i),i=setTimeout(()=>t.apply(this,n),e)}}i.d(e,"b",(function(){return n})),i.d(e,"a",(function(){return s}))},c4dc:function(t,e,i){},c5cc:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));const n=!0,s={"juejin.cn":"api.juejin.cn",boe:"juejin-im-boe.bytedance.net","w8zlcvhw.fn.bytedance.net":"api.juejin.cn","juejin-preview.fn.bytedance.net":"api.juejin.cn"};async function a({url:t,method:e="get",query:i,body:a,showError:o=!0,headers:c={},reqHost:l}){i&&(t+="?"+r(i));const u=n?s[window.location.host]:s.boe;t=u?`https://${u}${t}`:t;const d=await fetch(t,{credentials:"include",method:e,headers:Object.assign({"Content-Type":"application/json"},c),body:a?JSON.stringify(a):void 0}),h=await d.json();if(o&&h.err_no){const t=new Error(h.err_msg);throw t.normalizedCode=h.err_no,t}return h}function r(t){return Object.keys(t).filter(e=>void 0!==t[e]).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`).join("&")}},c80e:function(t,e,i){},c901:function(t,e,i){"use strict";i.d(e,"a",(function(){return d}));var n=i("7a61"),s=i("8690"),a=i("bfe9"),r=i("9db5"),o=i("519d"),c=i("7f42");const l=["H1","H2","H3","H4","H5","H6","IMG","A","BLOCKQUOTE","UL","OL","LI","B","STRONG","U","I","SUP","SUB","STRIKE","P","BR","SPAN","DIV","CODE","PRE","TABLE","THEAD","TBODY","TFOOT","TR","TH","TD"],u=["href","src","title","alt"];class d{toEditingHtml(t){return h(Object(s["a"])(Object(a["a"])(t))).innerHTML}fromEditingHtml(t){return Object(n["a"])(Object(a["a"])(t))}}function h(t){t=m(t);const e=/^hljs \S+$/.test(t.className)?t.className.split(/\s+/).pop():"";switch(f(t),t.nodeName){case"B":t.className=c["CLASS_NAME"];break;case"STRONG":const i=document.createElement("b");i.innerHTML=t.innerHTML,t.className=c["CLASS_NAME"],t.parentNode.insertBefore(i,t),t.parentNode.removeChild(t),t=i;break;case"CODE":t.className=o["CLASS_NAME"];break;case"PRE":const n=document.createElement("div"),s=document.createTextNode(t.innerText);n.appendChild(s),t.setAttribute("code-lang",e),t.innerHTML=n.innerHTML,t.className=r["CLASS_NAME"];break;case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":t.innerHTML=t.innerText;break}return Array.prototype.slice.call(t.children).forEach(h),t}function f(t){for(let e=t.attributes.length-1;e>=0;e--){const i=t.attributes[e].name;p(i)&&t.removeAttribute(i)}}function p(t){return-1===u.indexOf(t)}function m(t){if(g(t)){const e=b(t),i=document.createElement(e?"div":"span");return i.innerHTML=t.innerHTML,v(i,t),t.parentNode.insertBefore(i,t),t.parentNode.removeChild(t),i}return t}function g(t){return-1===l.indexOf(t.nodeName)&&t.parentNode}function b(t){const e=window.getComputedStyle(t);return-1===e.display.indexOf("inline")}function v(t,e){for(let i=e.attributes.length-1;i>=0;i--)t.setAttribute(e.attributes[i].name,e.attributes[i].value)}},cc4b:function(t,e,i){},cd49:function(t,e,i){"use strict";i.r(e);var n={};i.r(n),i.d(n,"$alert",(function(){return K})),i.d(n,"$error",(function(){return Q}));i("db4d");var s=i("2b0e"),a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"juejin-web-editor"}},[i("AlertList",{ref:"alertList"}),i("AntiblockAlert"),i("router-view")],1)},r=[],o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"alert-list"},t._l(t.list,(function(t,e){return i("alert",{key:e,staticClass:"alert",attrs:{content:t.content,type:t.type}})})),1)},c=[],l=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"alert",class:[t.type]},[t._v(t._s(t.content))])},u=[],d={props:["type","content"]},h=d,f=(i("bafc"),i("2877")),p=Object(f["a"])(h,l,u,!1,null,"3350daf2",null),m=p.exports,g={components:{Alert:m},props:["timeout"],data:()=>({list:[]}),methods:{push(t){this.list.unshift(t),window.setTimeout(()=>{this.list=this.list.filter(e=>e!==t)},this.timeout||3e3)}}},b=g,v=(i("7600"),Object(f["a"])(b,o,c,!1,null,"6156d880",null)),_=v.exports,C=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.visible?i("div",{staticClass:"antiblock-alert"},[i("span",[t._v(" 广告屏蔽插件可能会影响编辑器的正常使用与执行性能，请将此页面加入白名单 ")]),i("span",{staticClass:"close-btn ion-close",on:{click:t.close}})]):t._e()},y=[],w=i("964c"),k={data:()=>({visible:x()}),methods:{close(){this.visible=!1,E()}}};function x(){return!j()&&O()}function O(){const t=document.createElement("div");t.className="ad ads adv advert adsbox",document.body.appendChild(t);const e="none"===window.getComputedStyle(t).display;return document.body.removeChild(t),e}function j(){return!!w["a"]("hideAntiblockAlert")}function E(){w["b"]("hideAntiblockAlert",!0)}var A=k,L=(i("9221"),Object(f["a"])(A,C,y,!1,null,"4712b9df",null)),S=L.exports,T={components:{AlertList:_,AntiblockAlert:S},created(){this.$root.$on("alert",(t,e)=>{this.$refs.alertList.push({content:t,type:e})})}},I=T,D=(i("a0bb"),i("5c64"),Object(f["a"])(I,a,r,!1,null,null,null)),$=D.exports,N=i("78f8"),M=i.n(N),U=i("24c0"),P=i("c34c");s["default"].use(M.a);const F=new M.a({mode:"history",saveScrollPosition:!0,linkActiveClass:"route-active",scrollBehavior:(t,e,i)=>t.hash?{selector:t.hash}:{x:0,y:0},routes:[{path:"/editor",name:"index",component:i("0b6e").default},{path:"/editor/book/:id/section/:sectionId?",name:"bookEditor",component:i("33f7").default},{path:"/editor/drafts",name:"draftIndex",component:i("425c").default},{path:"/editor/drafts/:id",name:"editDraft",component:i("4cc8").default},{path:"/editor/posts/:id",name:"editPost",component:i("08a6").default},{path:"/editor/news-drafts/:id",name:"editRealtime",component:i("eada").default},{path:"*",name:"notFound",component:i("c32a").default}]});F.beforeEach((t,e,i)=>{i()});const R=Object(P["a"])(t=>{U["a"].exec("set","page",t.fullPath),U["a"].exec("send","pageview")},300);F.afterEach(R);var H=F,B=i("08e3"),V=i.n(B),q=i("916c"),X=i.n(q);s["default"].use(X.a);const z=new X.a.Store({modules:{auth:i("1b8d").default,error:i("5250").default,layout:i("58e8").default,draft:i("3d36").default}});z.types=i("7c64");var Y=z,G=i("31bd"),W=i("7bbb"),Z="不要吹灭你的灵感和你的想象力; 不要成为你的模型的奴隶。 ——文森特・梵高";function K(t,e){t=t instanceof Error?t.message:t,this.$root.$emit("alert",t,e)}function Q(t,e){const i=e||("string"===typeof t?t:(t||{}).message)||"执行异常";this.$alert(i,"error"),console.error(t)}function J(t,e,i,n=!1){return t.addEventListener(e,i,n),function(){t.removeEventListener(e,i,n)}}const tt={bind(t,e){const i=J(window,"click",(function(e){if(!t.contains(e.target)){const i=t.__outerClick.handler;"function"===typeof i&&i.call(t,e)}}),!0);t.__outerClick={handler:null,removeListener:i}},update(t,e){t.__outerClick.handler=e.value},unbind(t,e){t.__outerClick.removeListener(),t.__outerClick=null}};s["default"].use(i("d3a2")),s["default"].use(i("3b37")),s["default"].directive("outer-click",tt),Object.assign(s["default"].prototype,n);var et=i("ca1f"),it=i.n(et),nt=i("a0f4"),st=i.n(nt);i("37c5"),i("5a5c");window.TEA=it.a;const at="juejin.cn"!==window.location.hostname;function rt(){Object(G["sync"])(Y,H),s["default"].use(V.a),s["default"].use(st.a),new s["default"]({store:Y,router:H,render:t=>t($)}).$mount("#juejin-web-editor")}function ot(){console.log(Z)}window.TEA.init({app_id:2608,channel:"cn",log:at}),window.TEA.config({app_name:"jj_web",disable_auto_pv:!0,_staging_flag:at?1:0}),window.TEA.start(),W["c"](Y).catch(t=>(console.error(t),window.alert("初始化失败，请检查登录状态"),Promise.reject(t))).then(rt).then(ot)},cdb2:function(t,e,i){t.exports=i.p+"img/extend.ec7370cb.svg"},cecb:function(t,e,i){"use strict";i.d(e,"a",(function(){return n})),i.d(e,"b",(function(){return s}));const n=500,s=2e4},d24a:function(t,e,i){t.exports=i.p+"img/summary-extend.0b48f17b.svg"},d265:function(t,e,i){"use strict";var n=i("5472"),s=i.n(n);s.a},d3a2:function(t,e,i){"use strict";i.r(e),i.d(e,"install",(function(){return s}));var n=i("8690");function s(t,e){t.mixin({created(){this.$domEvents={listenerRemoverList:[]}},mounted(){const t=this.$options.domEvents;t&&Object.keys(t).forEach(e=>{this.$domEvents.listenerRemoverList.push(Object(n["g"])(window,e,i=>{t[e].call(this,i)}))})},beforeDestroy(){this.$domEvents.listenerRemoverList.forEach(t=>t())}})}},d45d:function(t,e,i){t.exports=i.p+"img/summary-collapse.1fdc233a.svg"},d56c:function(t,e,i){"use strict";var n=i("be6f"),s=i.n(n);s.a},d85e:function(t,e,i){},d87f:function(t,e,i){"use strict";var n=i("7e9c"),s=i.n(n);s.a},da4a:function(t,e,i){},ddce:function(t,e,i){},de99:function(t,e,i){"use strict";var n=i("c4dc"),s=i.n(n);s.a},dee8:function(t,e,i){},df41:function(t,e,i){},dfa1:function(t,e,i){"use strict";var n=i("9af7"),s=i.n(n);s.a},e022e:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n=i("c5cc");const{html2text:s,removeElement:a}=i("e4bf");async function r(t){var e;const i=await Object(n["a"])({url:"/content_api/v1/article_draft/abstract?draft_id="+t});return 0!==i.err_no?Promise.reject(new Error(i.err_msg)):(null===(e=null===i||void 0===i?void 0:i.data)||void 0===e?void 0:e.text)||""}},e096:function(t,e,i){},e0a3:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("nav",{staticClass:"navigator",class:{active:t.active}},[i("div",{staticClass:"toggle-btn",style:{backgroundImage:"url("+t.avatarUrl+")"},on:{click:function(e){t.active=!t.active}}}),i("div",{directives:[{name:"show",rawName:"v-show",value:t.active,expression:"active"}],staticClass:"menu root-menu",on:{"!click":function(e){t.active=!1}}},[i("div",{staticClass:"item-group"},[i("a",{staticClass:"item",attrs:{href:"/editor/drafts/new?v=2"}},[t._v("写文章")]),1===t.user.book_author?i("a",{staticClass:"item",attrs:{href:"/editor/book/new/section?v=2"}},[t._v(" 写小册 ")]):t._e(),i("a",{staticClass:"item",attrs:{href:"/editor/drafts?v=2"}},[t._v("草稿")])]),t.hasJoinTeam||t.showJobMangae?i("div",{staticClass:"item-group"},[t.hasJoinTeam?i("a",{staticClass:"item",attrs:{href:"/team/"+t.user.tech_team.org_id+"/posts"}},[t._v(" 我的团队 ")]):t._e(),t.showJobMangae?i("a",{staticClass:"item",attrs:{href:"/team/"+t.user.tech_team.org_id+"/management/recruit/hire"}},[t._v(" 职位管理（"+t._s(t.user.job_count)+"） ")]):t._e()]):t._e(),i("div",{staticClass:"item-group"},[i("a",{staticClass:"item",attrs:{href:"/user/"+t.user.user_id}},[t._v("我的主页")]),i("a",{staticClass:"item",attrs:{href:"/user/"+t.user.user_id+"/likes"}},[t._v("我喜欢的")]),1===t.user.book_author?i("a",{staticClass:"item",attrs:{href:"/user/"+t.user.user_id+"/books?type=wrote"}},[t._v(" 我的小册 ")]):t._e(),i("a",{staticClass:"item",attrs:{href:"/user/"+t.user.user_id+"/collections"}},[t._v(" 我的收藏集 ")]),i("a",{staticClass:"item",attrs:{href:"/subscribe/subscribed"}},[t._v("标签管理")])]),t._m(0)]),i("ArticleImporter",{ref:"articleImporter"})],1)},s=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-group"},[i("a",{staticClass:"item",attrs:{href:"/user/settings/profile"}},[t._v("设置")]),i("a",{staticClass:"item"},[t._v(" 关于 "),i("i",{staticClass:"icon ion-chevron-right"}),i("div",{staticClass:"menu sub-menu"},[i("div",{staticClass:"item-group"},[i("a",{staticClass:"item",attrs:{href:"/app",target:"_blank"}},[t._v("下载应用")]),i("a",{staticClass:"item",attrs:{href:"/about",target:"_blank"}},[t._v("关于")]),i("a",{staticClass:"item",attrs:{href:"https://xitu.io/jobs",target:"_blank"}},[t._v(" 加入我们 ")]),i("a",{staticClass:"item",attrs:{href:"https://github.com/xitu/gold-miner",target:"_blank"}},[t._v(" 翻译计划 ")]),i("a",{staticClass:"item",attrs:{href:"https://bd.juejin.cn",target:"_blank"}},[t._v(" 合作伙伴 ")])])])])])}],a=i("5c91"),r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.importing,expression:"importing"}],staticClass:"article-importer"},[i("input",{ref:"fileInput",staticClass:"file-input",attrs:{type:"file",multiple:"multiple"},on:{change:function(e){return t.onFileSelected(e)}}}),i("div",{staticClass:"text"},[t._v(t._s(t.text))])])},o=[],c=i("6c54"),l=i("c901"),u=i("705e");const d={id:"5562b428e4b00c57d9b94b9d"};function h(t){const e=b(t.name);return"markdown"===e?f(t):"wysiwyg"===e?p(t):Promise.resolve()}function f(t){const e=new u["a"],i=g(t.name);return v({type:"markdown",title:i,tags:[],markdown:t.content,html:e.toHtml(t.content),screenshot:"",abstract:"",category:d}).then(t=>c["a"](t))}function p(t){const e=new l["a"],i=m(t.content),n=i.title||g(t.name);return v({type:"wysiwyg",title:n,tags:[],markdown:"",html:e.fromEditingHtml(e.toEditingHtml(i.content)),screenshot:"",abstract:"",category:d}).then(t=>c["a"](t))}function m(t){const e=t.replace(/^[\s\S]*?<body>/i,"").replace(/<\/body>[\s\S]*$/i,""),i=e.replace(/^[\s\S]*?<h1[\s\S]*?>([\s\S]+?)<\/h1>[\s\S]*$/i,"$1").trim(),n=e.replace(/<h1[\s\S]*?>[\s\S]+?<\/h1>/i,"").trim().replace(/http:\/\/upload-images/i,"https://upload-images");return{title:i,content:n}}function g(t){return t.replace(/\..+?$/,"").replace(/^-+|-+$/g,"").replace(/(?=\S)-(?=\S)/g," ")}function b(t){return/\.md$/i.test(t)?"markdown":/\.html$/i.test(t)?"wysiwyg":void 0}function v(t){return c["c"](t)}var _=i("8896"),C={data:()=>({list:[],importing:!1,importedCount:0}),computed:{user(){return this.$store.getters.USER},text(){return this.importing?`正在导入（${this.importedCount} / ${this.list.length}）`:""}},methods:{openFileDialog(){this.$refs.fileInput.click()},onFileSelected({target:t}){const e=[].slice.call(t.files);e.length&&(e.some(t=>!/\.(md|html)$/i.test(t.name))?this.$error("只支持 .md 和 .html 文件"):this.importFromFileList(e).then(()=>{this.$refs.fileInput.value=null}))},importFromFileList(t){return this.list=t,this.importedCount=0,this.importing=!0,this.importArticleList().catch(t=>{this.$error(t),this.importing=!1})},importArticleList(){if(this.importedCount<this.list.length){const t=this.list[this.importedCount];return Object(_["b"])(t).then(e=>h({name:t.name,content:e})).then(()=>(this.importedCount++,this.importArticleList()))}return this.updatePageState(),Promise.resolve()},updatePageState(){window.location.href="/editor/drafts?t="+Date.now()}}},y=C,w=(i("2e106"),i("2877")),k=Object(w["a"])(y,r,o,!1,null,"e196e394",null),x=k.exports,O={components:{ArticleImporter:x},data:()=>({active:!1}),computed:{user(){return this.$store.getters.USER},avatarUrl(){const t=this.user.avatar_large;return t?Object(a["a"])(t,64,64):""},hasJoinTeam(){const t=this.user.tech_team||{};return Boolean(t.org_id&&"0"!==t.org_id)},userTeamAdmin(){const t=this.user.tech_team||{};return this.hasJoinTeam&&1===t.role},showJobMangae(){return this.user.job_count>0||this.userTeamAdmin}},domEvents:{click({target:t}){this.$el.contains(t)||(this.active=!1)}},methods:{importArticle(){this.$refs.articleImporter.openFileDialog()}}},j=O,E=(i("4e61"),Object(w["a"])(j,n,s,!1,null,"93577b52",null));e["a"]=E.exports},e108:function(t,e,i){"use strict";var n=i("46bb"),s=i.n(n);s.a},e234:function(t,e,i){},e248:function(t,e,i){"use strict";i.d(e,"d",(function(){return o})),i.d(e,"c",(function(){return c})),i.d(e,"a",(function(){return l})),i.d(e,"f",(function(){return u})),i.d(e,"b",(function(){return d})),i.d(e,"e",(function(){return h})),i.d(e,"g",(function(){return f}));var n=i("c5cc"),s=i("7bbb"),a=i("bde8"),r=i("b8ba");function o(t,e){return s["a"]()?Object(n["a"])({url:"/content_api/v1/article_draft/query_list",method:"post",body:{}}).then(t=>t.data).then(t=>(t||[]).map(a["a"].fromDescriptor)):Promise.reject(Object(r["a"])())}function c(t){return s["a"]()?Object(n["a"])({url:"/content_api/v1/article_draft/detail",method:"post",body:{draft_id:String(t)}}).then(t=>t.data).then(t=>t?a["a"].fromDescriptor(t,"detail"):{}):Promise.reject(Object(r["a"])())}function l(t){return s["a"]()?Object(n["a"])({url:"/content_api/v1/article_draft/create",method:"post",body:{category_id:String(t.category.id||"0"),tag_ids:t.tags.map(t=>t.tag_id||t.id),link_url:t.link_url||"",cover_image:t.screenshot||"",is_gfw:t.is_gfw,title:t.title||"",brief_content:t.brief_content,is_english:t.is_english,is_original:t.is_original,edit_type:"markdown"===t.type||10===t.type?10:0,html_content:t.html||"",mark_content:t.markdown||""}}).then(t=>t.data).then(t=>t?a["a"].fromDescriptor(t):{}):Promise.reject(Object(r["a"])())}function u(t){return s["a"]()?Object(n["a"])({url:"/content_api/v1/article_draft/update",method:"post",body:{id:String(t.id),category_id:String(t.category.id||"0"),tag_ids:t.tags.map(t=>t.tag_id||t.id),link_url:t.link_url||"",cover_image:t.cover_image||"",is_gfw:t.is_gfw,title:t.title||"",brief_content:t.brief_content,is_english:t.is_english,is_original:t.is_original,edit_type:"markdown"===t.type||10===t.type?10:0,html_content:t.html||"",mark_content:t.markdown||""}}).then(t=>t.data):Promise.reject(Object(r["a"])())}function d(t){if(!s["a"]())return Promise.reject(Object(r["a"])());s["b"]();return Object(n["a"])({url:"/content_api/v1/article_draft/delete",method:"post",body:{draft_id:String(t)}}).then(t=>t.data)}function h(t,e,i={sync_to_org:!1,column_ids:[]}){return s["a"]()?Object(n["a"])({url:"/content_api/v1/article/publish",method:"post",body:Object.assign({draft_id:String(t)},i)}).then(t=>t.data).then(t=>(window.TEA("article_publish",{user_level:e,user_id:t.user_id||"0",article_id:t.article_id||"0",published_at:t.ctime||0,category_id:t.category_id||0}),t)):Promise.reject(Object(r["a"])())}function f(t){}},e37c:function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"a",(function(){return c})),i.d(e,"e",(function(){return l})),i.d(e,"c",(function(){return u})),i.d(e,"d",(function(){return d}));var n=i("e248");function s(t){return n["c"](t)}function a(t){return n["g"](t)}var r=i("6c54");function o(t){return s(t)}function c(t){return r["f"](t)}function l(t){return a(t)}function u(t){return`https://${window.location.host}/post/${t}`}function d(){return`https://${window.location.host}/published`}},e4bf:function(t,e,i){"use strict";i.r(e),i.d(e,"html2text",(function(){return r})),i.d(e,"removeElement",(function(){return o}));const{BLOCK_LEVEL_ELEMENT_LIST:n,VOID_ELEMENT_LIST:s,CHAR_MAP:a}=i("abd9");function r(t){const e=`__BLOCK_BOUND_${Date.now()}__`;return t=t.replace(/[\r\n]+/g,"\n"),t=t.replace(/<br[^>]*>/g,"\n"),t=t.replace(/[ \f\t\v]+/g," "),t=t.replace(/<\/?([^>\s]+)[^>]*>/g,(t,i)=>c(i.toUpperCase())?e:""),t=t.replace(new RegExp(`^(${e})+|(${e})+$`,"g"),"").replace(new RegExp(`(${e})+`,"g"),"\n"),t=t.replace(/&(\S+?);/g,t=>a[t]||t),t}function o(t,e){const i=[],n=[];while(t){const s=t.match(/<\/?([^>\s]+)([^>]*)>/);if(s){const a=s.index,r=s[0],o=s[1].toUpperCase(),c="/"===r[1],u=l(o);if(n.length)if(c){if(n[0]!==o)throw new Error("end tag is not matched.");n.shift()}else!u&&n.unshift(o);else{const c=(s[2].match(/id="(.+?)"/i)||{})[1],l=(s[2].match(/class="(.+?)"/i)||{})[1];i.push(t.slice(0,a)),e({id:c,tag:o,className:l})?!u&&n.unshift(o):i.push(r)}t=t.slice(a+r.length)}else i.push(t),t=""}return i.join("")}function c(t){return n.includes(t)}function l(t){return s.includes(t)}},e64d:function(t,e,i){},e767:function(t,e,i){"use strict";var n=i("d85e"),s=i.n(n);s.a},e82a:function(t,e,i){},e974:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));class n{}n.fromServerDescriptor=function(t){return t?(t=Object.assign(Object.assign(Object.assign({},t),t.category||{}),t.user_interact||{}),n.fromDescriptor({id:t.category_id||"0",name:t.category_name,title:t.category_name,subscribed:t.is_follow,category_url:t.category_url})):null},n.fromDescriptor=function(t){return t?Object.assign(new n,t):null}},ea37:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n=i("a810"),s=i.n(n);i.d(e,"b",(function(){return s.a}));var a=i("b9bf");function r(t){return s()(o(t||""))}function o(t){const e=t.replace(/<!--[\s\S]*?-->/g,"").replace(/<[^>]*>/g,"");return Object(a["htmlDecode"])(e)}},eada:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"realtime_container"},[i("header",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.realtime.title,expression:"realtime.title"}],staticClass:"title_input",attrs:{placeholder:"输入资讯标题...",spellcheck:"false",maxlength:100},domProps:{value:t.realtime.title},on:{input:function(e){e.target.composing||t.$set(t.realtime,"title",e.target.value)}}}),i("div",{staticClass:"right_box"},[i("StatusText",{staticClass:"with_margin",attrs:{status:t.status,defaultText:"资讯将自动保存至草稿箱"}}),i("Button",{staticClass:"with_margin",attrs:{outline:""},nativeOn:{click:function(e){return t.toDrafts(e)}}},[t._v(" 草稿箱 ")]),i("PublishPopup",{staticClass:"with_margin",attrs:{value:t.realtime},on:{change:t.changeRealtime,publish:t.publish}}),i("MainNavigator",{staticClass:"with_margin"})],1)]),i("Editor",{staticClass:"main",model:{value:t.realtime.content,callback:function(e){t.$set(t.realtime,"content",e)},expression:"realtime.content"}})],1)},s=[],a=i("a0f4"),r=i("8bb0"),o=i("59be"),c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Editor",{attrs:{value:t.value,plugins:t.plugins,locale:t.locale,uploadImages:t.uploadImages},on:{change:t.handleChange}})},l=[],u=i("3dc0"),d=i("1b28"),h=i("a295"),f=i("6a08"),p=Object(a["defineComponent"])({props:{value:{type:String,reqiure:!0}},components:{Editor:u["Editor"]},setup(t,e){const i=[...d["a"]],n=t=>{e.emit("input",t)},s=async t=>{const e=await Object(f["b"])("",t);return e.map(t=>({url:t.Url}))};return{plugins:i,handleChange:n,locale:h,uploadImages:s}}}),m=p,g=i("2877"),b=Object(g["a"])(m,c,l,!1,null,null,null),v=b.exports,_=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"publish-popup",class:{active:t.active}},[i("Button",{nativeOn:{click:function(e){return t.setActive(!0)}}},[t._v(" 发布 ")]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.active,expression:"active"}],staticClass:"panel"},[i("div",{staticClass:"title"},[i("span",[t._v("发布资讯")]),i("svg",{staticClass:"close",attrs:{width:"20",height:"20",viewBox:"0 0 20 20",fill:"#8A93A0",xmlns:"http://www.w3.org/2000/svg"},on:{click:function(e){return t.setActive(!1)}}},[i("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M13.92 14.08C13.7247 14.2753 13.4082 14.2753 13.2129 14.08L10.1211 10.9882L6.90776 14.2016C6.7125 14.3969 6.39592 14.3969 6.20066 14.2016L5.8471 13.8481C5.65184 13.6528 5.65184 13.3362 5.8471 13.141L9.06049 9.92758L5.84894 6.71603C5.65368 6.52077 5.65368 6.20418 5.84894 6.00892L6.2025 5.65537C6.39776 5.46011 6.71434 5.46011 6.9096 5.65537L10.1211 8.86692L13.2111 5.777C13.4063 5.58174 13.7229 5.58174 13.9182 5.777L14.2717 6.13055C14.467 6.32582 14.467 6.6424 14.2717 6.83766L11.1818 9.92758L14.2736 13.0193C14.4688 13.2146 14.4688 13.5312 14.2736 13.7264L13.92 14.08Z"}})])]),i("div",{staticClass:"item-box"},[i("div",{staticClass:"sub-title type"},[i("svg",{attrs:{width:"8",height:"8",viewBox:"0 0 8 8",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[i("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M4.41817 1.09961C4.52862 1.09961 4.61812 1.18922 4.61812 1.29968L4.61726 3.3446L6.45369 2.74829C6.55874 2.71416 6.6715 2.77154 6.70564 2.87659L6.95296 3.63745C6.98709 3.7425 6.92959 3.8554 6.82454 3.88953L4.9742 4.48962L6.19942 6.17627C6.26434 6.26563 6.24459 6.39065 6.15523 6.45557L5.50801 6.92578C5.41865 6.9907 5.29351 6.97095 5.22859 6.88159L3.96223 5.13757L2.68904 6.89075C2.62412 6.98011 2.49898 6.99999 2.40962 6.93506L1.7624 6.46484C1.67304 6.39992 1.65329 6.27479 1.71821 6.18542L2.97322 4.45569L1.16853 3.86963C1.06348 3.8355 1.00598 3.72273 1.04011 3.61768L1.28731 2.85681C1.32144 2.75176 1.43421 2.69426 1.53926 2.72839L3.41719 3.33765L3.41817 1.29968C3.41817 1.18922 3.50766 1.09961 3.61812 1.09961H4.41817Z",fill:"#F53F3F"}})]),i("span",[t._v("选择分类")])]),i("div",{staticClass:"category-list"},t._l(t.state.categories,(function(e){return i("div",{key:e.category_id,staticClass:"item",class:{active:t.realtime.category_id===e.category_id},on:{click:function(i){return t.setRealtime({name:"category_id",value:e.category_id})}}},[t._v(" "+t._s(e.category_name)+" ")])})),0)]),i("div",{staticClass:"item-box"},[i("div",{staticClass:"sub-title"},[i("svg",{attrs:{width:"8",height:"8",viewBox:"0 0 8 8",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[i("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M4.41817 1.09961C4.52862 1.09961 4.61812 1.18922 4.61812 1.29968L4.61726 3.3446L6.45369 2.74829C6.55874 2.71416 6.6715 2.77154 6.70564 2.87659L6.95296 3.63745C6.98709 3.7425 6.92959 3.8554 6.82454 3.88953L4.9742 4.48962L6.19942 6.17627C6.26434 6.26563 6.24459 6.39065 6.15523 6.45557L5.50801 6.92578C5.41865 6.9907 5.29351 6.97095 5.22859 6.88159L3.96223 5.13757L2.68904 6.89075C2.62412 6.98011 2.49898 6.99999 2.40962 6.93506L1.7624 6.46484C1.67304 6.39992 1.65329 6.27479 1.71821 6.18542L2.97322 4.45569L1.16853 3.86963C1.06348 3.8355 1.00598 3.72273 1.04011 3.61768L1.28731 2.85681C1.32144 2.75176 1.43421 2.69426 1.53926 2.72839L3.41719 3.33765L3.41817 1.29968C3.41817 1.18922 3.50766 1.09961 3.61812 1.09961H4.41817Z",fill:"#F53F3F"}})]),i("span",[t._v("摘要")])]),i("div",{staticClass:"brief"},[i("span",{style:{color:(t.realtime.brief||"").length<50?"#ee4d38":"#c2c6cc"}},[t._v(" "+t._s((t.realtime.brief||"").length)+"/100 ")]),i("Input",{directives:[{name:"loading",rawName:"v-loading",value:t.state.briefLoading,expression:"state.briefLoading"}],staticClass:"brief_textarea",attrs:{type:"textarea",autosize:!1,value:t.realtime.brief,placeholder:"摘要将显示在标题的下方，建议100字以内",rows:5,maxlength:100},on:{"on-change":function(e){t.state.briefChanged=!0,t.setRealtime({name:"brief",value:e})}}})],1)]),i("div",{staticClass:"item-box"},[i("div",{staticClass:"sub-title type"},[i("svg",{attrs:{width:"8",height:"8",viewBox:"0 0 8 8",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[i("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M4.41817 1.09961C4.52862 1.09961 4.61812 1.18922 4.61812 1.29968L4.61726 3.3446L6.45369 2.74829C6.55874 2.71416 6.6715 2.77154 6.70564 2.87659L6.95296 3.63745C6.98709 3.7425 6.92959 3.8554 6.82454 3.88953L4.9742 4.48962L6.19942 6.17627C6.26434 6.26563 6.24459 6.39065 6.15523 6.45557L5.50801 6.92578C5.41865 6.9907 5.29351 6.97095 5.22859 6.88159L3.96223 5.13757L2.68904 6.89075C2.62412 6.98011 2.49898 6.99999 2.40962 6.93506L1.7624 6.46484C1.67304 6.39992 1.65329 6.27479 1.71821 6.18542L2.97322 4.45569L1.16853 3.86963C1.06348 3.8355 1.00598 3.72273 1.04011 3.61768L1.28731 2.85681C1.32144 2.75176 1.43421 2.69426 1.53926 2.72839L3.41719 3.33765L3.41817 1.29968C3.41817 1.18922 3.50766 1.09961 3.61812 1.09961H4.41817Z",fill:"#F53F3F"}})]),i("span",[t._v("资讯封面")])]),i("div",{staticClass:"cover"},[i("CoverSelector",{attrs:{message:"建议尺寸：960*540px"},model:{value:t.realtime.thumbnail,callback:function(e){t.$set(t.realtime,"thumbnail",e)},expression:"realtime.thumbnail"}})],1)]),i("div",{staticClass:"button_group"},[i("Button",{attrs:{outline:""},nativeOn:{click:function(e){return t.setActive(!1)}}},[t._v("取消")]),i("Button",{nativeOn:{click:function(e){return t.publish(e)}}},[t._v("确认并发布")])],1)]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.active,expression:"active"}],staticClass:"mask",on:{click:function(e){return t.setActive(!1)}}})],1)},C=[],y=i("906a"),w=i("54ad"),k=i("8980"),x=Object(a["defineComponent"])({components:{Button:o["a"],Input:w["Input"],CoverSelector:y["a"]},props:{value:{type:Object,required:!0}},setup(t,e){const i=t.value,n=Object(a["reactive"])({categories:[],briefLoading:!1,briefChanged:!1}),{active:s,setActive:r}=o();function o(){const t=Object(a["ref"])(!1),s=e=>{t.value=e};return Object(a["watch"])(t,async()=>{if(t.value&&i.content_id&&!i.brief)try{n.briefLoading=!0,c({name:"brief",value:await Object(k["b"])(i.content_id)}),Object(a["nextTick"])(()=>{n.briefChanged=!1})}catch(s){e.root.$error(s)}finally{n.briefLoading=!1}t.value||!i.content_id||n.briefChanged||c({name:"brief",value:""})}),{active:t,setActive:s}}function c(t){e.emit("change",t)}function l(){e.emit("publish")}return Object(a["watch"])(i,()=>{n.briefChanged=!!i.brief}),Object(a["onMounted"])(async()=>{Object(k["f"])().then(t=>{n.categories=t})}),{active:s,setActive:r,state:n,realtime:i,setRealtime:c,publish:l}}}),O=x,j=(i("4de5"),Object(g["a"])(O,_,C,!1,null,"6df5f456",null)),E=j.exports,A=i("e0a3"),L=i("e37c"),S=i("c34c");const T={category_id:{message:"请选择分类",handler:t=>!!t},thumbnail:{message:"请上传标题图",handler:t=>!!t},title:{message:"请填写标题",handler:t=>!!t},brief:{message:"摘要不满足最低50字的要求",handler:t=>t.trim().length>=50},content:{message:"请填写内容",handler:t=>!!t}};var I=Object(a["defineComponent"])({components:{StatusText:r["a"],Button:o["a"],Editor:v,PublishPopup:E,MainNavigator:A["a"]},setup(t,{root:e}){const{realtime:i,changeRealtime:n}=r(),s=Object(a["ref"])("");function r(){let t=Object(a["reactive"])(k["a"]);const i=Object(S["a"])(async(t,i)=>{const s=e.$route.params.id;try{i.value="saving";const a=await Object(k["h"])(Object.assign(Object.assign({},t),{content_id:s}));i.value="editing",s!==a&&(e.$router.replace({params:{id:a}}),n({name:"content_id",value:a}))}catch(a){console.error(a),i.value="error"}},300);return Object(k["c"])(e.$route.params.id).then(e=>{Object.keys(k["a"]).forEach(i=>t[i]=e[i]),Object(a["watch"])(t,()=>i(t,s),{deep:!0})}).catch(t=>{e.$error(t)}),{realtime:t,changeRealtime:({name:e,value:i})=>{t[e]=i}}}async function o(){const t=Object.keys(T);for(const s of t){const{message:t,handler:n}=T[s];if(!n(i[s]))return void e.$error(t)}try{const t=e.$route.params.id;await Object(k["e"])(t);const i={id:t,type:"realtime"};window.sessionStorage.setItem("PUB_INFO",JSON.stringify(i)),window.location.href=Object(L["d"])()}catch(n){e.$error(n)}}return{realtime:i,status:s,toDrafts:()=>window.open("/editor/drafts?type=realtime"),changeRealtime:n,publish:o}}}),D=I,$=(i("a86c"),i("b675"),Object(g["a"])(D,n,s,!1,null,"7d200a6a",null));e["default"]=$.exports},ee10:function(t,e,i){"use strict";i.d(e,"a",(function(){return c})),i.d(e,"b",(function(){return u}));var n=i("1487"),s=i.n(n),a=i("7cbb"),r=function(t){var e={keyword:"query mutation subscription|10 type input schema directive interface union scalar fragment|10 enum on ...",literal:"true false null"};return{aliases:["gql"],keywords:e,contains:[t.HASH_COMMENT_MODE,t.QUOTE_STRING_MODE,t.NUMBER_MODE,{className:"type",begin:"[^\\w][A-Z][a-z]",end:"\\W",excludeEnd:!0},{className:"literal",begin:"[^\\w][A-Z][A-Z]",end:"\\W",excludeEnd:!0},{className:"variable",begin:"\\$",end:"\\W",excludeEnd:!0},{className:"keyword",begin:"[.]{2}",end:"\\."},{className:"meta",begin:"@",end:"\\W",excludeEnd:!0}],illegal:/([;<']|BEGIN)/}};function o(t,e,i){t.registerLanguage(e,i)}function c(){return s.a.listLanguages().sort()}function l(t){return!!s.a.getLanguage(t)}function u(t,e){return l(t)?s.a.highlight(t,e).value:Object(a["a"])(e)}o(s.a,"graphql",r)},ee38:function(t,e,i){},ee80:function(t,e,i){"use strict";var n=i("0c00"),s=i.n(n);s.a},f1ba:function(t,e,i){"use strict";var n=i("94c5"),s=i.n(n);s.a},f1da:function(t,e,i){"use strict";var n=i("043c"),s=i.n(n);s.a},f6c2:function(t,e,i){"use strict";var n=i("7b88"),s=i.n(n);s.a},f8ff:function(t,e,i){},f9a5:function(t,e,i){t.exports=i.p+"img/logo.3e69d5af.svg"},fa05:function(t,e,i){"use strict";var n=i("5636"),s=i.n(n);s.a},feb3:function(t,e,i){"use strict";var n=i("17d6"),s=i.n(n);s.a}});